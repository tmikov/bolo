            BOLO.LST                                            Sourcer v8.01  18-May-2021  2:36 pm   Page 1


                                PAGE  59,132

                                ;==========================================================================
                                ;==                                                                      ==
                                ;==                             BOLO                                     ==
                                ;==                                                                      ==
                                ;==      Created:   13-May-21                                            ==
                                ;==      Passes:    9          Analysis Options on: QRSUX                ==
                                ;==                                                                      ==
                                ;==========================================================================

                                .err     Target Assembler set to NONE, re-assembly not recommended


                                ; The following equates show data references outside the range of the program.

     = 0020                     data_1e         equ     20h                     ; (0000:0020=0A5h)
     = 00CA                     data_2e         equ     0CAh                    ; (0000:00CA=0)
     = 046C                     timer_low_      equ     46Ch                    ; (0000:046C=9C24h)
     = 0487                     video_options_  equ     487h                    ; (0000:0487=60h)
     = 5487                     data_3e         equ     5487h                   ;*(0200:5487=74h)
     = 0005                     data_4e         equ     5                       ; (2913:0005=0)
     = 000A                     data_5e         equ     0Ah                     ; (2913:000A=0)
     = 0018                     data_6e         equ     18h                     ; (2913:0018=0)
     = 001E                     data_7e         equ     1Eh                     ; (2913:001E=0)
     = 001F                     data_8e         equ     1Fh                     ; (2913:001F=0)
     = 0020                     data_9e         equ     20h                     ; (2913:0020=0)
     = 0029                     data_10e        equ     29h                     ; (2913:0029=0)
     = 2F88                     time_5bit_e     equ     2F88h                   ;*(2913:2F88=0)
     = 2F89                     tmp1_buf_e      equ     2F89h                   ;*(2913:2F89=0)
     = 3F89                     maze_buf_e      equ     3F89h                   ;*(2913:3F89=0)
     = 4087                     data_182e       equ     4087h                   ;*(2913:4087=0)
     = 4F89                     data_183e       equ     4F89h                   ;*(2913:4F89=0)
     = 4F8A                     dest_seg_e      equ     4F8Ah                   ;*(2913:4F8A=0)
     = 4F8C                     data_185e       equ     4F8Ch                   ;*(2913:4F8C=0)
     = 4F8D                     orig_int8_e     equ     4F8Dh                   ;*(2913:4F8D=0)
     = 4F91                     orig_int9_e     equ     4F91h                   ;*(2913:4F91=0)
     = 4F95                     kbdin_key_e     equ     4F95h                   ;*(2913:4F95=0)
     = 4F96                     lives_e         equ     4F96h                   ;*(2913:4F96=0)
     = 4F97                     fuel_level_e    equ     4F97h                   ;*(2913:4F97=0)
     = 4F99                     fuel_disp_e     equ     4F99h                   ;*(2913:4F99=0)
     = 4F9A                     data_187e       equ     4F9Ah                   ;*(2913:4F9A=0)
     = 4F9B                     data_188e       equ     4F9Bh                   ;*(2913:4F9B=0)
     = 4FC5                     data_189e       equ     4FC5h                   ;*(2913:4FC5=0)
     = 4FEF                     data_190e       equ     4FEFh                   ;*(2913:4FEF=0)
     = 5019                     data_191e       equ     5019h                   ;*(2913:5019=0)
     = 5043                     coll_flags1_e   equ     5043h                   ;*(2913:5043=0)
     = 5063                     data_192e       equ     5063h                   ;*(2913:5063=0)
     = 506D                     data_193e       equ     506Dh                   ;*(2913:506D=0)
     = 5097                     data_194e       equ     5097h                   ;*(2913:5097=0)
     = 50B7                     vel_magn_e      equ     50B7h                   ;*(2913:50B7=0)
     = 50D7                     ship_angle_e    equ     50D7h                   ;*(2913:50D7=0)
     = 50F7                     data_195e       equ     50F7h                   ;*(2913:50F7=0)
     = 5117                     data_196e       equ     5117h                   ;*(2913:5117=0)
     = 5137                     data_197e       equ     5137h                   ;*(2913:5137=0)
     = 5177                     gun_angle_e     equ     5177h                   ;*(2913:5177=0)
     = 5178                     vel_angle_e     equ     5178h                   ;*(2913:5178=0)
     = 5179                     data_198e       equ     5179h                   ;*(2913:5179=0)
     = 5199                     data_199e       equ     5199h                   ;*(2913:5199=0)
     = 51B9                     data_200e       equ     51B9h                   ;*(2913:51B9=0)
     = 51D9                     data_201e       equ     51D9h                   ;*(2913:51D9=0)
     = 51F9                     data_202e       equ     51F9h                   ;*(2913:51F9=0)
     = 5219                     data_203e       equ     5219h                   ;*(2913:5219=0)
     = 521A                     data_204e       equ     521Ah                   ;*(2913:521A=0)
     = 5220                     data_205e       equ     5220h                   ;*(2913:5220=0)
     = 5226                     data_206e       equ     5226h                   ;*(2913:5226=0)
     = 522C                     data_207e       equ     522Ch                   ;*(2913:522C=0)
     = 523E                     data_208e       equ     523Eh                   ;*(2913:523E=0)
     = 5240                     data_209e       equ     5240h                   ;*(2913:5240=0)
     = 529D                     data_210e       equ     529Dh                   ;*(2913:529D=0)
     = 52E6                     data_211e       equ     52E6h                   ;*(2913:52E6=0)
     = 52EC                     data_212e       equ     52ECh                   ;*(2913:52EC=0)
     = 5300                     data_213e       equ     5300h                   ;*(2913:5300=0)
     = 538E                     data_214e       equ     538Eh                   ;*(2913:538E=0)
     = 5394                     data_215e       equ     5394h                   ;*(2913:5394=0)
     = 53A8                     data_216e       equ     53A8h                   ;*(2913:53A8=0)
     = 5436                     data_217e       equ     5436h                   ;*(2913:5436=0)
     = 5455                     data_218e       equ     5455h                   ;*(2913:5455=0)
     = 545D                     data_219e       equ     545Dh                   ;*(2913:545D=0)
     = 545E                     data_220e       equ     545Eh                   ;*(2913:545E=0)
     = 545F                     data_221e       equ     545Fh                   ;*(2913:545F=0)
     = 5467                     data_222e       equ     5467h                   ;*(2913:5467=0)
     = 5487                     data_223e       equ     5487h                   ;*(2913:5487=0)
     = 54B8                     data_224e       equ     54B8h                   ;*(2913:54B8=0)
     = 54E0                     data_225e       equ     54E0h                   ;*(2913:54E0=0)
     = 5509                     data_226e       equ     5509h                   ;*(2913:5509=0)
     = 06FD                     data_227e       equ     6FDh                    ; (A000:06FD=0)
     = 0D85                     data_228e       equ     0D85h                   ; (A000:0D85=0)
     = 0E59                     ofs_33x91_e     equ     0E59h                   ; (A000:0E59=0)
     = 0E6D                     data_229e       equ     0E6Dh                   ; (A000:0E6D=0)
     = 0FEA                     data_230e       equ     0FEAh                   ; (A000:0FEA=0)
     = 2000                     data_231e       equ     2000h                   ; (A000:2000=0)

                                seg_a           segment byte public
                                                assume  cs:seg_a, ds:seg_a


                                                org     100h

                                BOLO            proc    far

2913:0100                       start:
2913:0100  8B C4                                mov     ax,sp
2913:0102  3D 555A                              cmp     ax,555Ah
2913:0105  73 06                                jae     loc_1
2913:0107 .BA 02FA                              mov     dx,offset msg_nomem     ; (2913:02FA='Not enough memor')
2913:010A  E9 01A7                              jmp     exit_print              ; (02B4)
2913:010D                       loc_1:                                          ;  xref 2913:0105
2913:010D  33 C9                                xor     cx,cx
2913:010F  8E D9                                mov     ds,cx
2913:0111  38 0E 0487                           cmp     ds:video_options_,cl    ; (0000:0487=60h)
2913:0115  75 06                                jne     loc_2
2913:0117 .BA 030E                              mov     dx,offset msg_noega     ; (2913:030E='EGA/VGA required')
2913:011A  E9 0197                              jmp     exit_print              ; (02B4)
2913:011D                       loc_2:                                          ;  xref 2913:0115
2913:011D .BE 0020                              mov     si,data_1e              ; (0000:0020=0A5h)
2913:0120 .BF 4F8D                              mov     di,orig_int8_e          ; (2913:4F8D=0)
2913:0123  B1 04                                mov     cl,4
2913:0125  FC                                   cld
2913:0126  F3/ A5                               rep     movsw
2913:0128  B1 20                                mov     cl,20h                  ; ' '
2913:012A .BF 2F68                              mov     di,offset rnd_state     ; (2913:2F68=0Bh)

2913:012D                       locloop_3:                                      ;  xref 2913:0136
2913:012D  F6 C1 03                             test    cl,3
2913:0130  75 03                                jnz     loc_4
2913:0132 .BE 046C                              mov     si,timer_low_           ; (0000:046C=24h)
2913:0135                       loc_4:                                          ;  xref 2913:0130
2913:0135  A4                                   movsb
2913:0136  E2 F5                                loop    locloop_3

2913:0138  A0 046C                              mov     al,ds:timer_low_        ; (0000:046C=24h)
2913:013B  0E                                   push    cs
2913:013C  1F                                   pop     ds
2913:013D  24 1F                                and     al,1Fh
2913:013F  A2 2F88                              mov     ds:time_5bit_e,al       ; (2913:2F88=0)
2913:0142  B8 2508                              mov     ax,2508h
2913:0145 .BA 02C8                              mov     dx,offset int_08h_entry
2913:0148  CD 21                                int     21h                     ; DOS Services  ah=function 25h
                                                                                ;  set intrpt vector al to ds:dx
2913:014A  40                                   inc     ax
2913:014B .BA 062D                              mov     dx,offset int_09h_entry
2913:014E  CD 21                                int     21h                     ; DOS Services  ah=function 25h
                                                                                ;  set intrpt vector al to ds:dx
2913:0150  B8 000D                              mov     ax,0Dh
2913:0153  E8 017C                              call    call_int10              ; (02D2)
2913:0156  E8 103B                              call    title_screen            ; (1194)
2913:0159                       die_loc:                                        ;  xref 2913:0277, 068C
2913:0159 ,BC 0159                              mov     sp,159h
2913:015C  E8 1BB8                              call    update_hisco            ; (1D17)
2913:015F  E8 1097                              call    draw_hud                ; (11F9)
2913:0162  E8 10FE                              call    draw_levsel             ; (1263)
2913:0165  E8 1155                              call    edit_levdens            ; (12BD)
2913:0168  06                                   push    es
2913:0169  1E                                   push    ds
2913:016A  07                                   pop     es
2913:016B  B9 0005                              mov     cx,5
2913:016E  88 0E 4F96                           mov     ds:lives_e,cl           ; (2913:4F96=0)
2913:0172 .BF 2F56                              mov     di,offset strb_score    ; (2913:2F56=25h)
2913:0175  B0 25                                mov     al,25h                  ; '%'
2913:0177  F3/ AA                               rep     stosb
2913:0179  88 2D                                mov     [di],ch
2913:017B  B9 002A                              mov     cx,2Ah
2913:017E .BF 506D                              mov     di,data_193e            ; (2913:506D=0)
2913:0181  B0 03                                mov     al,3
2913:0183  F3/ AA                               rep     stosb
2913:0185  38 2E 0973                           cmp     lastkey_tick,ch         ; (2913:0973=0)
2913:0189  74 0F                                je      loc_6
2913:018B .BF 2F68                              mov     di,offset rnd_state     ; (2913:2F68=0Bh)
2913:018E  B1 20                                mov     cl,20h                  ; ' '
2913:0190  32 C0                                xor     al,al

2913:0192                       locloop_5:                                      ;  xref 2913:0194
2913:0192  AA                                   stosb
2913:0193  40                                   inc     ax
2913:0194  E2 FC                                loop    locloop_5

2913:0196  88 2E 2F88                           mov     ds:time_5bit_e,ch       ; (2913:2F88=0)
2913:019A                       loc_6:                                          ;  xref 2913:0189
2913:019A  07                                   pop     es
2913:019B                       loc_7:                                          ;  xref 2913:0220
2913:019B ,E8 01D9                              call    gen_maze                ; (0377)
2913:019E  E8 1BB9                              call    sub_32                  ; (1D5A)
2913:01A1  C6 06 4F9A 28                        mov     byte ptr ds:data_187e,28h ; (2913:4F9A=0) '('
2913:01A6  90                                   nop
2913:01A7 .BF 5043                              mov     di,coll_flags1_e        ; (2913:5043=0)
2913:01AA  B9 002A                              mov     cx,2Ah
2913:01AD  B0 FF                                mov     al,0FFh
2913:01AF  F3/ AA                               rep     stosb
2913:01B1 .BF 51F9                              mov     di,data_202e            ; (2913:51F9=0)
2913:01B4  B1 20                                mov     cl,20h                  ; ' '
2913:01B6  40                                   inc     ax
2913:01B7  F3/ AA                               rep     stosb
2913:01B9  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:01BC  04 14                                add     al,14h
2913:01BE                       loc_8:                                          ;  xref 2913:01C2
2913:01BE  3A 06 2F67                           cmp     al,time_tick            ; (2913:2F67=0)
2913:01C2  75 FA                                jne     loc_8
2913:01C4                       loc_9:                                          ;  xref 2913:027A
2913:01C4 ,E8 1032                              call    draw_hud                ; (11F9)
2913:01C7  E8 0C2A                              call    sub_17                  ; (0DF4)
2913:01CA  06                                   push    es
2913:01CB  1E                                   push    ds
2913:01CC  07                                   pop     es
2913:01CD  B1 20                                mov     cl,20h                  ; ' '
2913:01CF .BF 51B9                              mov     di,data_200e            ; (2913:51B9=0)
2913:01D2  B0 FF                                mov     al,0FFh
2913:01D4  F3/ AA                               rep     stosb
2913:01D6  32 C0                                xor     al,al
2913:01D8  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:01DB  A2 5043                              mov     ds:coll_flags1_e,al     ; (2913:5043=0)
2913:01DE  A2 5219                              mov     ds:data_203e,al         ; (2913:5219=0)
2913:01E1  A2 51F9                              mov     ds:data_202e,al         ; (2913:51F9=0)
2913:01E4  A2 4F99                              mov     ds:fuel_disp_e,al       ; (2913:4F99=0)
2913:01E7  07                                   pop     es
2913:01E8  E8 0AE7                              call    sub_16                  ; (0CD2)
2913:01EB  E8 0999                              call    sub_15                  ; (0B87)
2913:01EE                       loc_10:                                         ;  xref 2913:029D
2913:01EE ,B9 0006                              mov     cx,6
2913:01F1 .BB 521A                              mov     bx,data_204e            ; (2913:521A=0)

2913:01F4                       locloop_11:                                     ;  xref 2913:01FA
2913:01F4  80 3F FF                             cmp     byte ptr [bx],0FFh
2913:01F7  75 2A                                jne     loc_14
2913:01F9  43                                   inc     bx
2913:01FA  E2 F8                                loop    locloop_11

2913:01FC  E8 0FFA                              call    draw_hud                ; (11F9)
2913:01FF  80 3E 4F96 05                        cmp     byte ptr ds:lives_e,5   ; (2913:4F96=0)
2913:0204  73 04                                jae     loc_12
2913:0206  FE 06 4F96                           inc     byte ptr ds:lives_e     ; (2913:4F96=0)
2913:020A                       loc_12:                                         ;  xref 2913:0204
2913:020A  B4 0D                                mov     ah,0Dh
2913:020C  E8 00B2                              call    ega_map_mask            ; (02C1)
2913:020F .BE 10ED                              mov     si,offset win_ofs       ; (2913:10ED=87h)
2913:0212  E8 0DE9                              call    draw_mstrs              ; (0FFE)
2913:0215  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:0218  04 32                                add     al,32h                  ; '2'
2913:021A                       loc_13:                                         ;  xref 2913:021E
2913:021A  3A 06 2F67                           cmp     al,time_tick            ; (2913:2F67=0)
2913:021E  75 FA                                jne     loc_13
2913:0220  E9 FF78                              jmp     loc_7                   ; (019B)
2913:0223                       loc_14:                                         ;  xref 2913:01F7
2913:0223  E8 046C                              call    handle_kbd              ; (0692)
2913:0226  E8 02A1                              call    clr_alt_box             ; (04CA)
2913:0229  E8 07BB                              call    sub_13                  ; (09E7)
2913:022C  E8 24BE                              call    sub_48                  ; (26ED)
2913:022F  E8 146A                              call    sub_21                  ; (169C)
2913:0232  E8 123E                              call    sub_18                  ; (1473)
2913:0235  E8 0316                              call    sub_10                  ; (054E)
2913:0238  BA 03CE                              mov     dx,3CEh
2913:023B  B8 1003                              mov     ax,1003h
2913:023E  EF                                   out     dx,ax                   ; port 3CEh, EGA graphic index
                                                                                ;  al = 3, data rotate
2913:023F  E8 1A32                              call    sub_30                  ; (1C74)
2913:0242  E8 1D7A                              call    sub_36                  ; (1FBF)
2913:0245  E8 2285                              call    sub_47                  ; (24CD)
2913:0248  80 3E 5043 00                        cmp     byte ptr ds:coll_flags1_e,0 ; (2913:5043=0)
2913:024D  75 03                                jne     loc_15
2913:024F  E8 0AD0                              call    draw_ship               ; (0D22)
2913:0252                       loc_15:                                         ;  xref 2913:024D
2913:0252  E8 13CE                              call    sub_20                  ; (1623)
2913:0255  BA 03CE                              mov     dx,3CEh
2913:0258  B8 0003                              mov     ax,3
2913:025B  EF                                   out     dx,ax                   ; port 3CEh, EGA graphic index
                                                                                ;  al = 3, data rotate
2913:025C  80 3E 5043 FE                        cmp     byte ptr ds:coll_flags1_e,0FEh ; (2913:5043=0)
2913:0261  74 0E                                je      loc_16
2913:0263  32 C0                                xor     al,al
2913:0265  38 06 5097                           cmp     ds:data_194e,al         ; (2913:5097=0)
2913:0269  74 12                                je      loc_18
2913:026B  FE 0E 5097                           dec     byte ptr ds:data_194e   ; (2913:5097=0)
2913:026F  75 1D                                jnz     loc_19
2913:0271                       loc_16:                                         ;  xref 2913:0261
2913:0271  FE 0E 4F96                           dec     byte ptr ds:lives_e     ; (2913:4F96=0)
2913:0275  75 03                                jnz     loc_17
2913:0277  E9 FEDF                              jmp     die_loc                 ; (0159)
2913:027A                       loc_17:                                         ;  xref 2913:0275
2913:027A  E9 FF47                              jmp     loc_9                   ; (01C4)
2913:027D                       loc_18:                                         ;  xref 2913:0269
2913:027D  38 06 5043                           cmp     ds:coll_flags1_e,al     ; (2913:5043=0)
2913:0281  74 0B                                je      loc_19
2913:0283  A2 50B7                              mov     ds:vel_magn_e,al        ; (2913:50B7=0)
2913:0286  79 06                                jns     loc_19
2913:0288  C6 06 5097 0A                        mov     byte ptr ds:data_194e,0Ah ; (2913:5097=0)
2913:028D  90                                   nop
2913:028E                       loc_19:                                         ;  xref 2913:026F, 0281, 0286, 0295
2913:028E  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:0291  38 06 4F8C                           cmp     ds:data_185e,al         ; (2913:4F8C=0)
2913:0295  74 F7                                je      loc_19
2913:0297  A2 4F8C                              mov     ds:data_185e,al         ; (2913:4F8C=0)
2913:029A  E8 0269                              call    flip_vp                 ; (0506)
2913:029D  E9 FF4E                              jmp     loc_10                  ; (01EE)


                                ;     Restore int 8, int 9, set text mode, print msg_exit and terminate.
2913:02A0                       clean_exit:                                     ;  xref 2913:067D
2913:02A0 ,C5 16 4F8D                           lds     dx,dword ptr ds:orig_int8_e ; (2913:4F8D=0)
2913:02A4  B8 2508                              mov     ax,2508h
2913:02A7  CD 21                                int     21h                     ; DOS Services  ah=function 25h
                                                                                ;  set intrpt vector al to ds:dx
2913:02A9  40                                   inc     ax
2913:02AA  2E: C5 16 4F91                       lds     dx,dword ptr cs:orig_int9_e ; (2913:4F91=0)
2913:02AF  CD 21                                int     21h                     ; DOS Services  ah=function 25h
                                                                                ;  set intrpt vector al to ds:dx
2913:02B1 .BA 02DC                              mov     dx,offset msg_exit      ; (2913:02DC='Exiting BOLO. Ru')
2913:02B4                       exit_print:                                     ;  xref 2913:010A, 011A
2913:02B4  0E                                   push    cs
2913:02B5  1F                                   pop     ds
2913:02B6  B8 0003                              mov     ax,3
2913:02B9  CD 10                                int     10h                     ; Video display   ah=functn 00h
                                                                                ;  set display mode in al
2913:02BB  B4 09                                mov     ah,9
2913:02BD  CD 21                                int     21h                     ; DOS Services  ah=function 09h
                                                                                ;  display char string at ds:dx
2913:02BF  CD 20                                int     20h                     ; DOS program terminate

                                BOLO            endp

                                ;==========================================================================
                                ;         EGA map mask register = ah
                                ;
                                ;         Called from:   2913:020C, 0323, 04CC, 04ED, 0550, 0ACF, 0B1C
                                ;                             0B61, 0B8F, 0BFD, 0D24, 0DF6, 1043, 119B
                                ;                             1204, 1265, 127D, 1288, 12E8, 13BE, 1625
                                ;                             1C76, 1E05, 1E8E, 24D2
                                ;==========================================================================

2913:02C1                       ega_map_mask    proc    near
2913:02C1  B0 02                                mov     al,2
2913:02C3  BA 03C4                              mov     dx,3C4h
2913:02C6  EF                                   out     dx,ax                   ; port 3C4h, EGA sequencr index
                                                                                ;  al = 2, map mask register
2913:02C7  C3                                   retn
                                ega_map_mask    endp


                                ;==========================================================================
                                ;
                                ;                       External Entry Point
                                ;
                                ;==========================================================================

2913:02C8                       int_08h_entry   proc    far                     ;  xref 2913:0145
2913:02C8  2E: FE 06 2F67                       inc     cs:time_tick            ; (2913:2F67=0)
2913:02CD  2E: FF 2E 4F8D                       jmp     dword ptr cs:orig_int8_e ; (2913:4F8D=0)
                                int_08h_entry   endp


                                ;==========================================================================
                                ;                          call_int10
                                ;
                                ;         Called from:   2913:0153, 06D3
                                ;==========================================================================

2913:02D2                       call_int10      proc    near
2913:02D2  CD 10                                int     10h                     ; Video display   ah=functn 00h
                                                                                ;  set display mode in al
2913:02D4  BA 03CE                              mov     dx,3CEh
2913:02D7  B8 0304                              mov     ax,304h
2913:02DA  EF                                   out     dx,ax                   ; port 3CEh, EGA graphic index
                                                                                ;  al = 4, read map select
2913:02DB  C3                                   retn
                                call_int10      endp

2913:02DC  45 78 69 74 69 6E    msg_exit        db      'Exiting BOLO. Run it again!', 0Dh ;  xref 2913:02B1
2913:02E2  67 20 42 4F 4C 4F
2913:02E8  2E 20 52 75 6E 20
2913:02EE  69 74 20 61 67 61
2913:02F4  69 6E 21 0D
2913:02F8  0A 24                                db      0Ah, '$'
2913:02FA  4E 6F 74 20 65 6E    msg_nomem       db      'Not enough memory', 0Dh, 0Ah, '$' ;  xref 2913:0107
2913:0300  6F 75 67 68 20 6D
2913:0306  65 6D 6F 72 79 0D
2913:030C  0A 24
2913:030E  45 47 41 2F 56 47    msg_noega       db      'EGA/VGA required', 0Dh, 0Ah, '$' ;  xref 2913:0117
2913:0314  41 20 72 65 71 75
2913:031A  69 72 65 64 0D 0A
2913:0320  24

                                ;==========================================================================
                                ;         Draw generating maze, clear tmp1_buf, init maze_buf
                                ;
                                ;         Called from:   2913:0377
                                ;==========================================================================

2913:0321                       init_maze       proc    near
2913:0321  B4 0F                                mov     ah,0Fh
2913:0323  E8 FF9B                              call    ega_map_mask            ; (02C1)
2913:0326  E8 0CBB                              call    draw_gmaze_22x7         ; (0FE4)
2913:0329  1E                                   push    ds
2913:032A  07                                   pop     es
2913:032B  32 C0                                xor     al,al
2913:032D .BF 2F89                              mov     di,tmp1_buf_e           ; (2913:2F89=0)
2913:0330  B9 1000                              mov     cx,1000h
2913:0333  F3/ AA                               rep     stosb
2913:0335 .BF 3F89                              mov     di,maze_buf_e           ; (2913:3F89=0)
2913:0338  B1 81                                mov     cl,81h
2913:033A  F3/ AA                               rep     stosb
2913:033C  B1 3D                                mov     cl,3Dh                  ; '='
2913:033E  B0 08                                mov     al,8
2913:0340  F3/ AA                               rep     stosb
2913:0342  33 C0                                xor     ax,ax
2913:0344  AB                                   stosw
2913:0345  B0 04                                mov     al,4
2913:0347  AA                                   stosb
2913:0348  B9 0E7D                              mov     cx,0E7Dh
2913:034B  B0 0F                                mov     al,0Fh
2913:034D  F3/ AA                               rep     stosb
2913:034F  33 C0                                xor     ax,ax
2913:0351  40                                   inc     ax
2913:0352  AB                                   stosw
2913:0353  48                                   dec     ax
2913:0354  AA                                   stosb
2913:0355  B1 3D                                mov     cl,3Dh                  ; '='
2913:0357  B0 02                                mov     al,2
2913:0359  F3/ AA                               rep     stosb
2913:035B  B1 82                                mov     cl,82h
2913:035D  32 C0                                xor     al,al
2913:035F  F3/ AA                               rep     stosb
2913:0361  33 C0                                xor     ax,ax
2913:0363  40                                   inc     ax
2913:0364  B3 04                                mov     bl,4
2913:0366 .BF 4087                              mov     di,data_182e            ; (2913:4087=0)
2913:0369  B1 39                                mov     cl,39h                  ; '9'

2913:036B                       locloop_20:                                     ;  xref 2913:0374
2913:036B  AB                                   stosw
2913:036C  86 C3                                xchg    al,bl
2913:036E  AA                                   stosb
2913:036F  86 C3                                xchg    al,bl
2913:0371  83 C7 3D                             add     di,3Dh
2913:0374  E2 F5                                loop    locloop_20

2913:0376  C3                                   retn
                                init_maze       endp


                                ;==========================================================================
                                ;         Populate the maze using the random generator
                                ;
                                ;         Called from:   2913:019B
                                ;==========================================================================

2913:0377                       gen_maze        proc    near
2913:0377  E8 FFA7                              call    init_maze               ; (0321)
2913:037A  B9 0DD1                              mov     cx,0DD1h
2913:037D  E8 2B98                              call    maze_rnd_xy             ; (2F18)

2913:0380                       locloop_21:                                     ;  xref 2913:03D4, 03F2
2913:0380 ,32 DB                                xor     bl,bl
2913:0382  B7 0F                                mov     bh,0Fh
2913:0384  80 FE 3C                             cmp     dh,3Ch                  ; '<'
2913:0387  74 08                                je      loc_22
2913:0389  38 7C 40                             cmp     [si+40h],bh
2913:038C  72 03                                jb      loc_22
2913:038E  80 CB 08                             or      bl,8
2913:0391                       loc_22:                                         ;  xref 2913:0387, 038C
2913:0391  80 FA 3D                             cmp     dl,3Dh                  ; '='
2913:0394  74 08                                je      loc_23
2913:0396  38 7C 01                             cmp     [si+1],bh
2913:0399  72 03                                jb      loc_23
2913:039B  80 CB 04                             or      bl,4
2913:039E                       loc_23:                                         ;  xref 2913:0394, 0399
2913:039E  80 FE 04                             cmp     dh,4
2913:03A1  72 08                                jb      loc_24
2913:03A3  38 7C C0                             cmp     [si-40h],bh
2913:03A6  72 03                                jb      loc_24
2913:03A8  80 CB 02                             or      bl,2
2913:03AB                       loc_24:                                         ;  xref 2913:03A1, 03A6
2913:03AB  80 FA 02                             cmp     dl,2
2913:03AE  72 08                                jb      loc_25
2913:03B0  38 7C FF                             cmp     [si-1],bh
2913:03B3  72 03                                jb      loc_25
2913:03B5  80 CB 01                             or      bl,1
2913:03B8                       loc_25:                                         ;  xref 2913:03AE, 03B3
2913:03B8  84 DB                                test    bl,bl
2913:03BA  75 1A                                jnz     loc_29
2913:03BC                       loc_26:                                         ;  xref 2913:03D2
2913:03BC  42                                   inc     dx
2913:03BD  80 FA 3E                             cmp     dl,3Eh                  ; '>'
2913:03C0  75 0B                                jne     loc_28
2913:03C2  FE C6                                inc     dh
2913:03C4  80 FE 3D                             cmp     dh,3Dh                  ; '='
2913:03C7  75 02                                jne     loc_27
2913:03C9  B6 03                                mov     dh,3
2913:03CB                       loc_27:                                         ;  xref 2913:03C7
2913:03CB  B2 01                                mov     dl,1
2913:03CD                       loc_28:                                         ;  xref 2913:03C0
2913:03CD  E8 2B6C                              call    maze_readxy             ; (2F3C)
2913:03D0  38 3C                                cmp     [si],bh
2913:03D2  74 E8                                je      loc_26
2913:03D4  EB AA                                jmp     short locloop_21        ; (0380)
2913:03D6                       loc_29:                                         ;  xref 2913:03BA
2913:03D6  32 FF                                xor     bh,bh
2913:03D8  4B                                   dec     bx
2913:03D9  D0 E3                                shl     bl,1
2913:03DB  D0 E3                                shl     bl,1
2913:03DD .81 C3 0414                           add     bx,offset data_11       ; (2913:0414=4)
2913:03E1                       loc_30:                                         ;  xref 2913:03EC
2913:03E1  B0 04                                mov     al,4
2913:03E3  E8 2AEB                              call    rnd_update              ; (2ED1)
2913:03E6  D7                                   xlat
2913:03E7  98                                   cbw
2913:03E8  D1 E0                                shl     ax,1
2913:03EA  8B F8                                mov     di,ax
2913:03EC  74 F3                                jz      loc_30
2913:03EE  FF 95 0450                           call    word ptr data_12[di]    ;*(2913:0450=4A2h)   5 entries
2913:03F2  E2 8C                                loop    locloop_21

2913:03F4  32 FF                                xor     bh,bh
2913:03F6  8A 1E 2F55                           mov     bl,density              ; (2913:2F55=0)
2913:03FA  D1 E3                                shl     bx,1
2913:03FC  8B 8F 045A                           mov     cx,data_17[bx]          ; (2913:045A=1B8Ah)

2913:0400                       locloop_31:                                     ;  xref 2913:0411
2913:0400  E8 2B15                              call    maze_rnd_xy             ; (2F18)
2913:0403  B0 04                                mov     al,4
2913:0405  E8 2AC9                              call    rnd_update              ; (2ED1)
2913:0408  98                                   cbw
2913:0409  D1 E0                                shl     ax,1
2913:040B  8B D8                                mov     bx,ax
2913:040D  FF 97 0464                           call    word ptr data_18[bx]    ;*(2913:0464=4BDh)   4 entries
2913:0411  E2 ED                                loop    locloop_31

2913:0413  C3                                   retn
                                gen_maze        endp

                                                                                ; Inter-segment boundary
2913:0414  04 04 04 04 03 03    data_11         db      4, 4, 4, 4, 3, 3        ;  xref 2913:03DD
2913:041A  03 03 03 04 04 03                    db      3, 3, 3, 4, 4, 3
2913:0420  02 02 02 02 04 02                    db      2, 2, 2, 2, 4, 2
2913:0426  02 04 02 03 03 02                    db      2, 4, 2, 3, 3, 2
2913:042C  02 03 04 00 01 01                    db      2, 3, 4, 0, 1, 1
2913:0432  01 01 01 04 01 04                    db      1, 1, 1, 4, 1, 4
2913:0438  03 01 01 03 01 00                    db      3, 1, 1, 3, 1, 0
2913:043E  03 04 02 01 01 02                    db      3, 4, 2, 1, 1, 2
2913:0444  04 02 00 01 03 01                    db      4, 2, 0, 1, 3, 1
2913:044A  02 00 01 02 03 04                    db      2, 0, 1, 2, 3, 4
2913:0450  04A2                 data_12         dw      offset sub_6            ; Data table (indexed access) (04A2)
                                                                                ;  xref 2913:03EE
2913:0452  048A                                 dw      offset sub_4            ; (048A)
2913:0454  0481                                 dw      offset sub_3            ; (0481)
2913:0456  0475                                 dw      offset sub_2            ; (0475)
2913:0458  046C                                 dw      offset sub_1            ; (046C)
2913:045A  1B8A 1608 1086       data_17         dw      1B8Ah, 1608h, 1086h     ; Data table (indexed access)
                                                                                ;  xref 2913:03FC
2913:0460  0B04 0582                            dw      0B04h, 582h
2913:0464  04BD                 data_18         dw      offset sub_9            ; Data table (indexed access) (04BD)
                                                                                ;  xref 2913:040D
2913:0466  04B0                                 dw      offset sub_8            ; (04B0)
2913:0468  04A3                                 dw      offset sub_7            ; (04A3)
2913:046A  0496                                 dw      offset sub_5            ; (0496)
                                                                                ; Inter-segment boundary

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:03EE, 0458
                                ;==========================================================================

2913:046C                       sub_1           proc    near
2913:046C  80 24 0E                             and     byte ptr [si],0Eh
2913:046F  4E                                   dec     si
2913:0470  4A                                   dec     dx
2913:0471  80 24 0B                             and     byte ptr [si],0Bh
2913:0474  C3                                   retn
                                sub_1           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:03EE, 0456
                                ;==========================================================================

2913:0475                       sub_2           proc    near
2913:0475  80 24 0D                             and     byte ptr [si],0Dh
2913:0478  83 EE 40                             sub     si,40h
2913:047B  FE CE                                dec     dh
2913:047D  80 24 07                             and     byte ptr [si],7
2913:0480  C3                                   retn
                                sub_2           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:03EE, 0454
                                ;==========================================================================

2913:0481                       sub_3           proc    near
2913:0481  80 24 0B                             and     byte ptr [si],0Bh
2913:0484  46                                   inc     si
2913:0485  42                                   inc     dx
2913:0486  80 24 0E                             and     byte ptr [si],0Eh
2913:0489  C3                                   retn
                                sub_3           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:03EE, 0452
                                ;==========================================================================

2913:048A                       sub_4           proc    near
2913:048A  80 24 07                             and     byte ptr [si],7
2913:048D  83 C6 40                             add     si,40h
2913:0490  FE C6                                inc     dh
2913:0492  80 24 0D                             and     byte ptr [si],0Dh
2913:0495  C3                                   retn
                                sub_4           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:040D, 046A
                                ;==========================================================================

2913:0496                       sub_5           proc    near
2913:0496  80 FA 01                             cmp     dl,1
2913:0499  74 07                                je      loc_ret_32
2913:049B  80 24 0E                             and     byte ptr [si],0Eh
2913:049E  80 64 FF 0B                          and     byte ptr [si-1],0Bh

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:03EE, 0450

2913:04A2                       sub_6:

2913:04A2                       loc_ret_32:                                     ;  xref 2913:0499, 04A6, 04B3, 04C0
2913:04A2  C3                                   retn
                                sub_5           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:040D, 0468
                                ;==========================================================================

2913:04A3                       sub_7           proc    near
2913:04A3  80 FE 03                             cmp     dh,3
2913:04A6  74 FA                                je      loc_ret_32
2913:04A8  80 24 0D                             and     byte ptr [si],0Dh
2913:04AB  80 64 C0 07                          and     byte ptr [si-40h],7
2913:04AF  C3                                   retn
                                sub_7           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:040D, 0466
                                ;==========================================================================

2913:04B0                       sub_8           proc    near
2913:04B0  80 FA 3D                             cmp     dl,3Dh                  ; '='
2913:04B3  74 ED                                je      loc_ret_32
2913:04B5  80 24 0B                             and     byte ptr [si],0Bh
2913:04B8  80 64 01 0E                          and     byte ptr [si+1],0Eh
2913:04BC  C3                                   retn
                                sub_8           endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:040D, 0464
                                ;==========================================================================

2913:04BD                       sub_9           proc    near
2913:04BD  80 FE 3C                             cmp     dh,3Ch                  ; '<'
2913:04C0  74 E0                                je      loc_ret_32
2913:04C2  80 24 07                             and     byte ptr [si],7
2913:04C5  80 64 40 0D                          and     byte ptr [si+40h],0Dh
2913:04C9  C3                                   retn
                                sub_9           endp


                                ;==========================================================================
                                ;                                clr_alt_box
                                ;
                                ;     Clear the 0x0-224x194 pixel box in the alternative video page.
                                ;
                                ;         Called from:   2913:0226
                                ;==========================================================================

2913:04CA                       clr_alt_box     proc    near
2913:04CA  B4 0F                                mov     ah,0Fh
2913:04CC  E8 FDF2                              call    ega_map_mask            ; (02C1)
2913:04CF  A1 4F8A                              mov     ax,ds:dest_seg_e        ; (2913:4F8A=0)
2913:04D2  80 F4 02                             xor     ah,2
2913:04D5  8E C0                                mov     es,ax
2913:04D7  33 FF                                xor     di,di
2913:04D9  BA 00C2                              mov     dx,0C2h
2913:04DC  33 C0                                xor     ax,ax
2913:04DE  32 ED                                xor     ch,ch
2913:04E0                       loc_33:                                         ;  xref 2913:04E8
2913:04E0  B1 0E                                mov     cl,0Eh
2913:04E2  F3/ AB                               rep     stosw
2913:04E4  83 C7 0C                             add     di,0Ch
2913:04E7  4A                                   dec     dx
2913:04E8  75 F6                                jnz     loc_33
2913:04EA  C3                                   retn
                                clr_alt_box     endp


                                ;==========================================================================
                                ;         Clear both video pages and display page 0
                                ;
                                ;         Called from:   2913:11F9
                                ;==========================================================================

2913:04EB                       clear_vp0       proc    near
2913:04EB  B4 0F                                mov     ah,0Fh
2913:04ED  E8 FDD1                              call    ega_map_mask            ; (02C1)
2913:04F0  B8 A000                              mov     ax,0A000h
2913:04F3  8E C0                                mov     es,ax
2913:04F5  A3 4F8A                              mov     ds:dest_seg_e,ax        ; (2913:4F8A=0)
2913:04F8  33 FF                                xor     di,di
2913:04FA  33 C0                                xor     ax,ax
2913:04FC  B9 1F40                              mov     cx,1F40h
2913:04FF  F3/ AB                               rep     stosw
2913:0501  B4 05                                mov     ah,5
2913:0503  CD 10                                int     10h                     ; Video display   ah=functn 05h
                                                                                ;  set display page al
2913:0505  C3                                   retn
                                clear_vp0       endp


                                ;==========================================================================
                                ;         Flip the video page
                                ;
                                ;         Called from:   2913:029A
                                ;==========================================================================

2913:0506                       flip_vp         proc    near
2913:0506  32 E4                                xor     ah,ah
2913:0508  F6 06 4F8B 02                        test    byte ptr ds:dest_seg_e+1,2 ; (2913:4F8B=0)
2913:050D  90                                   nop
2913:050E  74 02                                jz      loc_34
2913:0510  B4 20                                mov     ah,20h                  ; ' '
2913:0512                       loc_34:                                         ;  xref 2913:050E
2913:0512  BA 03DA                              mov     dx,3DAh
2913:0515                       loc_35:                                         ;  xref 2913:0518
2913:0515  EC                                   in      al,dx                   ; port 3DAh, CGA/EGA vid status
2913:0516  A8 08                                test    al,8
2913:0518  74 FB                                jz      loc_35
2913:051A  B2 D4                                mov     dl,0D4h
2913:051C  B0 0C                                mov     al,0Ch
2913:051E  EF                                   out     dx,ax                   ; port 3D4h, CGA/EGA reg index
                                                                                ;  al = 0Ch, start address high
2913:051F  80 36 4F8B 02                        xor     byte ptr ds:dest_seg_e+1,2 ; (2913:4F8B=0)
2913:0524  C3                                   retn
                                flip_vp         endp


                                ;==========================================================================
                                ;                                vid_offset
                                ;     Inputs:
                                ;             CF:BL: 9-bit x
                                ;             BH:    y
                                ;     Outputs:
                                ;             DI: offset in video page (stride 40)
                                ;             AL: 1-bit mask of the pixel at the offset
                                ;     Preserve: BX, CX
                                ;     Calculate video offset and bitmask from x and y coordinates.
                                ;     x is 9 bit.
                                ;     offset = CF:BL/8 + BH*8+BH*32
                                ;     mask = 0x80 >> (CF:BL%8)
                                ;
                                ;         Called from:   2913:05F5, 0602, 0AD8, 0B46, 164B, 166F, 1976
                                ;                             1A48, 1E40, 1EF8, 1F6C, 2536
                                ;==========================================================================

2913:0525                       vid_offset      proc    near
2913:0525  51                                   push    cx
2913:0526  8A C3                                mov     al,bl
2913:0528  D0 D8                                rcr     al,1
2913:052A  D0 E8                                shr     al,1
2913:052C  D0 E8                                shr     al,1
2913:052E  98                                   cbw
2913:052F  8B F8                                mov     di,ax
2913:0531  8A C7                                mov     al,bh
2913:0533  D1 E0                                shl     ax,1
2913:0535  D1 E0                                shl     ax,1
2913:0537  D1 E0                                shl     ax,1
2913:0539  03 F8                                add     di,ax
2913:053B  D1 E0                                shl     ax,1
2913:053D  D1 E0                                shl     ax,1
2913:053F  03 F8                                add     di,ax
2913:0541  8A CB                                mov     cl,bl
2913:0543  80 E1 07                             and     cl,7
2913:0546  B0 80                                mov     al,80h
2913:0548  D2 E8                                shr     al,cl
2913:054A  32 E4                                xor     ah,ah
2913:054C  59                                   pop     cx
2913:054D  C3                                   retn
                                vid_offset      endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0235
                                ;==========================================================================

2913:054E                       sub_10          proc    near
2913:054E  B4 0F                                mov     ah,0Fh
2913:0550  E8 FD6E                              call    ega_map_mask            ; (02C1)
2913:0553  32 ED                                xor     ch,ch
2913:0555  8A 36 4FC5                           mov     dh,ds:data_189e         ; (2913:4FC5=0)
2913:0559  80 EE 03                             sub     dh,3
2913:055C  B7 13                                mov     bh,13h
2913:055E  2A 3E 5019                           sub     bh,ds:data_191e         ; (2913:5019=0)
2913:0562  79 05                                jns     loc_36
2913:0564  80 C7 26                             add     bh,26h                  ; '&'
2913:0567  FE C6                                inc     dh
2913:0569                       loc_36:                                         ;  xref 2913:0562
2913:0569  8A 16 4F9B                           mov     dl,ds:data_188e         ; (2913:4F9B=0)
2913:056D  80 EA 03                             sub     dl,3
2913:0570  B3 1F                                mov     bl,1Fh
2913:0572  2A 1E 4FEF                           sub     bl,ds:data_190e         ; (2913:4FEF=0)
2913:0576  79 05                                jns     loc_37
2913:0578  80 C3 26                             add     bl,26h                  ; '&'
2913:057B  FE C2                                inc     dl
2913:057D                       loc_37:                                         ;  xref 2913:0576
2913:057D  E8 29BC                              call    maze_readxy             ; (2F3C)
2913:0580  56                                   push    si
2913:0581  53                                   push    bx
2913:0582  8A CB                                mov     cl,bl
2913:0584  32 DB                                xor     bl,bl
2913:0586  E3 1F                                jcxz    loc_41
2913:0588                       loc_38:                                         ;  xref 2913:05B8
2913:0588  8A F7                                mov     dh,bh
2913:058A  8B EE                                mov     bp,si
2913:058C                       loc_39:                                         ;  xref 2913:05A1
2913:058C  8A D1                                mov     dl,cl
2913:058E  F6 04 08                             test    byte ptr [si],8
2913:0591  74 03                                jz      loc_40
2913:0593  E8 006C                              call    horiz_line              ; (0602)
2913:0596                       loc_40:                                         ;  xref 2913:0591
2913:0596  8A CA                                mov     cl,dl
2913:0598  80 C7 26                             add     bh,26h                  ; '&'
2913:059B  83 C6 40                             add     si,40h
2913:059E  80 FF C0                             cmp     bh,0C0h
2913:05A1  72 E9                                jb      loc_39
2913:05A3  8B F5                                mov     si,bp
2913:05A5  8A FE                                mov     bh,dh
2913:05A7                       loc_41:                                         ;  xref 2913:0586
2913:05A7  02 D9                                add     bl,cl
2913:05A9  B1 26                                mov     cl,26h                  ; '&'
2913:05AB  80 FB AA                             cmp     bl,0AAh
2913:05AE  72 04                                jb      loc_42
2913:05B0  B1 D0                                mov     cl,0D0h
2913:05B2  2A CB                                sub     cl,bl
2913:05B4                       loc_42:                                         ;  xref 2913:05AE
2913:05B4  46                                   inc     si
2913:05B5  80 FB D0                             cmp     bl,0D0h
2913:05B8  72 CE                                jb      loc_38
2913:05BA  5B                                   pop     bx
2913:05BB  5E                                   pop     si
2913:05BC  8A CF                                mov     cl,bh
2913:05BE  32 FF                                xor     bh,bh
2913:05C0  E3 1D                                jcxz    loc_46
2913:05C2                       loc_43:                                         ;  xref 2913:05F2
2913:05C2  8A F3                                mov     dh,bl
2913:05C4  8B EE                                mov     bp,si
2913:05C6                       loc_44:                                         ;  xref 2913:05D9
2913:05C6  8A D1                                mov     dl,cl
2913:05C8  F6 04 04                             test    byte ptr [si],4
2913:05CB  74 03                                jz      loc_45
2913:05CD  E8 0025                              call    vert_line               ; (05F5)
2913:05D0                       loc_45:                                         ;  xref 2913:05CB
2913:05D0  8A CA                                mov     cl,dl
2913:05D2  80 C3 26                             add     bl,26h                  ; '&'
2913:05D5  46                                   inc     si
2913:05D6  80 FB CD                             cmp     bl,0CDh
2913:05D9  76 EB                                jbe     loc_44
2913:05DB  8B F5                                mov     si,bp
2913:05DD  8A DE                                mov     bl,dh
2913:05DF                       loc_46:                                         ;  xref 2913:05C0
2913:05DF  02 F9                                add     bh,cl
2913:05E1  B1 26                                mov     cl,26h                  ; '&'
2913:05E3  80 FF 9A                             cmp     bh,9Ah
2913:05E6  72 04                                jb      loc_47
2913:05E8  B1 C0                                mov     cl,0C0h
2913:05EA  2A CF                                sub     cl,bh
2913:05EC                       loc_47:                                         ;  xref 2913:05E6
2913:05EC  83 C6 40                             add     si,40h
2913:05EF  80 FF BF                             cmp     bh,0BFh
2913:05F2  76 CE                                jbe     loc_43
2913:05F4  C3                                   retn
                                sub_10          endp


                                ;==========================================================================
                                ;                                vert_line
                                ;     Draw a vertical 1-pixel line
                                ;     Inputs:
                                ;             CF:BL: 9-bit x
                                ;             BH: y
                                ;             CX: number of rows - 1
                                ;             ES: dest segment
                                ;     Outputs: CX = 0
                                ;     Preserve: BX, DX
                                ;     Logical OR of ES:DI with 1 bit mask with stride 40 for CX + 1 rows.
                                ;
                                ;         Called from:   2913:05CD, 1334, 133B
                                ;==========================================================================

2913:05F5                       vert_line       proc    near
2913:05F5  E8 FF2D                              call    vid_offset              ; (0525)
2913:05F8  41                                   inc     cx

2913:05F9                       locloop_48:                                     ;  xref 2913:05FF
2913:05F9  26: 08 05                            or      es:[di],al
2913:05FC  83 C7 28                             add     di,28h
2913:05FF  E2 F8                                loop    locloop_48

2913:0601  C3                                   retn
                                vert_line       endp


                                ;==========================================================================
                                ;                                horiz_line
                                ;     Draw a horizontal 1-pixel width line
                                ;     Inputs:
                                ;             CF:BL: 9-bit x
                                ;             BH: y
                                ;             CX: length in pixels - 1
                                ;             ES: dest segment
                                ;     Outputs: CX = 0
                                ;     Preserve: BX, DX
                                ;
                                ;         Called from:   2913:0593, 1328, 132F
                                ;==========================================================================

2913:0602                       horiz_line      proc    near
2913:0602  E8 FF20                              call    vid_offset              ; (0525)
2913:0605  41                                   inc     cx
2913:0606                       loc_49:                                         ;  xref 2913:060E
2913:0606  E3 24                                jcxz    loc_ret_50
2913:0608  26: 08 05                            or      es:[di],al
2913:060B  49                                   dec     cx
2913:060C  D1 E8                                shr     ax,1
2913:060E  75 F6                                jnz     loc_49
2913:0610  47                                   inc     di
2913:0611  E3 19                                jcxz    loc_ret_50
2913:0613  8A E1                                mov     ah,cl
2913:0615  D1 E9                                shr     cx,1
2913:0617  D1 E9                                shr     cx,1
2913:0619  D1 E9                                shr     cx,1
2913:061B  B0 FF                                mov     al,0FFh
2913:061D  F3/ AA                               rep     stosb
2913:061F  8A CC                                mov     cl,ah
2913:0621  80 E1 07                             and     cl,7
2913:0624  98                                   cbw
2913:0625  32 C0                                xor     al,al
2913:0627  D3 E8                                shr     ax,cl
2913:0629  26: 08 05                            or      es:[di],al

2913:062C                       loc_ret_50:                                     ;  xref 2913:0606, 0611
2913:062C  C3                                   retn
                                horiz_line      endp


                                ;==========================================================================
                                ;
                                ;                       External Entry Point
                                ;
                                ;==========================================================================

2913:062D                       int_09h_entry   proc    far                     ;  xref 2913:014B
2913:062D  50                                   push    ax
2913:062E  E4 60                                in      al,60h                  ; port 60h, keybd scan or sw1
2913:0630  84 C0                                test    al,al
2913:0632  78 04                                js      loc_51
2913:0634  2E: A2 4F95                          mov     cs:kbdin_key_e,al       ; (2913:4F95=0)
2913:0638                       loc_51:                                         ;  xref 2913:0632
2913:0638  E4 61                                in      al,61h                  ; port 61h, 8255 port B, read
2913:063A  0C 80                                or      al,80h
2913:063C  E6 61                                out     61h,al                  ; port 61h, 8255 B - spkr, etc
2913:063E  24 7F                                and     al,7Fh
2913:0640  E6 61                                out     61h,al                  ; port 61h, 8255 B - spkr, etc
                                                                                ;  al = 0, speaker off
2913:0642  B0 20                                mov     al,20h                  ; ' '
2913:0644  E6 20                                out     20h,al                  ; port 20h, 8259-1 int command
                                                                                ;  al = 20h, end of interrupt
2913:0646  58                                   pop     ax
2913:0647  CF                                   iret
                                int_09h_entry   endp


                                ;==========================================================================
                                ;                                getkey
                                ;     Output:
                                ;             AL: scan code or 0
                                ;             ZF: test AL
                                ;     Performs some logic which I don't fully understand yet. This is
                                ;     what I understand. It reads kbdin_key_e (which is set by int 9)
                                ;     and clear it. Handles ESC, F1, F2, F3 directly and checks again.
                                ;     Otherwise returns the scancode in AL and updates ZF.
                                ;
                                ;         Called from:   2913:0692, 12FB
                                ;==========================================================================

2913:0648                       getkey          proc    near
2913:0648                       loc_52:                                         ;  xref 2913:06B6, 06BD
2913:0648 ,33 C0                                xor     ax,ax
2913:064A  38 06 0973                           cmp     lastkey_tick,al         ; (2913:0973=0)
2913:064E  74 25                                je      loc_54
2913:0650  38 06 4F95                           cmp     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:0654  74 0A                                je      loc_53
2913:0656  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:0659  A2 0973                              mov     lastkey_tick,al         ; (2913:0973=0)
2913:065C  B0 3D                                mov     al,3Dh                  ; '='
2913:065E  EB 19                                jmp     short loc_55            ; (0679)
2913:0660                       loc_53:                                         ;  xref 2913:0654
2913:0660  FE 0E 0970                           dec     data_89                 ; (2913:0970=1)
2913:0664  75 13                                jnz     loc_55
2913:0666  8B 36 0971                           mov     si,data_90              ; (2913:0971=974h)
2913:066A  AD                                   lodsw
2913:066B  88 26 0970                           mov     data_89,ah              ; (2913:0970=1)
2913:066F  89 36 0971                           mov     data_90,si              ; (2913:0971=974h)
2913:0673  EB 04                                jmp     short loc_55            ; (0679)
2913:0675                       loc_54:                                         ;  xref 2913:064E
2913:0675  86 06 4F95                           xchg    ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:0679                       loc_55:                                         ;  xref 2913:065E, 0664, 0673
2913:0679  3C 01                                cmp     al,1
2913:067B  75 03                                jne     loc_56

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:06A6, 0846

2913:067D                       sub_on_esc:
2913:067D  E9 FC20                              jmp     clean_exit              ; (02A0)
2913:0680                       loc_56:                                         ;  xref 2913:067B
2913:0680  3C 3B                                cmp     al,3Bh                  ; ';'
2913:0682  74 3B                                je      onkey_F1
2913:0684  3C 3C                                cmp     al,3Ch                  ; '<'
2913:0686  74 30                                je      onkey_F2
2913:0688  3C 3D                                cmp     al,3Dh                  ; '='
2913:068A  75 03                                jne     onkey_notF3

                                ;==== External Entry into Subroutine ======================================

2913:068C                       sub_11:
2913:068C  E9 FACA                              jmp     die_loc                 ; (0159)
2913:068F                       onkey_notF3:                                    ;  xref 2913:068A
2913:068F  84 C0                                test    al,al
2913:0691  C3                                   retn

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;                                handle_kbd
                                ;     If there is a key, and it is valid, and there hasn't been a
                                ;     collision, process the key by calling its kbd func.
                                ;
                                ;         Called from:   2913:0223

2913:0692                       handle_kbd:
2913:0692  E8 FFB3                              call    getkey                  ; (0648)
2913:0695  74 13                                jz      loc_ret_57
2913:0697  98                                   cbw
2913:0698  38 26 5043                           cmp     ds:coll_flags1_e,ah     ; (2913:5043=0)
2913:069C  75 0C                                jne     loc_ret_57
2913:069E  3C 53                                cmp     al,53h                  ; 'S'
2913:06A0  77 08                                ja      loc_ret_57
2913:06A2  D1 E0                                shl     ax,1
2913:06A4  8B D8                                mov     bx,ax
2913:06A6  FF 97 0844                           call    word ptr kbd_funcs[bx]  ;*(2913:0844=964h)   60 entries

2913:06AA                       loc_ret_57:                                     ;  xref 2913:0695, 069C, 06A0
2913:06AA  C3                                   retn

                                ;==== External Entry into Subroutine ======================================

2913:06AB                       sub_12:
2913:06AB  33 C0                                xor     ax,ax
2913:06AD                       loc_58:                                         ;  xref 2913:06B1
2913:06AD  38 06 4F95                           cmp     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:06B1  74 FA                                je      loc_58
2913:06B3  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:06B6  EB 90                                jmp     short loc_52            ; (0648)

                                ;==== External Entry into Subroutine ======================================

2913:06B8                       sub_onkey_F2:
2913:06B8                       onkey_F2:                                       ;  xref 2913:0686
2913:06B8  80 36 2F66 02                        xor     byte ptr data_181,2     ; (2913:2F66=2)
2913:06BD  EB 89                                jmp     short loc_52            ; (0648)
2913:06BF                       onkey_F1:                                       ;  xref 2913:0682
2913:06BF  B8 0502                              mov     ax,502h
2913:06C2  CD 10                                int     10h                     ; Video display   ah=functn 05h
                                                                                ;  set display page al
2913:06C4 .BE 06F7                              mov     si,offset data_25       ; (2913:06F7='')
2913:06C7  E8 0012                              call    bios_print              ; (06DC)
2913:06CA  B8 008D                              mov     ax,8Dh
2913:06CD                       loc_59:                                         ;  xref 2913:06D1
2913:06CD  38 26 4F95                           cmp     ds:kbdin_key_e,ah       ; (2913:4F95=0)
2913:06D1  74 FA                                je      loc_59
2913:06D3  E8 FBFC                              call    call_int10              ; (02D2)
2913:06D6  32 C0                                xor     al,al
2913:06D8  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:06DB  C3                                   retn
                                getkey          endp


                                ;==========================================================================
                                ;         Print $-term string from ds:si
                                ;
                                ;         Called from:   2913:06C7
                                ;==========================================================================

2913:06DC                       bios_print      proc    near
2913:06DC  B4 0E                                mov     ah,0Eh
2913:06DE  B3 0A                                mov     bl,0Ah
2913:06E0                       loc_60:                                         ;  xref 2913:06F4
2913:06E0 ,AC                                   lodsb
2913:06E1  3C 24                                cmp     al,24h                  ; '$'
2913:06E3  74 11                                je      loc_ret_62
2913:06E5  B9 0001                              mov     cx,1
2913:06E8  3C 09                                cmp     al,9
2913:06EA  75 04                                jne     locloop_61
2913:06EC  B1 08                                mov     cl,8
2913:06EE  B0 20                                mov     al,20h                  ; ' '

2913:06F0                       locloop_61:                                     ;  xref 2913:06EA, 06F2
2913:06F0  CD 10                                int     10h                     ; Video display   ah=functn 0Eh
                                                                                ;  write char al, teletype mode
2913:06F2  E2 FC                                loop    locloop_61

2913:06F4  EB EA                                jmp     short loc_60            ; (06E0)

2913:06F6                       loc_ret_62:                                     ;  xref 2913:06E3
2913:06F6  C3                                   retn
                                bios_print      endp

2913:06F7  0A 0A 09 45 73 63    data_25         db      0Ah, 0Ah, 9, 'Esc - quit', 0Dh, 0Ah ;  xref 2913:06C4, 12B6
2913:06FD  20 2D 20 71 75 69
2913:0703  74 0D 0A
2913:0706  0A 09 46 31 20 20                    db      0Ah, 9, 'F1  - this help', 0Dh, 0Ah
2913:070C  2D 20 74 68 69 73
2913:0712  20 68 65 6C 70 0D
2913:0718  0A
2913:0719  09 46 32 20 20 2D                    db      9, 'F2  - toggle sound', 0Dh, 0Ah
2913:071F  20 74 6F 67 67 6C
2913:0725  65 20 73 6F 75 6E
2913:072B  64 0D 0A
2913:072E  09 46 33 20 20 2D                    db      9, 'F3  - restart game', 0Dh, 0Ah
2913:0734  20 72 65 73 74 61
2913:073A  72 74 20 67 61 6D
2913:0740  65 0D 0A
2913:0743  09 46 31 30 20 2D                    db      9, 'F10 - pause', 0Dh, 0Ah, 0Ah, 9
2913:0749  20 70 61 75 73 65
2913:074F  0D 0A 0A 09
2913:0753  31 2D 39 20 20 20                    db      '1-9   - choose level', 0Dh, 0Ah, 9
2913:0759  2D 20 63 68 6F 6F
2913:075F  73 65 20 6C 65 76
2913:0765  65 6C 0D 0A 09
2913:076A  31 2D 35 20 20 20                    db      '1-5   - choose density', 0Dh, 0Ah
2913:0770  2D 20 63 68 6F 6F
2913:0776  73 65 20 64 65 6E
2913:077C  73 69 74 79 0D 0A
2913:0782  09 45 6E 74 65 72                    db      9, 'Enter - use current', 0Dh, 0Ah
2913:0788  20 2D 20 75 73 65
2913:078E  20 63 75 72 72 65
2913:0794  6E 74 0D 0A
2913:0798  0A 09 57 20 4F 20                    db      0Ah, 9, 'W O '
2913:079E  18                                   db      18h
2913:079F  09 2D 20 66 61 73                    db      9, '- faster', 0Dh, 0Ah, 9, 'X . '
2913:07A5  74 65 72 0D 0A 09
2913:07AB  58 20 2E 20
2913:07AF  19                                   db      19h
2913:07B0  09 2D 20 73 6C 6F                    db      9, '- slo'
2913:07B6  77 65 72 0D 0A 09                    db      'wer', 0Dh, 0Ah, 9, 'S L [5] End '
2913:07BC  53 20 4C 20 5B 35
2913:07C2  5D 20 45 6E 64 20
2913:07C8  20 2D 20 73 74 6F                    db      ' - stop', 0Dh, 0Ah, 9, 'A K ', 1Bh
2913:07CE  70 0D 0A 09 41 20
2913:07D4  4B 20 1B
2913:07D7  09 2D 20 74 75 72                    db      9, '- turn left', 0Dh, 0Ah, 9, 'D'
2913:07DD  6E 20 6C 65 66 74
2913:07E3  0D 0A 09 44
2913:07E7  20 3B 20                             db      ' ; '
2913:07EA  1A 09                                db       1Ah, 09h
2913:07EC  2D 20 74 75 72 6E    data_28         db      '- turn right', 0Dh, 0Ah, 9, '1 0'
2913:07F2  20 72 69 67 68 74
2913:07F8  0D 0A 09 31 20 30
2913:07FE  20 48 6F 6D 65 20                    db      ' Home     - gun left', 0Dh, 0Ah, 9
2913:0804  20 20 20 20 2D 20
2913:080A  67 75 6E 20 6C 65
2913:0810  66 74 0D 0A 09
2913:0815  32 20 2D 20 50 67                    db      '2 - PgDn     - gun right', 0Dh, 0Ah
2913:081B  44 6E 20 20 20 20
2913:0821  20 2D 20 67 75 6E
2913:0827  20 72 69 67 68 74
2913:082D  0D 0A
2913:082F  09 4F 74 68 65 72                    db      9, 'Other keys   - fire'
2913:0835  20 6B 65 79 73 20
2913:083B  20 20 2D 20 66 69
2913:0841  72 65
2913:0843  24                                   db      24h
2913:0844  0964                 kbd_funcs       dw      offset sub_on_fire      ; Handlers for each scan code
                                                                                ;  xref 2913:06A6
2913:0846  067D                                 dw      offset sub_on_esc       ; (067D)
2913:0848  0954                                 dw      offset sub_gunleft      ; (0954)
2913:084A  095A                                 dw      offset sub_gunright     ; (095A)
2913:084C  0964                                 dw      offset sub_on_fire      ; (0964)
2913:084E  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0850  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0852  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0854  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0856  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0858  0964                                 dw      offset sub_on_fire      ; (0964)
2913:085A  0954                                 dw      offset sub_gunleft      ; (0954)
2913:085C  095A                                 dw      offset sub_gunright     ; (095A)
2913:085E  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0860  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0862  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0864  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0866  08F4                                 dw      offset sub_on_faster    ; (08F4)
2913:0868  0964                                 dw      offset sub_on_fire      ; (0964)
2913:086A  0964                                 dw      offset sub_on_fire      ; (0964)
2913:086C  0964                                 dw      offset sub_on_fire      ; (0964)
2913:086E  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0870  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0872  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0874  08F4                                 dw      offset sub_on_faster    ; (08F4)
2913:0876  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0878  0964                                 dw      offset sub_on_fire      ; (0964)
2913:087A  0964                                 dw      offset sub_on_fire      ; (0964)
2913:087C  0964                                 dw      offset sub_on_fire      ; (0964)
2913:087E  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0880  0948                                 dw      offset sub_on_left      ; (0948)
2913:0882  08EC                                 dw      offset sub_on_stop      ; (08EC)
2913:0884  093A                                 dw      offset sub_on_right     ; (093A)
2913:0886  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0888  0964                                 dw      offset sub_on_fire      ; (0964)
2913:088A  0964                                 dw      offset sub_on_fire      ; (0964)
2913:088C  0964                                 dw      offset sub_on_fire      ; (0964)
2913:088E  0948                                 dw      offset sub_on_left      ; (0948)
2913:0890  08EC                                 dw      offset sub_on_stop      ; (08EC)
2913:0892  093A                                 dw      offset sub_on_right     ; (093A)
2913:0894  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0896  0964                                 dw      offset sub_on_fire      ; (0964)
2913:0898  0964                                 dw      offset sub_on_fire      ; (0964)
2913:089A  0964                                 dw      offset sub_on_fire      ; (0964)
2913:089C  0964                                 dw      offset sub_on_fire      ; (0964)
2913:089E  0915                                 dw      offset sub_on_slower    ; (0915)
2913:08A0  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08A2  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08A4  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08A6  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08A8  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08AA  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08AC  0915                                 dw      offset sub_on_slower    ; (0915)
2913:08AE  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08B0  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08B2  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08B4  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08B6  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08B8  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08BA  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08BC  06B8                                 dw      offset sub_onkey_F2     ; (06B8)
2913:08BE  068C                                 dw      offset sub_11           ; (068C)
2913:08C0  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08C2  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08C4  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08C6  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08C8  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08CA  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08CC  06AB                                 dw      offset sub_12           ; (06AB)
2913:08CE  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08D0  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08D2  0954                                 dw      offset sub_gunleft      ; (0954)
2913:08D4  08F4                                 dw      offset sub_on_faster    ; (08F4)
2913:08D6  095A                                 dw      offset sub_gunright     ; (095A)
2913:08D8  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08DA  0948                                 dw      offset sub_on_left      ; (0948)
2913:08DC  08EC                                 dw      offset sub_on_stop      ; (08EC)
2913:08DE  093A                                 dw      offset sub_on_right     ; (093A)
2913:08E0  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08E2  08EC                                 dw      offset sub_on_stop      ; (08EC)
2913:08E4  0915                                 dw      offset sub_on_slower    ; (0915)
2913:08E6  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08E8  0964                                 dw      offset sub_on_fire      ; (0964)
2913:08EA  0964                                 dw      offset sub_on_fire      ; (0964)

                                ;==========================================================================
                                ;                          sub_on_stop
                                ;
                                ;         Called from:   2913:06A6, 0882, 0890
                                ;==========================================================================

2913:08EC                       sub_on_stop     proc    near
2913:08EC  C6 06 50B7 00                        mov     byte ptr ds:vel_magn_e,0 ; (2913:50B7=0)
2913:08F1  90                                   nop
2913:08F2  EB 1A                                jmp     short loc_64            ; (090E)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;                                sub_on_faster
                                ;     Accelerate the ship.
                                ;     vel_magn_e  holds the velocity magnitude in the range [0..5]
                                ;     vel_angle_e holds the velocity angle: 0 (0 degrees) or 4 (180 degrees).
                                ;     vel_angle_e is relative to ship_angle_e, so the ship moves either fwd
                                ;     or backwards.
                                ;     The resulting vector varies between 5,0 (5 fwd) and 5, 4 (5 backwards).
                                ;     vel_magn_e is intended to be added to ship_angle_e.
                                ;
                                ;         Called from:   2913:06A6, 0866, 0874

2913:08F4                       sub_on_faster:
2913:08F4  80 3E 5178 04                        cmp     byte ptr ds:vel_angle_e,4 ; (2913:5178=0)
2913:08F9  74 0D                                je      loc_63
2913:08FB  80 3E 50B7 05                        cmp     byte ptr ds:vel_magn_e,5 ; (2913:50B7=0)
2913:0900  74 12                                je      loc_ret_65
2913:0902  FE 06 50B7                           inc     byte ptr ds:vel_magn_e  ; (2913:50B7=0)
2913:0906  EB 0C                                jmp     short loc_ret_65        ; (0914)
2913:0908                       loc_63:                                         ;  xref 2913:08F9
2913:0908  FE 0E 50B7                           dec     byte ptr ds:vel_magn_e  ; (2913:50B7=0)
2913:090C  75 06                                jnz     loc_ret_65
2913:090E                       loc_64:                                         ;  xref 2913:08F2
2913:090E  C6 06 5178 00                        mov     byte ptr ds:vel_angle_e,0 ; (2913:5178=0)
2913:0913  90                                   nop

2913:0914                       loc_ret_65:                                     ;  xref 2913:0900, 0906, 090C
2913:0914  C3                                   retn
                                sub_on_stop     endp


                                ;==========================================================================
                                ;                          sub_on_slower
                                ;
                                ;         Called from:   2913:06A6, 089E, 08AC
                                ;==========================================================================

2913:0915                       sub_on_slower   proc    near
2913:0915  80 3E 5178 00                        cmp     byte ptr ds:vel_angle_e,0 ; (2913:5178=0)
2913:091A  74 0D                                je      loc_66
2913:091C  80 3E 50B7 05                        cmp     byte ptr ds:vel_magn_e,5 ; (2913:50B7=0)
2913:0921  74 16                                je      loc_ret_67
2913:0923  FE 06 50B7                           inc     byte ptr ds:vel_magn_e  ; (2913:50B7=0)
2913:0927  EB 10                                jmp     short loc_ret_67        ; (0939)
2913:0929                       loc_66:                                         ;  xref 2913:091A
2913:0929  FE 0E 50B7                           dec     byte ptr ds:vel_magn_e  ; (2913:50B7=0)
2913:092D  79 0A                                jns     loc_ret_67
2913:092F  F6 1E 50B7                           neg     byte ptr ds:vel_magn_e  ; (2913:50B7=0)
2913:0933  C6 06 5178 04                        mov     byte ptr ds:vel_angle_e,4 ; (2913:5178=0)
2913:0938  90                                   nop

2913:0939                       loc_ret_67:                                     ;  xref 2913:0921, 0927, 092D
2913:0939  C3                                   retn
                                sub_on_slower   endp


                                ;==========================================================================
                                ;                          sub_on_right
                                ;
                                ;         Called from:   2913:06A6, 0884, 0892
                                ;==========================================================================

2913:093A                       sub_on_right    proc    near
2913:093A  FE 06 50D7                           inc     byte ptr ds:ship_angle_e ; (2913:50D7=0)
2913:093E  80 26 50D7 07                        and     byte ptr ds:ship_angle_e,7 ; (2913:50D7=0)
2913:0943  E8 02AF                              call    draw_comp_arr           ; (0BF5)
2913:0946  EB 12                                jmp     short loc_68            ; (095A)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:06A6, 0880, 088E

2913:0948                       sub_on_left:
2913:0948  FE 0E 50D7                           dec     byte ptr ds:ship_angle_e ; (2913:50D7=0)
2913:094C  80 26 50D7 07                        and     byte ptr ds:ship_angle_e,7 ; (2913:50D7=0)
2913:0951  E8 02A1                              call    draw_comp_arr           ; (0BF5)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:06A6, 0848, 085A

2913:0954                       sub_gunleft:
2913:0954  FE 0E 5177                           dec     byte ptr ds:gun_angle_e ; (2913:5177=0)
2913:0958  EB 04                                jmp     short loc_69            ; (095E)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:06A6, 084A, 085C

2913:095A                       sub_gunright:
2913:095A                       loc_68:                                         ;  xref 2913:0946
2913:095A  FE 06 5177                           inc     byte ptr ds:gun_angle_e ; (2913:5177=0)
2913:095E                       loc_69:                                         ;  xref 2913:0958
2913:095E  80 26 5177 07                        and     byte ptr ds:gun_angle_e,7 ; (2913:5177=0)
2913:0963  C3                                   retn
                                sub_on_right    endp


                                ;==========================================================================
                                ;                          sub_on_fire
                                ;
                                ;         Called from:   2913:06A6, 0844, 084C, 084E, 0850, 0852, 0854
                                ;                             0856, 0858, 085E, 0860, 0862, 0864, 0868
                                ;                             086A, 086C, 086E, 0870, 0872, 0876, 0878
                                ;                             087A, 087C, 087E, 0886, 0888, 088A, 088C
                                ;                             0894, 0896, 0898, 089A, 089C, 08A0, 08A2
                                ;                             08A4, 08A6, 08A8, 08AA, 08AE, 08B0, 08B2
                                ;                             08B4, 08B6, 08B8, 08BA
                                ;==========================================================================

2913:0964                       sub_on_fire     proc    near
2913:0964  80 3E 5219 00                        cmp     byte ptr ds:data_203e,0 ; (2913:5219=0)
2913:0969  75 04                                jne     loc_ret_70
2913:096B  FE 06 5219                           inc     byte ptr ds:data_203e   ; (2913:5219=0)

2913:096F                       loc_ret_70:                                     ;  xref 2913:0969
2913:096F  C3                                   retn
                                sub_on_fire     endp

2913:0970  01                   data_89         db      1                       ;  xref 2913:0660, 066B
2913:0971  0974                 data_90         dw      974h                    ;  xref 2913:0666, 066F
2913:0973  00                   lastkey_tick    db      0                       ; Perhaps the tick when we last
                                                                                ;  consumed a key
                                                                                ;  xref 2913:0185, 064A, 0659, 11F1
2913:0974  06 03 04 07 11 01                    db       06h, 03h, 04h, 07h, 11h, 01h
2913:097A  1E 01 11 01 11 11                    db       1Eh, 01h, 11h, 01h, 11h, 11h
2913:0980  20 0E 1E 25 1E 0C                    db       20h, 0Eh, 1Eh, 25h, 1Eh, 0Ch
2913:0986  20 0E 20 17 1E 01                    db       20h, 0Eh, 20h, 17h, 1Eh, 01h
2913:098C  1E 0B 20 0D 21 23                    db       1Eh, 0Bh, 20h, 0Dh, 21h, 23h
2913:0992  1E 0D 1F 01 03 01                    db       1Eh, 0Dh, 1Fh, 01h, 03h, 01h
2913:0998  21 0D 21 06 21 01                    db       21h, 0Dh, 21h, 06h, 21h, 01h
2913:099E  20 01 02 01 2D 01                    db       20h, 01h, 02h, 01h, 2Dh, 01h
2913:09A4  21 03 1F 05 21 07                    db       21h, 03h, 1Fh, 05h, 21h, 07h
2913:09AA  21 0B 21 0A 21 01                    db       21h, 0Bh, 21h, 0Ah, 21h, 01h
2913:09B0  20 01 20 01 2D 07                    db       20h, 01h, 20h, 01h, 2Dh, 07h
2913:09B6  21 03 1E 16 21 03                    db       21h, 03h, 1Eh, 16h, 21h, 03h
2913:09BC  11 01 11 1F 02 01                    db       11h, 01h, 11h, 1Fh, 02h, 01h
2913:09C2  21 02 1F 01 02 01                    db       21h, 02h, 1Fh, 01h, 02h, 01h
2913:09C8  02 01 02 01 02 06                    db       02h, 01h, 02h, 01h, 02h, 06h
2913:09CE  21 01 03 01 03 01                    db       21h, 01h, 03h, 01h, 03h, 01h
2913:09D4  03 01 03 01 21 06                    db       03h, 01h, 03h, 01h, 21h, 06h
2913:09DA  21 05 21 05 1E 03                    db       21h, 05h, 21h, 05h, 1Eh, 03h
2913:09E0  02 03 11 01 21 46                    db       02h, 03h, 11h, 01h, 21h, 46h
2913:09E6  01                                   db       01h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0229
                                ;==========================================================================

2913:09E7                       sub_13          proc    near
2913:09E7  8A 26 50D7                           mov     ah,ds:ship_angle_e      ; (2913:50D7=0)
2913:09EB  02 26 5178                           add     ah,ds:vel_angle_e       ; (2913:5178=0)
2913:09EF  80 E4 07                             and     ah,7
2913:09F2  A0 50B7                              mov     al,ds:vel_magn_e        ; (2913:50B7=0)
2913:09F5  D0 E0                                shl     al,1
2913:09F7  D0 E0                                shl     al,1
2913:09F9  D0 E0                                shl     al,1
2913:09FB  74 6B                                jz      loc_75
2913:09FD  02 C4                                add     al,ah
2913:09FF  98                                   cbw
2913:0A00  D1 E0                                shl     ax,1
2913:0A02  8B F0                                mov     si,ax
2913:0A04  8B 94 0A6C                           mov     dx,data_91[si]          ; (2913:0A6C=0)
2913:0A08  8A 1E 4F9B                           mov     bl,ds:data_188e         ; (2913:4F9B=0)
2913:0A0C  8A 3E 4FC5                           mov     bh,ds:data_189e         ; (2913:4FC5=0)
2913:0A10  B0 26                                mov     al,26h                  ; '&'
2913:0A12  00 16 4FEF                           add     ds:data_190e,dl         ; (2913:4FEF=0)
2913:0A16  78 12                                js      loc_71
2913:0A18  38 06 4FEF                           cmp     ds:data_190e,al         ; (2913:4FEF=0)
2913:0A1C  72 16                                jb      loc_72
2913:0A1E  FE 06 4F9B                           inc     byte ptr ds:data_188e   ; (2913:4F9B=0)
2913:0A22  28 06 4FEF                           sub     ds:data_190e,al         ; (2913:4FEF=0)
2913:0A26  FE C4                                inc     ah
2913:0A28  EB 0A                                jmp     short loc_72            ; (0A34)
2913:0A2A                       loc_71:                                         ;  xref 2913:0A16
2913:0A2A  00 06 4FEF                           add     ds:data_190e,al         ; (2913:4FEF=0)
2913:0A2E  FE 0E 4F9B                           dec     byte ptr ds:data_188e   ; (2913:4F9B=0)
2913:0A32  FE C4                                inc     ah
2913:0A34                       loc_72:                                         ;  xref 2913:0A1C, 0A28
2913:0A34  00 36 5019                           add     ds:data_191e,dh         ; (2913:5019=0)
2913:0A38  78 12                                js      loc_73
2913:0A3A  38 06 5019                           cmp     ds:data_191e,al         ; (2913:5019=0)
2913:0A3E  72 16                                jb      loc_74
2913:0A40  FE 06 4FC5                           inc     byte ptr ds:data_189e   ; (2913:4FC5=0)
2913:0A44  28 06 5019                           sub     ds:data_191e,al         ; (2913:5019=0)
2913:0A48  FE C4                                inc     ah
2913:0A4A  EB 0A                                jmp     short loc_74            ; (0A56)
2913:0A4C                       loc_73:                                         ;  xref 2913:0A38
2913:0A4C  00 06 5019                           add     ds:data_191e,al         ; (2913:5019=0)
2913:0A50  FE 0E 4FC5                           dec     byte ptr ds:data_189e   ; (2913:4FC5=0)
2913:0A54  FE C4                                inc     ah
2913:0A56                       loc_74:                                         ;  xref 2913:0A3E, 0A4A
2913:0A56  84 E4                                test    ah,ah
2913:0A58  74 0E                                jz      loc_75
2913:0A5A  E8 006F                              call    sub_14                  ; (0ACC)
2913:0A5D  E8 0127                              call    sub_15                  ; (0B87)
2913:0A60  53                                   push    bx
2913:0A61  E8 0068                              call    sub_14                  ; (0ACC)
2913:0A64  5A                                   pop     dx
2913:0A65  E8 1843                              call    sub_42                  ; (22AB)
2913:0A68                       loc_75:                                         ;  xref 2913:09FB, 0A58
2913:0A68  E8 00A9                              call    update_fuel             ; (0B14)
2913:0A6B  C3                                   retn
                                sub_13          endp

2913:0A6C  0000 0000 0000       data_91         dw      0, 0, 0                 ; Data table (indexed access)
                                                                                ;  xref 2913:0A04, 16B8, 27AA
2913:0A72  0000 0000 0000                       dw      0, 0, 0
2913:0A78  0000 0000                            dw      0, 0
2913:0A7C  FF00 FF01 0001       data_92         dw      0FF00h, 0FF01h, 1       ; Data table (indexed access)
                                                                                ;  xref 2913:163A
2913:0A82  0101 0100 01FF                       dw      101h, 100h, 1FFh
2913:0A88  00FF FFFF FE00                       dw      0FFh, 0FFFFh, 0FE00h
2913:0A8E  FE02 0002 0202                       dw      0FE02h, 2, 202h
2913:0A94  0200 02FE 00FE                       dw      200h, 2FEh, 0FEh
2913:0A9A  FEFE FD00 FD03                       dw      0FEFEh, 0FD00h, 0FD03h
2913:0AA0  0003 0303 0300                       dw      3, 303h, 300h
2913:0AA6  03FD 00FD FDFD                       dw      3FDh, 0FDh, 0FDFDh
2913:0AAC  FC00 FC04 0004                       dw      0FC00h, 0FC04h, 4
2913:0AB2  0404 0400 04FC                       dw      404h, 400h, 4FCh
2913:0AB8  00FC FCFC FB00                       dw      0FCh, 0FCFCh, 0FB00h
2913:0ABE  FB05 0005 0505                       dw      0FB05h, 5, 505h
2913:0AC4  0500 05FB 00FB                       dw      500h, 5FBh, 0FBh
2913:0ACA  FBFB                                 dw      0FBFBh

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0A5A, 0A61, 0D18
                                ;==========================================================================

2913:0ACC                       sub_14          proc    near
2913:0ACC  53                                   push    bx
2913:0ACD  B4 0B                                mov     ah,0Bh
2913:0ACF  E8 F7EF                              call    ega_map_mask            ; (02C1)
2913:0AD2  80 C7 7C                             add     bh,7Ch                  ; '|'
2913:0AD5  80 C3 E8                             add     bl,0E8h
2913:0AD8  E8 FA4A                              call    vid_offset              ; (0525)
2913:0ADB  BB A000                              mov     bx,0A000h
2913:0ADE  90                                   nop
2913:0ADF  8E DB                                mov     ds,bx
2913:0AE1 .BB 2000                              mov     bx,data_231e            ; (A000:2000=0)
2913:0AE4  30 05                                xor     [di],al
2913:0AE6  30 01                                xor     [bx+di],al
2913:0AE8  83 C7 50                             add     di,50h
2913:0AEB  30 05                                xor     [di],al
2913:0AED  30 01                                xor     [bx+di],al
2913:0AEF  83 EF 28                             sub     di,28h
2913:0AF2  30 05                                xor     [di],al
2913:0AF4  30 01                                xor     [bx+di],al
2913:0AF6  57                                   push    di
2913:0AF7  50                                   push    ax
2913:0AF8  D0 D0                                rcl     al,1
2913:0AFA  73 03                                jnc     loc_76
2913:0AFC  4F                                   dec     di
2913:0AFD  B0 01                                mov     al,1
2913:0AFF                       loc_76:                                         ;  xref 2913:0AFA
2913:0AFF  30 05                                xor     [di],al
2913:0B01  30 01                                xor     [bx+di],al
2913:0B03  58                                   pop     ax
2913:0B04  5F                                   pop     di
2913:0B05  D0 D8                                rcr     al,1
2913:0B07  73 03                                jnc     loc_77
2913:0B09  47                                   inc     di
2913:0B0A  B0 80                                mov     al,80h
2913:0B0C                       loc_77:                                         ;  xref 2913:0B07
2913:0B0C  30 05                                xor     [di],al
2913:0B0E  30 01                                xor     [bx+di],al
2913:0B10  0E                                   push    cs
2913:0B11  1F                                   pop     ds
2913:0B12  5B                                   pop     bx
2913:0B13  C3                                   retn
                                sub_14          endp


                                ;==========================================================================
                                ;                                update_fuel
                                ;     fuel_level_e:dw is the level of fuel, 16 bits
                                ;     fuel_disp_e:db  is the display representation, corresponding to the
                                ;             top 8 bits of fuel_level_e. fuel_disp_e follows fuel_level_e
                                ;             gradually (+1/-1 per update).
                                ;     Subtract double the velocity from the fuel level. If negative, display
                                ;     "OUT OF FUEL" and end level.
                                ;     Update fuel_disp_e with +1, 0, or -1 to move it towards hi(fuel_level_e).
                                ;     Render fuel_e on screen.
                                ;
                                ;         Called from:   2913:0A68
                                ;==========================================================================

2913:0B14                       update_fuel     proc    near
2913:0B14  06                                   push    es
2913:0B15  B8 A000                              mov     ax,0A000h
2913:0B18  8E C0                                mov     es,ax
2913:0B1A  B4 09                                mov     ah,9
2913:0B1C  E8 F7A2                              call    ega_map_mask            ; (02C1)
2913:0B1F  A0 50B7                              mov     al,ds:vel_magn_e        ; (2913:50B7=0)
2913:0B22  98                                   cbw
2913:0B23  D0 E0                                shl     al,1
2913:0B25  29 06 4F97                           sub     ds:fuel_level_e,ax      ; (2913:4F97=0)
2913:0B29  78 30                                js      out_of_fuel
2913:0B2B  B7 48                                mov     bh,48h                  ; 'H'
2913:0B2D  8A 1E 4F99                           mov     bl,ds:fuel_disp_e       ; (2913:4F99=0)
2913:0B31  3A 1E 4F98                           cmp     bl,byte ptr ds:fuel_level_e+1 ; (2913:4F98=0)
2913:0B35  74 22                                je      loc_80
2913:0B37  77 06                                ja      dec_fuel
2913:0B39  FE 06 4F99                           inc     byte ptr ds:fuel_disp_e ; (2913:4F99=0)
2913:0B3D  EB 04                                jmp     short loc_78            ; (0B43)
2913:0B3F                       dec_fuel:                                       ;  xref 2913:0B37
2913:0B3F  FE 0E 4F99                           dec     byte ptr ds:fuel_disp_e ; (2913:4F99=0)
2913:0B43                       loc_78:                                         ;  xref 2913:0B3D
2913:0B43  80 D3 E7                             adc     bl,0E7h
2913:0B46  E8 F9DC                              call    vid_offset              ; (0525)
2913:0B49  B9 000E                              mov     cx,0Eh

2913:0B4C                       locloop_79:                                     ;  xref 2913:0B57
2913:0B4C  26: 30 05                            xor     es:[di],al
2913:0B4F  26: 30 85 2000                       xor     es:data_231e[di],al     ; (A000:2000=0)
2913:0B54  83 C7 28                             add     di,28h
2913:0B57  E2 F3                                loop    locloop_79

2913:0B59                       loc_80:                                         ;  xref 2913:0B35
2913:0B59  07                                   pop     es
2913:0B5A  C3                                   retn
2913:0B5B                       out_of_fuel:                                    ; Fuel got negative
                                                                                ;  xref 2913:0B29
2913:0B5B  07                                   pop     es
2913:0B5C  E8 069A                              call    draw_hud                ; (11F9)
2913:0B5F  B4 0E                                mov     ah,0Eh
2913:0B61  E8 F75D                              call    ega_map_mask            ; (02C1)
2913:0B64 .BF 0E18                              mov     di,0E18h                ; (2913:0E18=0DEh)
2913:0B67 .BB 107B                              mov     bx,offset str_out_of_fuel ; (2913:107B=18h)
2913:0B6A  E8 04A1                              call    draw_str                ; (100E)
2913:0B6D  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:0B70  04 32                                add     al,32h                  ; '2'
2913:0B72                       loc_81:                                         ;  xref 2913:0B76
2913:0B72  3A 06 2F67                           cmp     al,time_tick            ; (2913:2F67=0)
2913:0B76  75 FA                                jne     loc_81
2913:0B78  C6 06 5043 FE                        mov     byte ptr ds:coll_flags1_e,0FEh ; (2913:5043=0)
2913:0B7D  90                                   nop
2913:0B7E  C3                                   retn
                                update_fuel     endp

2913:0B7F  CD                   data_93         db      0CDh                    ;  xref 2913:0BC8
2913:0B80  0E CF 0E 27 11 25                    db       0Eh,0CFh, 0Eh, 27h, 11h, 25h
2913:0B86  11                                   db       11h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:01EB, 0A5D, 1E84
                                ;==========================================================================

2913:0B87                       sub_15          proc    near
2913:0B87  06                                   push    es
2913:0B88  B8 A000                              mov     ax,0A000h
2913:0B8B  8E C0                                mov     es,ax
2913:0B8D  B4 0A                                mov     ah,0Ah
2913:0B8F  E8 F72F                              call    ega_map_mask            ; (02C1)
2913:0B92  8A 1E 4F9B                           mov     bl,ds:data_188e         ; (2913:4F9B=0)
2913:0B96  8A 3E 4FC5                           mov     bh,ds:data_189e         ; (2913:4FC5=0)
2913:0B9A .BE 0005                              mov     si,data_4e              ; (2913:0005=0)
2913:0B9D  B6 10                                mov     dh,10h
2913:0B9F                       loc_82:                                         ;  xref 2913:0BC6
2913:0B9F  38 B4 521A                           cmp     ds:data_204e[si],dh     ; (2913:521A=0)
2913:0BA3  77 20                                ja      loc_87
2913:0BA5  B0 0F                                mov     al,0Fh
2913:0BA7  38 9C 5220                           cmp     ds:data_205e[si],bl     ; (2913:5220=0)
2913:0BAB  73 04                                jae     loc_83
2913:0BAD  24 09                                and     al,9
2913:0BAF  EB 04                                jmp     short loc_84            ; (0BB5)
2913:0BB1                       loc_83:                                         ;  xref 2913:0BAB
2913:0BB1  76 02                                jbe     loc_84
2913:0BB3  24 06                                and     al,6
2913:0BB5                       loc_84:                                         ;  xref 2913:0BAF, 0BB1
2913:0BB5  38 BC 5226                           cmp     ds:data_206e[si],bh     ; (2913:5226=0)
2913:0BB9  73 04                                jae     loc_85
2913:0BBB  24 03                                and     al,3
2913:0BBD  EB 04                                jmp     short loc_86            ; (0BC3)
2913:0BBF                       loc_85:                                         ;  xref 2913:0BB9
2913:0BBF  76 02                                jbe     loc_86
2913:0BC1  24 0C                                and     al,0Ch
2913:0BC3                       loc_86:                                         ;  xref 2913:0BBD, 0BBF
2913:0BC3  0A F0                                or      dh,al
2913:0BC5                       loc_87:                                         ;  xref 2913:0BA3
2913:0BC5  4E                                   dec     si
2913:0BC6  79 D7                                jns     loc_82
2913:0BC8 .BE 0B7F                              mov     si,offset data_93       ; (2913:0B7F=0CDh)
2913:0BCB                       loc_88:                                         ;  xref 2913:0BF1
2913:0BCB ,D0 EE                                shr     dh,1
2913:0BCD  74 24                                jz      loc_91
2913:0BCF  8B 3C                                mov     di,[si]
2913:0BD1  B9 000A                              mov     cx,0Ah
2913:0BD4  B8 0200                              mov     ax,200h
2913:0BD7  73 03                                jnc     loc_89
2913:0BD9  B8 F23F                              mov     ax,0F23Fh
2913:0BDC                       loc_89:                                         ;  xref 2913:0BD7
2913:0BDC  F7 C7 0002                           test    di,2
2913:0BE0  74 02                                jz      locloop_90
2913:0BE2  D1 C0                                rol     ax,1

2913:0BE4                       locloop_90:                                     ;  xref 2913:0BE0, 0BED
2913:0BE4  26: 89 85 2000                       mov     es:data_231e[di],ax     ; (A000:2000=0)
2913:0BE9  AB                                   stosw
2913:0BEA  83 C7 26                             add     di,26h
2913:0BED  E2 F5                                loop    locloop_90

2913:0BEF  46                                   inc     si
2913:0BF0  46                                   inc     si
2913:0BF1  EB D8                                jmp     short loc_88            ; (0BCB)
2913:0BF3                       loc_91:                                         ;  xref 2913:0BCD
2913:0BF3  07                                   pop     es
2913:0BF4  C3                                   retn
                                sub_15          endp


                                ;==========================================================================
                                ;                                draw_comp_arr
                                ;     Draw the compass arrow based on ship_angle_e. Note that the
                                ;     arrow bitmaps are indexed through comp_offs, but they are
                                ;     partly overlapping to save a few bytes.
                                ;     The values of ship_angle go clockwise: 0 is North, 3 is East, etc.
                                ;     N, NE, E, SE, S, SW, W, NW
                                ;
                                ;         Called from:   2913:0943, 0951, 0D15
                                ;==========================================================================

2913:0BF5                       draw_comp_arr   proc    near
2913:0BF5  06                                   push    es
2913:0BF6  B8 A000                              mov     ax,0A000h
2913:0BF9  8E C0                                mov     es,ax
2913:0BFB  B4 0B                                mov     ah,0Bh
2913:0BFD  E8 F6C1                              call    ega_map_mask            ; (02C1)
2913:0C00  A0 50D7                              mov     al,ds:ship_angle_e      ; (2913:50D7=0)
2913:0C03  98                                   cbw
2913:0C04  D0 E0                                shl     al,1
2913:0C06  8B F0                                mov     si,ax
2913:0C08  8B B4 0C20                           mov     si,word ptr comp_offs[si] ; (2913:0C20=0C30h)
2913:0C0C .BF 0FEA                              mov     di,data_230e            ; (A000:0FEA=0)
2913:0C0F  B9 000B                              mov     cx,0Bh

2913:0C12                       locloop_92:                                     ;  xref 2913:0C1C
2913:0C12  AD                                   lodsw
2913:0C13  26: 89 85 2000                       mov     es:data_231e[di],ax     ; (A000:2000=0)
2913:0C18  AB                                   stosw
2913:0C19  83 C7 26                             add     di,26h
2913:0C1C  E2 F4                                loop    locloop_92

2913:0C1E  07                                   pop     es
2913:0C1F  C3                                   retn
                                draw_comp_arr   endp

2913:0C20  0C30                 comp_offs       dw      offset data_94          ; Offsets of 8 compass arrow bmps
                                                                                ;  xref 2913:0C08
2913:0C22  0C46                                 dw      offset data_95
2913:0C24  0C5A                                 dw      offset data_97
2913:0C26  0C7E                                 dw      offset data_99
2913:0C28  0CBC                                 dw      offset data_102
2913:0C2A  0C92                                 dw      offset data_100
2913:0C2C  0C6A                                 dw      offset data_98
2913:0C2E  0CA6                                 dw      offset data_101
2913:0C30  00                   data_94         db      0                       ;  xref 2913:0C20
2913:0C31  80 01 C0 03 E0 01                    db       80h, 01h,0C0h, 03h,0E0h, 01h
2913:0C37  C0 01 C0 01 C0 01                    db      0C0h, 01h,0C0h, 01h,0C0h, 01h
2913:0C3D  C0 01 C0 01 C0 01                    db      0C0h, 01h,0C0h, 01h,0C0h, 01h
2913:0C43  C0 01                                db      0C0h, 01h
2913:0C45  40                                   db      40h
2913:0C46  00                   data_95         db      0                       ;  xref 2913:0C22
2913:0C47  00 00 78 00 38 00                    db       00h, 00h, 78h, 00h, 38h, 00h
2913:0C4D  78 00 E8 01 C0 03                    db       78h, 00h,0E8h, 01h,0C0h, 03h
2913:0C53  80 07 00 0E 00 04                    db       80h, 07h, 00h, 0Eh, 00h, 04h
2913:0C59  00                                   db      0
2913:0C5A  00                   data_97         db      0                       ;  xref 2913:0C24
2913:0C5B  00 00 00 00 00 00                    db       00h, 00h, 00h, 00h, 00h, 00h
2913:0C61  20 0F F0 07 F8 0F                    db       20h, 0Fh,0F0h, 07h,0F8h, 0Fh
2913:0C67  F0 00                                db      0F0h, 00h
2913:0C69  20                                   db      20h
2913:0C6A  00                   data_98         db      0                       ;  xref 2913:0C2C
2913:0C6B  00 00 00 00 00 02                    db       00h, 00h, 00h, 00h, 00h, 02h
2913:0C71  00 07 F8 0F F0 07                    db       00h, 07h,0F8h, 0Fh,0F0h, 07h
2913:0C77  F8 02 00 00 00 00                    db      0F8h, 02h, 00h, 00h, 00h, 00h
2913:0C7D  00                                   db       00h
2913:0C7E  00                   data_99         db      0                       ;  xref 2913:0C26
2913:0C7F  00 04 00 0E 00 07                    db       00h, 04h, 00h, 0Eh, 00h, 07h
2913:0C85  00 03 80 01 C0 00                    db       00h, 03h, 80h, 01h,0C0h, 00h
2913:0C8B  E8 00 78 00 38 00                    db      0E8h, 00h, 78h, 00h, 38h, 00h
2913:0C91  78                                   db      78h
2913:0C92  00                   data_100        db      0                       ;  xref 2913:0C2A
2913:0C93  00 00 10 00 38 00                    db       00h, 00h, 10h, 00h, 38h, 00h
2913:0C99  70 00 E0 01 C0 0B                    db       70h, 00h,0E0h, 01h,0C0h, 0Bh
2913:0C9F  80 0F 00 0E 00 0F                    db       80h, 0Fh, 00h, 0Eh, 00h, 0Fh
2913:0CA5  00                                   db       00h
2913:0CA6  00                   data_101        db      0                       ;  xref 2913:0C2E
2913:0CA7  00 0F 00 0E 00 0F                    db       00h, 0Fh, 00h, 0Eh, 00h, 0Fh
2913:0CAD  00 0B 80 01 C0 00                    db       00h, 0Bh, 80h, 01h,0C0h, 00h
2913:0CB3  E0 00 70 00 38 00                    db      0E0h, 00h, 70h, 00h, 38h, 00h
2913:0CB9  10 00 00                             db       10h, 00h, 00h
2913:0CBC  01                   data_102        db      1                       ;  xref 2913:0C28
2913:0CBD  40 01 C0 01 C0 01                    db       40h, 01h,0C0h, 01h,0C0h, 01h
2913:0CC3  C0 01 C0 01 C0 01                    db      0C0h, 01h,0C0h, 01h,0C0h, 01h
2913:0CC9  C0 01 C0 03 E0 01                    db      0C0h, 01h,0C0h, 03h,0E0h, 01h
2913:0CCF  C0 00 80                             db      0C0h, 00h, 80h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:01E8
                                ;==========================================================================

2913:0CD2                       sub_16          proc    near
2913:0CD2  E8 2243                              call    maze_rnd_xy             ; (2F18)
2913:0CD5  88 16 4F9B                           mov     ds:data_188e,dl         ; (2913:4F9B=0)
2913:0CD9  88 36 4FC5                           mov     ds:data_189e,dh         ; (2913:4FC5=0)
2913:0CDD  8B DA                                mov     bx,dx
2913:0CDF  E8 15C9                              call    sub_42                  ; (22AB)
2913:0CE2  B0 10                                mov     al,10h
2913:0CE4  E8 21EA                              call    rnd_update              ; (2ED1)
2913:0CE7  04 0B                                add     al,0Bh
2913:0CE9  A2 4FEF                              mov     ds:data_190e,al         ; (2913:4FEF=0)
2913:0CEC  B0 10                                mov     al,10h
2913:0CEE  E8 21E0                              call    rnd_update              ; (2ED1)
2913:0CF1  04 0B                                add     al,0Bh
2913:0CF3  A2 5019                              mov     ds:data_191e,al         ; (2913:5019=0)
2913:0CF6  B0 08                                mov     al,8
2913:0CF8  E8 21D6                              call    rnd_update              ; (2ED1)
2913:0CFB  A2 50D7                              mov     ds:ship_angle_e,al      ; (2913:50D7=0)
2913:0CFE  A2 5177                              mov     ds:gun_angle_e,al       ; (2913:5177=0)
2913:0D01  C6 06 506D 03                        mov     byte ptr ds:data_193e,3 ; (2913:506D=0)
2913:0D06  90                                   nop
2913:0D07  32 C0                                xor     al,al
2913:0D09  A2 5043                              mov     ds:coll_flags1_e,al     ; (2913:5043=0)
2913:0D0C  A2 5178                              mov     ds:vel_angle_e,al       ; (2913:5178=0)
2913:0D0F  A2 5097                              mov     ds:data_194e,al         ; (2913:5097=0)
2913:0D12  A2 50B7                              mov     ds:vel_magn_e,al        ; (2913:50B7=0)
2913:0D15  E8 FEDD                              call    draw_comp_arr           ; (0BF5)
2913:0D18  E8 FDB1                              call    sub_14                  ; (0ACC)
2913:0D1B  C7 06 4F97 3FFF                      mov     word ptr ds:fuel_level_e,3FFFh ; (2913:4F97=0)
2913:0D21  C3                                   retn
                                sub_16          endp


                                ;==========================================================================
                                ;                                draw_ship
                                ;     Draw rotated ship and gun and collision detection.
                                ;     Collision detection by counting screen bytes that already had
                                ;     the same bit set.
                                ;
                                ;         Called from:   2913:024F
                                ;==========================================================================

2913:0D22                       draw_ship       proc    near
2913:0D22  B4 0B                                mov     ah,0Bh
2913:0D24  E8 F59A                              call    ega_map_mask            ; (02C1)
2913:0D27  B9 0007                              mov     cx,7
2913:0D2A .BF 0E6D                              mov     di,data_229e            ; (A000:0E6D=0)
2913:0D2D  A0 5177                              mov     al,ds:gun_angle_e       ; (2913:5177=0)
2913:0D30  98                                   cbw
2913:0D31  D1 E0                                shl     ax,1
2913:0D33  8B F0                                mov     si,ax
2913:0D35  8B B4 0DA8                           mov     si,word ptr gun_offs[si] ; (2913:0DA8=0DC7h)
2913:0D39  8A 1E 50D7                           mov     bl,ds:ship_angle_e      ; (2913:50D7=0)
2913:0D3D  02 1E 5178                           add     bl,ds:vel_angle_e       ; (2913:5178=0)
2913:0D41  22 D9                                and     bl,cl
2913:0D43  32 FF                                xor     bh,bh
2913:0D45  D1 E3                                shl     bx,1
2913:0D47  8B 9F 0D7C                           mov     bx,word ptr ship_offs[bx] ; (2913:0D7C=0D8Ch)
2913:0D4B  32 E4                                xor     ah,ah

2913:0D4D                       locloop_93:                                     ;  xref 2913:0D5C
2913:0D4D  AC                                   lodsb
2913:0D4E  32 07                                xor     al,[bx]
2913:0D50  26: 84 05                            test    al,es:[di]
2913:0D53  74 02                                jz      loc_94
2913:0D55  FE C4                                inc     ah
2913:0D57                       loc_94:                                         ;  xref 2913:0D53
2913:0D57  AA                                   stosb
2913:0D58  83 C7 27                             add     di,27h
2913:0D5B  43                                   inc     bx
2913:0D5C  E2 EF                                loop    locloop_93

2913:0D5E  84 E4                                test    ah,ah
2913:0D60  75 01                                jnz     loc_collison1
2913:0D62  C3                                   retn
2913:0D63                       loc_collison1:                                  ; ah is number of colliding pixels
                                                                                ;  xref 2913:0D60
2913:0D63  C6 06 506D 0A                        mov     byte ptr ds:data_193e,0Ah ; (2913:506D=0)
2913:0D68  90                                   nop
2913:0D69  C6 06 5043 01                        mov     byte ptr ds:coll_flags1_e,1 ; (2913:5043=0)
2913:0D6E  90                                   nop
2913:0D6F  C6 06 50B7 00                        mov     byte ptr ds:vel_magn_e,0 ; (2913:50B7=0)
2913:0D74  90                                   nop
2913:0D75  C6 06 5097 0A                        mov     byte ptr ds:data_194e,0Ah ; (2913:5097=0)
2913:0D7A  90                                   nop
2913:0D7B  C3                                   retn
                                draw_ship       endp

2913:0D7C  0D8C                 ship_offs       dw      offset data_103         ; Offsets of 8 ship bmps 1x7
                                                                                ;  xref 2913:0D47
2913:0D7E  0D93                                 dw      offset data_104
2913:0D80  0D9A                                 dw      offset data_105
2913:0D82  0DA1                                 dw      offset data_106
2913:0D84  0D8C                                 dw      offset data_103
2913:0D86  0D93                                 dw      offset data_104
2913:0D88  0D9A                                 dw      offset data_105
2913:0D8A  0DA1                                 dw      offset data_106
2913:0D8C  00                   data_103        db      0                       ;  xref 2913:0D7C, 0D84
2913:0D8D  44 FE FE FE 44 00                    db       44h,0FEh,0FEh,0FEh, 44h, 00h
2913:0D93  30                   data_104        db      30h                     ;  xref 2913:0D7E, 0D86
2913:0D94  70 F8 FE 3E 1C 18                    db       70h,0F8h,0FEh, 3Eh, 1Ch, 18h
2913:0D9A  38                   data_105        db      38h                     ;  xref 2913:0D80, 0D88
2913:0D9B  7C 38 38 38 7C 38                    db       7Ch, 38h, 38h, 38h, 7Ch, 38h
2913:0DA1  18                   data_106        db      18h                     ;  xref 2913:0D82, 0D8A
2913:0DA2  1C 3E FE F8 70 30                    db       1Ch, 3Eh,0FEh,0F8h, 70h, 30h
2913:0DA8  0DC7                 gun_offs        dw      offset data_111         ; Offsets of 8 gun bmps
                                                                                ;  xref 2913:0D35
2913:0DAA  0DB8                                 dw      offset data_107
2913:0DAC  0DC0                                 dw      offset data_109
2913:0DAE  0DD5                                 dw      offset data_114
2913:0DB0  0DC4                                 dw      offset data_110
2913:0DB2  0DCB                                 dw      offset data_112
2913:0DB4  0DBC                                 dw      offset data_108
2913:0DB6  0DD1                                 dw      offset data_113
2913:0DB8  02                   data_107        db      2                       ;  xref 2913:0DAA
2913:0DB9  04 08 10                             db       04h, 08h, 10h
2913:0DBC  00                   data_108        db      0                       ;  xref 2913:0DB4
2913:0DBD  00 00 F0                             db       00h, 00h,0F0h
2913:0DC0  00                   data_109        db      0                       ;  xref 2913:0DAC
2913:0DC1  00 00 1E                             db       00h, 00h, 1Eh
2913:0DC4  00                   data_110        db      0                       ;  xref 2913:0DB0
2913:0DC5  00 00                                db      0, 0
2913:0DC7  10                   data_111        db      10h                     ;  xref 2913:0DA8
2913:0DC8  10 10 10                             db       10h, 10h, 10h
2913:0DCB  00                   data_112        db      0                       ;  xref 2913:0DB2
2913:0DCC  00 00 10 20 40                       db       00h, 00h, 10h, 20h, 40h
2913:0DD1  80                   data_113        db      80h                     ;  xref 2913:0DB6
2913:0DD2  40 20 10                             db       40h, 20h, 10h
2913:0DD5  00                   data_114        db      0                       ;  xref 2913:0DAE
2913:0DD6  00 00 10 08 04 02                    db       00h, 00h, 10h, 08h, 04h, 02h
2913:0DDC  03                   data_115        db      3                       ;  xref 2913:0E07
2913:0DDD  00 03 00 33 30 33                    db       00h, 03h, 00h, 33h, 30h, 33h
2913:0DE3  30 FF FC FF FC FF                    db       30h,0FFh,0FCh,0FFh,0FCh,0FFh
2913:0DE9  FC FF FC FF FC FF                    db      0FCh,0FFh,0FCh,0FFh,0FCh,0FFh
2913:0DEF  FC                                   db      0FCh
2913:0DF0  30 30 30 30                          db       30h, 30h, 30h, 30h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:01C7
                                ;==========================================================================

2913:0DF4                       sub_17          proc    near
2913:0DF4  B4 0B                                mov     ah,0Bh
2913:0DF6  E8 F4C8                              call    ega_map_mask            ; (02C1)
2913:0DF9 .BF 0905                              mov     di,905h                 ; (2913:0905=50h)
2913:0DFC  8A 1E 4F96                           mov     bl,ds:lives_e           ; (2913:4F96=0)
2913:0E00                       loc_95:                                         ;  xref 2913:0E1A
2913:0E00 ,FE CB                                dec     bl
2913:0E02  74 18                                jz      loc_ret_97
2913:0E04  B9 000C                              mov     cx,0Ch
2913:0E07 .BE 0DDC                              mov     si,offset data_115      ; (2913:0DDC=3)

2913:0E0A                       locloop_96:                                     ;  xref 2913:0E14
2913:0E0A  AD                                   lodsw
2913:0E0B  AB                                   stosw
2913:0E0C  26: 89 85 1FFE                       mov     word ptr es:[1FFEh][di],ax ; (2913:1FFE=8A1Ch)
2913:0E11  83 C7 26                             add     di,26h
2913:0E14  E2 F4                                loop    locloop_96

2913:0E16  81 EF 01DE                           sub     di,1DEh
2913:0E1A  EB E4                                jmp     short loc_95            ; (0E00)

2913:0E1C                       loc_ret_97:                                     ;  xref 2913:0E02
2913:0E1C  C3                                   retn
                                sub_17          endp

2913:0E1D  3C 66 66 66 66 66    bmps_font_1x7   db       3Ch, 66h, 66h, 66h, 66h, 66h ; 39x1x7 "0-9A-Z! c"
                                                                                ;  xref 2913:1028
2913:0E23  3C 18 78 18 18 18                    db       3Ch, 18h, 78h, 18h, 18h, 18h
2913:0E29  18 7E 3C 66 06 0C                    db       18h, 7Eh, 3Ch, 66h, 06h, 0Ch
2913:0E2F  18 30 7E 3C 66 0C                    db       18h, 30h, 7Eh, 3Ch, 66h, 0Ch
2913:0E35  18 0C 66 3C 66 66                    db       18h, 0Ch, 66h, 3Ch, 66h, 66h
2913:0E3B  66 7E 06 06 06 7E                    db       66h, 7Eh, 06h, 06h, 06h, 7Eh
2913:0E41  60 60 3C 06 06 7C                    db       60h, 60h, 3Ch, 06h, 06h, 7Ch
2913:0E47  3C 60 60 7C 66 66                    db       3Ch, 60h, 60h, 7Ch, 66h, 66h
2913:0E4D  3C 7E 06 0C 18 30                    db       3Ch, 7Eh, 06h, 0Ch, 18h, 30h
2913:0E53  30 30 3C 66 66 3C                    db       30h, 30h, 3Ch, 66h, 66h, 3Ch
2913:0E59  66 66 3C 3C 66 66                    db       66h, 66h, 3Ch, 3Ch, 66h, 66h
2913:0E5F  3E 06 06 3C 18 3C                    db       3Eh, 06h, 06h, 3Ch, 18h, 3Ch
2913:0E65  66 66 7E 66 66 7C                    db       66h, 66h, 7Eh, 66h, 66h, 7Ch
2913:0E6B  66 66 7C 66 66 7C                    db       66h, 66h, 7Ch, 66h, 66h, 7Ch
2913:0E71  3C 66 60 60 60 66                    db       3Ch, 66h, 60h, 60h, 60h, 66h
2913:0E77  3C 7C 66 66 66 66                    db       3Ch, 7Ch, 66h, 66h, 66h, 66h
2913:0E7D  66 7C 7C 66 60 7C                    db       66h, 7Ch, 7Ch, 66h, 60h, 7Ch
2913:0E83  60 66 7C 7E 60 60                    db       60h, 66h, 7Ch, 7Eh, 60h, 60h
2913:0E89  7C 60 60 60 3C 60                    db       7Ch, 60h, 60h, 60h, 3Ch, 60h
2913:0E8F  60 6E 66 66 3C 66                    db       60h, 6Eh, 66h, 66h, 3Ch, 66h
2913:0E95  66 66 7E 66 66 66                    db       66h, 66h, 7Eh, 66h, 66h, 66h
2913:0E9B  7E 18 18 18 18 18                    db       7Eh, 18h, 18h, 18h, 18h, 18h
2913:0EA1  7E 06 06 06 06 06                    db       7Eh, 06h, 06h, 06h, 06h, 06h
2913:0EA7  66 3C 66 66 6C 78                    db       66h, 3Ch, 66h, 66h, 6Ch, 78h
2913:0EAD  6C 66 66 60 60 60                    db       6Ch, 66h, 66h, 60h, 60h, 60h
2913:0EB3  60 60 60 7E 66 7E                    db       60h, 60h, 60h, 7Eh, 66h, 7Eh
2913:0EB9  66 66 66 66 66 66                    db       66h, 66h, 66h, 66h, 66h, 66h
2913:0EBF  66 76 6E 66 66 66                    db       66h, 76h, 6Eh, 66h, 66h, 66h
2913:0EC5  3C 66 66 66 66 66                    db       3Ch, 66h, 66h, 66h, 66h, 66h
2913:0ECB  3C 7C 66 66 7C 60                    db       3Ch, 7Ch, 66h, 66h, 7Ch, 60h
2913:0ED1  60 60 3C 66 66 66                    db       60h, 60h, 3Ch, 66h, 66h, 66h
2913:0ED7  66 6E 3E 7C 66 66                    db       66h, 6Eh, 3Eh, 7Ch, 66h, 66h
2913:0EDD  7C 6C 66 66 3C 66                    db       7Ch, 6Ch, 66h, 66h, 3Ch, 66h
2913:0EE3  60 3C 06 66 3C 7E                    db       60h, 3Ch, 06h, 66h, 3Ch, 7Eh
2913:0EE9  18 18 18 18 18 18                    db       18h, 18h, 18h, 18h, 18h, 18h
2913:0EEF  66 66 66 66 66 66                    db       66h, 66h, 66h, 66h, 66h, 66h
2913:0EF5  3C 66 66 66 66 66                    db       3Ch, 66h, 66h, 66h, 66h, 66h
2913:0EFB  3C 18 66 66 66 66                    db       3Ch, 18h, 66h, 66h, 66h, 66h
2913:0F01  66 7E 66 66 66 3C                    db       66h, 7Eh, 66h, 66h, 66h, 3Ch
2913:0F07  18 3C 66 66 66 66                    db       18h, 3Ch, 66h, 66h, 66h, 66h
2913:0F0D  66 3C 18 18 18 7E                    db       66h, 3Ch, 18h, 18h, 18h, 7Eh
2913:0F13  06 0C 18 30 60 7E                    db       06h, 0Ch, 18h, 30h, 60h, 7Eh
2913:0F19  18 18 18 18 18 00                    db       18h, 18h, 18h, 18h, 18h, 00h
2913:0F1F  18 00 00 00 00 00                    db       18h, 00h, 00h, 00h, 00h, 00h
2913:0F25  00 00 42 99 A5 A1                    db       00h, 00h, 42h, 99h,0A5h,0A1h
2913:0F2B  A5 99 42                             db      0A5h, 99h, 42h
2913:0F2E  88                   unknown1        db      88h
2913:0F2F  D8 AA AB 8A 8A 8A                    db      0D8h,0AAh,0ABh, 8Ah, 8Ah, 8Ah
2913:0F35  0F 08 C8 0F 0A 09                    db       0Fh, 08h,0C8h, 0Fh, 0Ah, 09h
2913:0F3B  28 00 80 BC 2A 2A                    db       28h, 00h, 80h,0BCh, 2Ah, 2Ah
2913:0F41  2A AA 00 00 00 00                    db       2Ah,0AAh, 00h, 00h, 00h, 00h
2913:0F47  00                                   db       00h
2913:0F48  0C 0C                                db       0Ch, 0Ch
2913:0F4A  3F 0F FC C0 CF FC    bmp_gmaze_22x7  db       3Fh, 0Fh,0FCh,0C0h,0CFh,0FCh ; "GENERATING MAZE"
                                                                                ;  xref 2913:0FEE
2913:0F50  FF 00 C0 FF CF FC                    db      0FFh, 00h,0C0h,0FFh,0CFh,0FCh
2913:0F56  C0 C3 F0 00 30 30                    db      0C0h,0C3h,0F0h, 00h, 30h, 30h
2913:0F5C  30 3F F3 FF C0 CC                    db       30h, 3Fh,0F3h,0FFh,0C0h,0CCh
2913:0F62  00 F0 CC 00 C0 C3                    db       00h,0F0h,0CCh, 00h,0C0h,0C3h
2913:0F68  30 0C 00 C0 F0 CC                    db       30h, 0Ch, 00h,0C0h,0F0h,0CCh
2913:0F6E  0C 00 3C F0 CC 00                    db       0Ch, 00h, 3Ch,0F0h,0CCh, 00h
2913:0F74  33 00 C0 0C 00 D8                    db       33h, 00h,0C0h, 0Ch, 00h,0D8h
2913:0F7A  CC 00 C0 CC 0C 0C                    db      0CCh, 00h,0C0h,0CCh, 0Ch, 0Ch
2913:0F80  00 C0 D8 CC 00 00                    db       00h,0C0h,0D8h,0CCh, 00h, 00h
2913:0F86  33 33 03 00 C3 00                    db       33h, 33h, 03h, 00h,0C3h, 00h
2913:0F8C  CF CF F0 CC CF F0                    db      0CFh,0CFh,0F0h,0CCh,0CFh,0F0h
2913:0F92  FF 0F FC 0C 00 C0                    db      0FFh, 0Fh,0FCh, 0Ch, 00h,0C0h
2913:0F98  CC CC FC 00 30 33                    db      0CCh,0CCh,0FCh, 00h, 30h, 33h
2913:0F9E  FF 03 03 FC C0 CC                    db      0FFh, 03h, 03h,0FCh,0C0h,0CCh
2913:0FA4  00 C6 CC 00 C0 CC                    db       00h,0C6h,0CCh, 00h,0C0h,0CCh
2913:0FAA  0C 0C 00 C0 C6 CC                    db       0Ch, 0Ch, 00h,0C0h,0C6h,0CCh
2913:0FB0  0C 00 30 33 03 0C                    db       0Ch, 00h, 30h, 33h, 03h, 0Ch
2913:0FB6  03 00 C0 CC 00 C3                    db       03h, 00h,0C0h,0CCh, 00h,0C3h
2913:0FBC  CC 00 C0 CC 0C 0C                    db      0CCh, 00h,0C0h,0CCh, 0Ch, 0Ch
2913:0FC2  00 C0 C3 CC 0C 00                    db       00h,0C0h,0C3h,0CCh, 0Ch, 00h
2913:0FC8  30 33 03 30 03 00                    db       30h, 33h, 03h, 30h, 03h, 00h
2913:0FCE  3F 0F FC C0 CF FC                    db       3Fh, 0Fh,0FCh,0C0h,0CFh,0FCh
2913:0FD4  C0 CC 0C 0C 0F FC                    db      0C0h,0CCh, 0Ch, 0Ch, 0Fh,0FCh
2913:0FDA  C0 C3 F0 00 30 33                    db      0C0h,0C3h,0F0h, 00h, 30h, 33h
2913:0FE0  03 3F F3 FF                          db       03h, 3Fh,0F3h,0FFh

                                ;==========================================================================
                                ;                                draw_gmaze_22x7
                                ;
                                ;     Draw "GENERATING MAZE".
                                ;     Copy 7 rows of 22 (0x16) bytes from ds:[offset bmp_gmaze_22x7] to
                                ;     [dest_seg]:[dest_ofs]
                                ;     The destination has a stride of 40 (0x28) bytes.
                                ;
                                ;         Called from:   2913:0326
                                ;==========================================================================

2913:0FE4                       draw_gmaze_22x7 proc    near
2913:0FE4  8E 06 4F8A                           mov     es,ds:dest_seg_e        ; (2913:4F8A=0)
2913:0FE8  B9 0007                              mov     cx,7
2913:0FEB .BF 00CA                              mov     di,data_2e              ; (0000:00CA=0)
2913:0FEE .BE 0F4A                              mov     si,offset bmp_gmaze_22x7 ; (2913:0F4A=3Fh)

2913:0FF1                       locloop_98:                                     ;  xref 2913:0FFB
2913:0FF1  51                                   push    cx
2913:0FF2  B9 0016                              mov     cx,16h
2913:0FF5  F3/ A4                               rep     movsb
2913:0FF7  59                                   pop     cx
2913:0FF8  83 C7 12                             add     di,12h
2913:0FFB  E2 F4                                loop    locloop_98

2913:0FFD  C3                                   retn
                                draw_gmaze_22x7 endp


                                ;==========================================================================
                                ;                                draw_mstrs
                                ;     Inputs:
                                ;             ds:si - a list of string offset, screen offset pairs, ending
                                ;                     with a 0.
                                ;     Draw a list of strings to specified coordinates on screen.
                                ;
                                ;         Called from:   2913:0212, 11D6, 1283
                                ;==========================================================================

2913:0FFE                       draw_mstrs      proc    near
2913:0FFE                       loc_99:                                         ;  xref 2913:100B
2913:0FFE ,AD                                   lodsw
2913:0FFF  85 C0                                test    ax,ax
2913:1001  74 0A                                jz      loc_ret_100
2913:1003  8B D8                                mov     bx,ax
2913:1005  AD                                   lodsw
2913:1006  8B F8                                mov     di,ax
2913:1008  E8 0003                              call    draw_str                ; (100E)
2913:100B  EB F1                                jmp     short loc_99            ; (0FFE)

2913:100D                       loc_ret_100:                                    ;  xref 2913:1001
2913:100D  C3                                   retn
                                draw_mstrs      endp


                                ;==========================================================================
                                ;                                draw_str
                                ;
                                ;     Input:
                                ;             bx - ASCII string terminating in a negative char.
                                ;             di - screen offset
                                ;     Draw a string starting at the specified screen offset. Each char is
                                ;     8x7 pixels.
                                ;     sub di,117h moves to the next char (di - 7*40 + 1).
                                ;
                                ;         Called from:   2913:0B6A, 1008, 104D, 125F, 12A5
                                ;==========================================================================

2913:100E                       draw_str        proc    near
2913:100E  53                                   push    bx
2913:100F  56                                   push    si
2913:1010                       loc_101:                                        ;  xref 2913:101E
2913:1010 ,8A 07                                mov     al,[bx]
2913:1012  84 C0                                test    al,al
2913:1014  78 0A                                js      loc_102
2913:1016  E8 000A                              call    draw_char_1x7           ; (1023)
2913:1019  81 EF 0117                           sub     di,117h
2913:101D  43                                   inc     bx
2913:101E  EB F0                                jmp     short loc_101           ; (1010)
2913:1020                       loc_102:                                        ;  xref 2913:1014
2913:1020  5E                                   pop     si
2913:1021  5B                                   pop     bx
2913:1022  C3                                   retn
                                draw_str        endp


                                ;==========================================================================
                                ;                                draw_char_1x7
                                ;
                                ;     Input
                                ;              al: index char "0-9A-Z! c"
                                ;              es, di: destination
                                ;     Copy 7 rows of 1 bytes from ds:[offset bmps_font_1x7 + (u16)al * 7] to
                                ;     two pages:
                                ;             es:[di] and es:[di + 0x2000]
                                ;     The destination has a stride of 40 (0x28) bytes.
                                ;
                                ;         Called from:   2913:1016, 1292, 129C, 12AF, 12B9, 131C
                                ;==========================================================================

2913:1023                       draw_char_1x7   proc    near
2913:1023  B9 0007                              mov     cx,7
2913:1026  F6 E1                                mul     cl
2913:1028 .BE 0E1D                              mov     si,offset bmps_font_1x7 ; (2913:0E1D=3Ch)
2913:102B  03 F0                                add     si,ax

2913:102D                       locloop_103:                                    ;  xref 2913:1037
2913:102D  AC                                   lodsb
2913:102E  26: 88 85 2000                       mov     byte ptr es:[2000h][di],al ; (2913:2000=86h)
2913:1033  AA                                   stosb
2913:1034  83 C7 27                             add     di,27h
2913:1037  E2 F4                                loop    locloop_103

2913:1039  C3                                   retn
                                draw_char_1x7   endp


                                ;==========================================================================
                                ;         Display the updated score number
                                ;
                                ;         Called from:   2913:1256, 1D13
                                ;==========================================================================

2913:103A                       disp_score      proc    near
2913:103A  06                                   push    es
2913:103B  BB A000                              mov     bx,0A000h
2913:103E  8E C3                                mov     es,bx
2913:1040  57                                   push    di
2913:1041  B4 0E                                mov     ah,0Eh
2913:1043  E8 F27B                              call    ega_map_mask            ; (02C1)
2913:1046 .BB 2F56                              mov     bx,offset strb_score    ; (2913:2F56=25h)
2913:1049 .BF 06FD                              mov     di,data_227e            ; (A000:06FD=0)
2913:104C  AE                                   scasb
2913:104D  E8 FFBE                              call    draw_str                ; (100E)
2913:1050  5F                                   pop     di
2913:1051  07                                   pop     es
2913:1052  C3                                   retn
                                disp_score      endp

2913:1053  15 0E 1F 0E 15 FF    str_level       db       15h, 0Eh, 1Fh, 0Eh, 15h,0FFh ;  xref 2913:1171, 117D, 1189
2913:1059  0D 0E 17 1C 12 1D    str_density     db       0Dh, 0Eh, 17h, 1Ch, 12h, 1Dh ;  xref 2913:1175, 1181, 118D
2913:105F  22 FF                                db       22h,0FFh
2913:1061  17 0E 20 FF          str_new         db       17h, 0Eh, 20h,0FFh     ;  xref 2913:1185
2913:1065  0C 1E 1B 1B 0E 17    str_current     db       0Ch, 1Eh, 1Bh, 1Bh, 0Eh, 17h ;  xref 2913:1179
2913:106B  1D FF                                db       1Dh,0FFh
2913:106D  1C 0C 18 1B 0E FF    str_score       db       1Ch, 0Ch, 18h, 1Bh, 0Eh,0FFh ;  xref 2913:1169, 1259
2913:1073  0A 1D FF             str_at          db       0Ah, 1Dh,0FFh          ;  xref 2913:116D
2913:1076  11 12 10 11 FF       str_high        db       11h, 12h, 10h, 11h,0FFh ;  xref 2913:1165
2913:107B  18 1E 1D 25 18 0F    str_out_of_fuel db       18h, 1Eh, 1Dh, 25h, 18h, 0Fh ;  xref 2913:0B67
2913:1081  25 0F 1E 0E 15 FF                    db       25h, 0Fh, 1Eh, 0Eh, 15h,0FFh
2913:1087  0C 18 17 10 1B 0A    str_congrats    db       0Ch, 18h, 17h, 10h, 1Bh, 0Ah ; "CONGRATULATIONS !!"
                                                                                ;  xref 2913:10ED
2913:108D  1D 1E 15 0A 1D 12                    db       1Dh, 1Eh, 15h, 0Ah, 1Dh, 12h
2913:1093  18 17 1C 25 24 24                    db       18h, 17h, 1Ch, 25h, 24h, 24h
2913:1099  FF                                   db      0FFh
2913:109A  22 18 1E 25 11 0A    str_destroyed   db       22h, 18h, 1Eh, 25h, 11h, 0Ah ; "YOU HAVE DESTROYED"
                                                                                ;  xref 2913:10F1
2913:10A0  1F 0E 25 0D 0E 1C                    db       1Fh, 0Eh, 25h, 0Dh, 0Eh, 1Ch
2913:10A6  1D 1B 18 22 0E 0D                    db       1Dh, 1Bh, 18h, 22h, 0Eh, 0Dh
2913:10AC  FF                                   db      0FFh
2913:10AD  1D 11 0E 25 0A 15    str_alien_pgnd  db       1Dh, 11h, 0Eh, 25h, 0Ah, 15h ; "THE ALIEN PROVING GROUND !"
                                                                                ;  xref 2913:10F5
2913:10B3  12 0E 17 25 19 1B                    db       12h, 0Eh, 17h, 25h, 19h, 1Bh
2913:10B9  18 1F 12 17 10 25                    db       18h, 1Fh, 12h, 17h, 10h, 25h
2913:10BF  10 1B 18 1E 17 0D                    db       10h, 1Bh, 18h, 1Eh, 17h, 0Dh
2913:10C5  25 24 FF                             db       25h, 24h,0FFh
2913:10C8  1D 11 0E 25 0D 12    str_dino_bri    db       1Dh, 11h, 0Eh, 25h, 0Dh, 12h ; "THE DINOCHROME BRIGADE"
                                                                                ;  xref 2913:10F9
2913:10CE  17 18 0C 11 1B 18                    db       17h, 18h, 0Ch, 11h, 1Bh, 18h
2913:10D4  16 0E 25 0B 1B 12                    db       16h, 0Eh, 25h, 0Bh, 1Bh, 12h
2913:10DA  10 0A 0D 0E FF                       db       10h, 0Ah, 0Dh, 0Eh,0FFh
2913:10DF  1C 0A 15 1E 1D 0E    str_salutes_you db       1Ch, 0Ah, 15h, 1Eh, 1Dh, 0Eh ; "SALUTES YOU !"
                                                                                ;  xref 2913:10FD
2913:10E5  1C 25 22 18 1E 25                    db       1Ch, 25h, 22h, 18h, 1Eh, 25h
2913:10EB  24 FF                                db       24h,0FFh
2913:10ED  1087                 win_ofs         dw      offset str_congrats     ;  xref 2913:020F
2913:10EF  0645                 win_sofs        dw      645h
2913:10F1  109A                 win_ofs1        dw      offset str_destroyed
2913:10F3  0B45                 win_sofs1       dw      0B45h
2913:10F5  10AD                 win_ofs2        dw      offset str_alien_pgnd
2913:10F7  0DC1                 win_sofs2       dw      0DC1h
2913:10F9  10C8                 win_ofs3        dw      offset str_dino_bri
2913:10FB  1542                 win_sofs3       dw      1542h
2913:10FD  10DF                 win_ofs4        dw      offset str_salutes_you
2913:10FF  17C7                 win_sofs4       dw      17C7h
2913:1101  0000                 win_end         dw      0
2913:1103  0F                   data_119        db      0Fh                     ;  xref 2913:1153
2913:1104  18 1B 25 12 0B 16                    db       18h, 1Bh, 25h, 12h, 0Bh, 16h
2913:110A  25 19 0C FF                          db       25h, 19h, 0Ch,0FFh
2913:110E  1F                   data_120        db      1Fh                     ;  xref 2913:1157
2913:110F  01 2A 00 00 FF                       db       01h, 2Ah, 00h, 00h,0FFh
2913:1114  0C                   data_121        db      0Ch                     ;  xref 2913:115B
2913:1115  18 19 22 1B 12 10                    db       18h, 19h, 22h, 1Bh, 12h, 10h
2913:111B  11 1D 25 26 25 01                    db       11h, 1Dh, 25h, 26h, 25h, 01h
2913:1121  09 09 03 25 0B 22                    db       09h, 09h, 03h, 25h, 0Bh, 22h
2913:1127  25 27 28 29 FF                       db       25h, 27h, 28h, 29h,0FFh
2913:112C  18                   data_122        db      18h                     ;  xref 2913:115F
2913:112D  1B 12 10 12 17 0A                    db       1Bh, 12h, 10h, 12h, 17h, 0Ah
2913:1133  15 25 10 0A 16 0E                    db       15h, 25h, 10h, 0Ah, 16h, 0Eh
2913:1139  25 26 25 01 09 08                    db       25h, 26h, 25h, 01h, 09h, 08h
2913:113F  02 25 0B 22 25 0E                    db       02h, 25h, 0Bh, 22h, 25h, 0Eh
2913:1145  15 1F 22 17 25 1C                    db       15h, 1Fh, 22h, 17h, 25h, 1Ch
2913:114B  18 0F 1D 20 0A 1B                    db       18h, 0Fh, 1Dh, 20h, 0Ah, 1Bh
2913:1151  0E FF                                db       0Eh,0FFh
2913:1153  1103                 tit_str         dw      offset data_119         ;  xref 2913:11D3
2913:1155  0A0F                 tit_sofs        dw      0A0Fh
2913:1157  110E                 tit_str1        dw      offset data_120
2913:1159  0C92                 tit_sofs1       dw      0C92h
2913:115B  1114                 tit_str2        dw      offset data_121
2913:115D  1189                 tit_sofs2       dw      1189h
2913:115F  112C                 tit_str3        dw      offset data_122
2913:1161  1901                 tit_sofs3       dw      1901h
2913:1163  0000                 tit_end         dw      0
2913:1165  1076                 lsel_str        dw      offset str_high         ;  xref 2913:1280
2913:1167  0551                 lsel_ofs        dw      551h
2913:1169  106D                 lsel_str1       dw      offset str_score
2913:116B  0556                 lsel_ofs1       dw      556h
2913:116D  1073                 lsel_str2       dw      offset str_at
2913:116F  0624                 lsel_ofs2       dw      624h
2913:1171  1053                 lsel_str3       dw      offset str_level
2913:1173  0560                 lsel_ofs3       dw      560h
2913:1175  1059                 lsel_str4       dw      offset str_density
2913:1177  06EF                 lsel_ofs4       dw      6EFh
2913:1179  1065                 lsel_str5       dw      offset str_current
2913:117B  0E3B                 lsel_ofs5       dw      0E3Bh
2913:117D  1053                 lsel_str6       dw      offset str_level
2913:117F  0D7D                 lsel_ofs6       dw      0D7Dh
2913:1181  1059                 lsel_str7       dw      offset str_density
2913:1183  0F0C                 lsel_ofs7       dw      0F0Ch
2913:1185  1061                 lsel_str8       dw      offset str_new
2913:1187  1685                 lsel_ofs8       dw      1685h
2913:1189  1053                 lsel_str9       dw      offset str_level
2913:118B  15C3                 lsel_ofs9       dw      15C3h
2913:118D  1059                 lsel_strA       dw      offset str_density
2913:118F  1752                 lsel_ofsA       dw      1752h
2913:1191  0000                 levsel_end      dw      0
2913:1193  90                                   db      90h

                                ;==========================================================================
                                ;         Draw title screen, wait a little or until a key
                                ;
                                ;         Called from:   2913:0156
                                ;==========================================================================

2913:1194                       title_screen    proc    near
2913:1194  B8 A000                              mov     ax,0A000h
2913:1197  8E C0                                mov     es,ax
2913:1199  B4 08                                mov     ah,8
2913:119B  E8 F123                              call    ega_map_mask            ; (02C1)
2913:119E  33 DB                                xor     bx,bx
2913:11A0  33 D2                                xor     dx,dx
2913:11A2                       loc_104:                                        ;  xref 2913:11BE, 11CB
2913:11A2  B0 30                                mov     al,30h                  ; '0'
2913:11A4  E8 1D53                              call    rndnum                  ; (2EFA)
2913:11A7  B9 0007                              mov     cx,7
2913:11AA  F6 E1                                mul     cl
2913:11AC .BE 259D                              mov     si,offset sprites_1x7   ; (2913:259D=10h)
2913:11AF  03 F0                                add     si,ax
2913:11B1  8B FB                                mov     di,bx

2913:11B3                       locloop_105:                                    ;  xref 2913:11B7
2913:11B3  A4                                   movsb
2913:11B4  83 C7 27                             add     di,27h
2913:11B7  E2 FA                                loop    locloop_105

2913:11B9  43                                   inc     bx
2913:11BA  42                                   inc     dx
2913:11BB  80 FA 28                             cmp     dl,28h                  ; '('
2913:11BE  72 E2                                jb      loc_104
2913:11C0  32 D2                                xor     dl,dl
2913:11C2  81 C3 0118                           add     bx,118h
2913:11C6  FE C6                                inc     dh
2913:11C8  80 FE 19                             cmp     dh,19h
2913:11CB  72 D5                                jb      loc_104
2913:11CD  BF 0538                              mov     di,538h
2913:11D0  E8 01E9                              call    draw_bolo_8x20          ; (13BC)
2913:11D3 .BE 1153                              mov     si,offset tit_str       ; (2913:1153=3)
2913:11D6  E8 FE25                              call    draw_mstrs              ; (0FFE)
2913:11D9  8A 1E 2F67                           mov     bl,time_tick            ; (2913:2F67=0)
2913:11DD  80 C3 3C                             add     bl,3Ch                  ; '<'
2913:11E0  32 C0                                xor     al,al
2913:11E2  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:11E5                       loc_106:                                        ;  xref 2913:11EF
2913:11E5  38 06 4F95                           cmp     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:11E9  75 0A                                jne     loc_107
2913:11EB  3A 1E 2F67                           cmp     bl,time_tick            ; (2913:2F67=0)
2913:11EF  73 F4                                jae     loc_106
2913:11F1  88 1E 0973                           mov     lastkey_tick,bl         ; (2913:0973=0)
2913:11F5                       loc_107:                                        ;  xref 2913:11E9
2913:11F5  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:11F8  C3                                   retn
                                title_screen    endp


                                ;==========================================================================
                                ;         Draw the hud to the right
                                ;
                                ;         Called from:   2913:015F, 01C4, 01FC, 0B5C
                                ;==========================================================================

2913:11F9                       draw_hud        proc    near
2913:11F9  E8 F2EF                              call    clear_vp0               ; (04EB)
2913:11FC                       npage2:                                         ; Loop over both pages
                                                                                ;  xref 2913:1254
2913:11FC  BF 001D                              mov     di,1Dh
2913:11FF  E8 01BA                              call    draw_bolo_8x20          ; (13BC)
2913:1202  B4 0F                                mov     ah,0Fh
2913:1204  E8 F0BA                              call    ega_map_mask            ; (02C1)
2913:1207  BB 1CE7                              mov     bx,1CE7h
2913:120A  BA 1A40                              mov     dx,1A40h
2913:120D  E8 0111                              call    draw_rect               ; (1321)
2913:1210  B7 47                                mov     bh,47h                  ; 'G'
2913:1212  B6 0F                                mov     dh,0Fh
2913:1214  E8 010A                              call    draw_rect               ; (1321)
2913:1217  B7 7E                                mov     bh,7Eh                  ; '~'
2913:1219  B6 3D                                mov     dh,3Dh                  ; '='
2913:121B  E8 0103                              call    draw_rect               ; (1321)
2913:121E  BB 5BE7                              mov     bx,5BE7h
2913:1221  BA 0F0F                              mov     dx,0F0Fh
2913:1224  E8 00FA                              call    draw_rect               ; (1321)
2913:1227  02 DA                                add     bl,dl
2913:1229  E8 00F5                              call    draw_rect               ; (1321)
2913:122C  02 FA                                add     bh,dl
2913:122E  E8 00F0                              call    draw_rect               ; (1321)
2913:1231  2A DA                                sub     bl,dl
2913:1233  E8 00EB                              call    draw_rect               ; (1321)
2913:1236 .BE 1340                              mov     si,offset bmp_comp_4x31 ; (2913:1340=7Fh)
2913:1239 .BF 0E59                              mov     di,ofs_33x91_e          ; (A000:0E59=0)
2913:123C  B0 1F                                mov     al,1Fh
2913:123E                       nrow2:                                          ; Copy 4bt(32px)x31 rows to output
                                                                                ;  xref 2913:1248
2913:123E  B9 0004                              mov     cx,4
2913:1241  F3/ A4                               rep     movsb
2913:1243  83 C7 24                             add     di,24h
2913:1246  FE C8                                dec     al
2913:1248  75 F4                                jnz     nrow2
2913:124A  8C C0                                mov     ax,es
2913:124C  80 F4 02                             xor     ah,2
2913:124F  8E C0                                mov     es,ax
2913:1251  F6 C4 02                             test    ah,2
2913:1254  75 A6                                jnz     npage2
2913:1256  E8 FDE1                              call    disp_score              ; (103A)
2913:1259 .BB 106D                              mov     bx,offset str_score     ; (2913:106D=1Ch)
2913:125C .BF 051E                              mov     di,51Eh                 ; (2913:051E=0EFh)
2913:125F  E8 FDAC                              call    draw_str                ; (100E)
2913:1262  C3                                   retn
                                draw_hud        endp


                                ;==========================================================================
                                ;         Draw level selection on the left
                                ;
                                ;         Called from:   2913:0162
                                ;==========================================================================

2913:1263                       draw_levsel     proc    near
2913:1263  B4 0F                                mov     ah,0Fh
2913:1265  E8 F059                              call    ega_map_mask            ; (02C1)
2913:1268  BB 1C02                              mov     bx,1C02h
2913:126B  BA 1CCC                              mov     dx,1CCCh
2913:126E  E8 00B0                              call    draw_rect               ; (1321)
2913:1271  B7 50                                mov     bh,50h                  ; 'P'
2913:1273  E8 00AB                              call    draw_rect               ; (1321)
2913:1276  B7 85                                mov     bh,85h
2913:1278  E8 00A6                              call    draw_rect               ; (1321)
2913:127B  B4 0B                                mov     ah,0Bh
2913:127D  E8 F041                              call    ega_map_mask            ; (02C1)
2913:1280 .BE 1165                              mov     si,offset lsel_str      ; (2913:1165=76h)
2913:1283  E8 FD78                              call    draw_mstrs              ; (0FFE)
2913:1286  B4 0E                                mov     ah,0Eh
2913:1288  E8 F036                              call    ega_map_mask            ; (02C1)
2913:128B  A0 2F54                              mov     al,level                ; (2913:2F54=0)
2913:128E  40                                   inc     ax
2913:128F .BF 0D85                              mov     di,data_228e            ; (A000:0D85=0)
2913:1292  E8 FD8E                              call    draw_char_1x7           ; (1023)
2913:1295  A0 2F55                              mov     al,density              ; (2913:2F55=0)
2913:1298  40                                   inc     ax
2913:1299 .BF 0F15                              mov     di,offset 0F15h         ; (2913:0F15=18h)
2913:129C  E8 FD84                              call    draw_char_1x7           ; (1023)
2913:129F .BF 06E2                              mov     di,6E2h                 ; (2913:06E2=24h)
2913:12A2 .BB 2F5D                              mov     bx,offset strb_hisco    ; (2913:2F5D=25h)
2913:12A5  E8 FD66                              call    draw_str                ; (100E)
2913:12A8  A0 2F64                              mov     al,high_level           ; (2913:2F64=0)
2913:12AB  40                                   inc     ax
2913:12AC .BF 0567                              mov     di,567h                 ; (2913:0567=0FEh)
2913:12AF  E8 FD71                              call    draw_char_1x7           ; (1023)
2913:12B2  A0 2F65                              mov     al,high_dens            ; (2913:2F65=0)
2913:12B5  40                                   inc     ax
2913:12B6 .BF 06F7                              mov     di,offset data_25       ; (2913:06F7='')
2913:12B9  E8 FD67                              call    draw_char_1x7           ; (1023)
2913:12BC  C3                                   retn
                                draw_levsel     endp


                                ;==========================================================================
                                ;                                edit_levdens
                                ;     Edit the level and density on screen.
                                ;     Calls edit_digit two times with the values and coordinates of leveli
                                ;     and density.
                                ;     Initializes time_5bit.
                                ;
                                ;         Called from:   2913:0165
                                ;==========================================================================

2913:12BD                       edit_levdens    proc    near
2913:12BD  BF 16BB                              mov     di,16BBh
2913:12C0  B3 0A                                mov     bl,0Ah
2913:12C2  8A 3E 2F54                           mov     bh,level                ; (2913:2F54=0)
2913:12C6  E8 001D                              call    edit_digit              ; (12E6)
2913:12C9  A2 2F54                              mov     level,al                ; (2913:2F54=0)
2913:12CC  BF 184B                              mov     di,184Bh
2913:12CF  B3 06                                mov     bl,6
2913:12D1  8A 3E 2F55                           mov     bh,density              ; (2913:2F55=0)
2913:12D5  E8 000E                              call    edit_digit              ; (12E6)
2913:12D8  A2 2F55                              mov     density,al              ; (2913:2F55=0)
2913:12DB  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:12DE  8A D0                                mov     dl,al
2913:12E0  24 1F                                and     al,1Fh
2913:12E2  A2 2F88                              mov     ds:time_5bit_e,al       ; (2913:2F88=0)
2913:12E5  C3                                   retn
                                edit_levdens    endp


                                ;==========================================================================
                                ;                                edit_digit
                                ;     Inputs:
                                ;             di: screen offset of digit
                                ;             bl: max value + 1 (0xA for level, 6 for density)
                                ;             bh: current value
                                ;     Output: al: the new value
                                ;     Edit a digit on screen.
                                ;
                                ;         Called from:   2913:12C6, 12D5
                                ;==========================================================================

2913:12E6                       edit_digit      proc    near
2913:12E6                       loc_108:                                        ;  xref 2913:12FF, 130E, 1312
2913:12E6  B4 0E                                mov     ah,0Eh
2913:12E8  E8 EFD6                              call    ega_map_mask            ; (02C1)
2913:12EB  26: 80 35 FF                         xor     byte ptr es:[di],0FFh
2913:12EF  A0 2F67                              mov     al,time_tick            ; (2913:2F67=0)
2913:12F2  04 02                                add     al,2
2913:12F4                       loc_109:                                        ;  xref 2913:12F8
2913:12F4  38 06 2F67                           cmp     time_tick,al            ; (2913:2F67=0)
2913:12F8  75 FA                                jne     loc_109
2913:12FA  53                                   push    bx
2913:12FB  E8 F34A                              call    getkey                  ; (0648)
2913:12FE  5B                                   pop     bx
2913:12FF  74 E5                                jz      loc_108
2913:1301  3C 1C                                cmp     al,1Ch
2913:1303  75 07                                jne     loc_110
2913:1305  A2 4F95                              mov     ds:kbdin_key_e,al       ; (2913:4F95=0)
2913:1308  8A C7                                mov     al,bh
2913:130A  EB 0A                                jmp     short loc_111           ; (1316)
2913:130C                       loc_110:                                        ;  xref 2913:1303
2913:130C  3C 02                                cmp     al,2
2913:130E  72 D6                                jb      loc_108
2913:1310  3A C3                                cmp     al,bl
2913:1312  77 D2                                ja      loc_108
2913:1314  2C 02                                sub     al,2
2913:1316                       loc_111:                                        ;  xref 2913:130A
2913:1316  50                                   push    ax
2913:1317  40                                   inc     ax
2913:1318  81 EF 00F0                           sub     di,0F0h
2913:131C  E8 FD04                              call    draw_char_1x7           ; (1023)
2913:131F  58                                   pop     ax
2913:1320  C3                                   retn
                                edit_digit      endp


                                ;==========================================================================
                                ;                                draw_rect
                                ;     Draw a rectangle with 1-pixel lines
                                ;     Inputs:
                                ;             BL=x
                                ;             BH=y
                                ;             DL=width pixels - 1
                                ;             DH=height pixels - 1
                                ;     Preserve: BX, DX
                                ;
                                ;         Called from:   2913:120D, 1214, 121B, 1224, 1229, 122E, 1233
                                ;                             126E, 1273, 1278
                                ;==========================================================================

2913:1321                       draw_rect       proc    near
2913:1321  53                                   push    bx
2913:1322  32 ED                                xor     ch,ch
2913:1324  02 FE                                add     bh,dh
2913:1326  8A CA                                mov     cl,dl
2913:1328  E8 F2D7                              call    horiz_line              ; (0602)
2913:132B  2A FE                                sub     bh,dh
2913:132D  8A CA                                mov     cl,dl
2913:132F  E8 F2D0                              call    horiz_line              ; (0602)
2913:1332  8A CE                                mov     cl,dh
2913:1334  E8 F2BE                              call    vert_line               ; (05F5)
2913:1337  02 DA                                add     bl,dl
2913:1339  8A CE                                mov     cl,dh
2913:133B  E8 F2B7                              call    vert_line               ; (05F5)
2913:133E  5B                                   pop     bx
2913:133F  C3                                   retn
                                draw_rect       endp

2913:1340  7F FF FF FF 40 00    bmp_comp_4x31   db       7Fh,0FFh,0FFh,0FFh, 40h, 00h ;  xref 2913:1236
2913:1346  00 01 40 00 00 01                    db       00h, 01h, 40h, 00h, 00h, 01h
2913:134C  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:1352  80 01 40 00 80 01                    db       80h, 01h, 40h, 00h, 80h, 01h
2913:1358  42 00 80 21 41 00                    db       42h, 00h, 80h, 21h, 41h, 00h
2913:135E  00 41 40 80 00 81                    db       00h, 41h, 40h, 80h, 00h, 81h
2913:1364  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:136A  00 01 40 00 00 01                    db       00h, 01h, 40h, 00h, 00h, 01h
2913:1370  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:1376  00 01 40 00 80 01                    db       00h, 01h, 40h, 00h, 80h, 01h
2913:137C  47 01 C0 71 40 00                    db       47h, 01h,0C0h, 71h, 40h, 00h
2913:1382  80 01 40 00 00 01                    db       80h, 01h, 40h, 00h, 00h, 01h
2913:1388  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:138E  00 01 40 00 00 01                    db       00h, 01h, 40h, 00h, 00h, 01h
2913:1394  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:139A  00 01 40 80 00 81                    db       00h, 01h, 40h, 80h, 00h, 81h
2913:13A0  41 00 80 41 42 00                    db       41h, 00h, 80h, 41h, 42h, 00h
2913:13A6  80 21 40 00 80 01                    db       80h, 21h, 40h, 00h, 80h, 01h
2913:13AC  40 00 00 01 40 00                    db       40h, 00h, 00h, 01h, 40h, 00h
2913:13B2  00 01 40 00 00 01                    db       00h, 01h, 40h, 00h, 00h, 01h
2913:13B8  7F FF FF FF                          db       7Fh,0FFh,0FFh,0FFh

                                ;==========================================================================
                                ;                                draw_bolo_8x20
                                ;
                                ;     Input: es, di: destination
                                ;     Enable EGA planes 1,3 (0xA -> bright green).
                                ;     Copy 20 rows of 8 bt (64 px) from ds:[offset bmp_bolo_8x20] to es:di
                                ;     with dest stride 40.
                                ;
                                ;         Called from:   2913:11D0, 11FF
                                ;==========================================================================

2913:13BC                       draw_bolo_8x20  proc    near
2913:13BC  B4 0A                                mov     ah,0Ah
2913:13BE  E8 EF00                              call    ega_map_mask            ; (02C1)
2913:13C1  B9 0014                              mov     cx,14h
2913:13C4 .BE 13D3                              mov     si,offset bmp_bolo_8x20 ; (2913:13D3=0FFh)
2913:13C7                       nrow1:                                          ; Copy 8bt(64px) x 20 rows to output
                                                                                ;  xref 2913:13D0
2913:13C7  51                                   push    cx
2913:13C8  B1 08                                mov     cl,8
2913:13CA  F3/ A4                               rep     movsb
2913:13CC  59                                   pop     cx
2913:13CD  83 C7 20                             add     di,20h
2913:13D0  E2 F5                                loop    nrow1

2913:13D2  C3                                   retn
                                draw_bolo_8x20  endp

2913:13D3  FF E0 07 C0 3C 00    bmp_bolo_8x20   db      0FFh,0E0h, 07h,0C0h, 3Ch, 00h ; "BOLO" copied as bright green
                                                                                ;  xref 2913:13C4
2913:13D9  0F 80 FF F0 1F F0                    db       0Fh, 80h,0FFh,0F0h, 1Fh,0F0h
2913:13DF  3C 00 3F E0 FF F8                    db       3Ch, 00h, 3Fh,0E0h,0FFh,0F8h
2913:13E5  3F F8 3C 00 7F F0                    db       3Fh,0F8h, 3Ch, 00h, 7Fh,0F0h
2913:13EB  F0 F8 7C 7C 3C 00                    db      0F0h,0F8h, 7Ch, 7Ch, 3Ch, 00h
2913:13F1  F8 F8 F0 78 F8 3E                    db      0F8h,0F8h,0F0h, 78h,0F8h, 3Eh
2913:13F7  3C 01 F0 7C F0 78                    db       3Ch, 01h,0F0h, 7Ch,0F0h, 78h
2913:13FD  F0 1E 3C 01 E0 3C                    db      0F0h, 1Eh, 3Ch, 01h,0E0h, 3Ch
2913:1403  F0 79 F0 1F 3C 03                    db      0F0h, 79h,0F0h, 1Fh, 3Ch, 03h
2913:1409  E0 3E F0 F9 E0 0F                    db      0E0h, 3Eh,0F0h,0F9h,0E0h, 0Fh
2913:140F  3C 03 C0 1E FF F1                    db       3Ch, 03h,0C0h, 1Eh,0FFh,0F1h
2913:1415  E0 0F 3C 03 C0 1E                    db      0E0h, 0Fh, 3Ch, 03h,0C0h, 1Eh
2913:141B  FF E1 E0 0F 3C 03                    db      0FFh,0E1h,0E0h, 0Fh, 3Ch, 03h
2913:1421  C0 1E FF F1 E0 0F                    db      0C0h, 1Eh,0FFh,0F1h,0E0h, 0Fh
2913:1427  3C 03 C0 1E F0 F9                    db       3Ch, 03h,0C0h, 1Eh,0F0h,0F9h
2913:142D  E0 0F 3C 03 C0 1E                    db      0E0h, 0Fh, 3Ch, 03h,0C0h, 1Eh
2913:1433  F0 79 E0 0F 3C 03                    db      0F0h, 79h,0E0h, 0Fh, 3Ch, 03h
2913:1439  C0 1E F0 79 F0 1F                    db      0C0h, 1Eh,0F0h, 79h,0F0h, 1Fh
2913:143F  3C 03 E0 3E F0 78                    db       3Ch, 03h,0E0h, 3Eh,0F0h, 78h
2913:1445  F0 1E 3C 01 E0 3C                    db      0F0h, 1Eh, 3Ch, 01h,0E0h, 3Ch
2913:144B  F0 78 F8 3E 3C 01                    db      0F0h, 78h,0F8h, 3Eh, 3Ch, 01h
2913:1451  F0 7C F0 F8 7C 7C                    db      0F0h, 7Ch,0F0h,0F8h, 7Ch, 7Ch
2913:1457  3C 00 F8 F8 FF F8                    db       3Ch, 00h,0F8h,0F8h,0FFh,0F8h
2913:145D  3F F8 3F FC 7F F0                    db       3Fh,0F8h, 3Fh,0FCh, 7Fh,0F0h
2913:1463  FF F0 1F F0 3F FC                    db      0FFh,0F0h, 1Fh,0F0h, 3Fh,0FCh
2913:1469  3F E0 FF E0 07 C0                    db       3Fh,0E0h,0FFh,0E0h, 07h,0C0h
2913:146F  3F FC 0F 80                          db       3Fh,0FCh, 0Fh, 80h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0232
                                ;==========================================================================

2913:1473                       sub_18          proc    near
2913:1473 .BF 001F                              mov     di,data_8e              ; (2913:001F=0)
2913:1476                       loc_112:                                        ;  xref 2913:1527
2913:1476 ,8A 85 5043                           mov     al,ds:coll_flags1_e[di] ; (2913:5043=0)
2913:147A  84 C0                                test    al,al
2913:147C  78 2D                                js      loc_116
2913:147E  74 06                                jz      loc_113
2913:1480  24 F0                                and     al,0F0h
2913:1482  3C 70                                cmp     al,70h                  ; 'p'
2913:1484  75 25                                jne     loc_116
2913:1486                       loc_113:                                        ;  xref 2913:147E
2913:1486  98                                   cbw
2913:1487                       loc_114:
2913:1487  38 A5 51F9                           cmp     ds:data_202e[di],ah     ; (2913:51F9=0)
2913:148B  74 06                                je      loc_115
2913:148D  FE 8D 51F9                           dec     byte ptr ds:data_202e[di] ; (2913:51F9=0)
2913:1491  EB 18                                jmp     short loc_116           ; (14AB)
2913:1493                       loc_115:                                        ;  xref 2913:148B
2913:1493  85 FF                                test    di,di
2913:1495  75 17                                jnz     loc_117
2913:1497  32 C0                                xor     al,al
2913:1499  38 06 5219                           cmp     ds:data_203e,al         ; (2913:5219=0)
2913:149D  74 0C                                je      loc_116
2913:149F  A2 5219                              mov     ds:data_203e,al         ; (2913:5219=0)
2913:14A2  C6 06 51F9 02                        mov     byte ptr ds:data_202e,2 ; (2913:51F9=0)
2913:14A7  90                                   nop
2913:14A8  E8 0245                              call    sub_22                  ; (16F0)
2913:14AB                       loc_116:                                        ;  xref 2913:147C, 1484, 1491, 149D
                                                                                ;            14B1
2913:14AB  EB 77                                jmp     short loc_120           ; (1524)
2913:14AD  90                                   db      90h
2913:14AE                       loc_117:                                        ;  xref 2913:1495
2913:14AE  E8 007A                              call    sub_19                  ; (152B)
2913:14B1  73 F8                                jnc     loc_116
2913:14B3 .BB 15CD                              mov     bx,offset data_138      ; (2913:15CD='*(((&&&&&')
2913:14B6  8A 85 5097                           mov     al,ds:data_194e[di]     ; (2913:5097=0)
2913:14BA  D7                                   xlat
2913:14BB  E8 1A3C                              call    rndnum                  ; (2EFA)
2913:14BE  75 64                                jnz     loc_120
2913:14C0  8A 85 4FC5                           mov     al,ds:data_189e[di]     ; (2913:4FC5=0)
2913:14C4  2A 06 4FC5                           sub     al,ds:data_189e         ; (2913:4FC5=0)
2913:14C8  04 03                                add     al,3
2913:14CA  8A E0                                mov     ah,al
2913:14CC  D0 E0                                shl     al,1
2913:14CE  D0 E0                                shl     al,1
2913:14D0  D0 E0                                shl     al,1
2913:14D2  2A C4                                sub     al,ah
2913:14D4  02 85 4F9B                           add     al,ds:data_188e[di]     ; (2913:4F9B=0)
2913:14D8  2A 06 4F9B                           sub     al,ds:data_188e         ; (2913:4F9B=0)
2913:14DC  04 03                                add     al,3
2913:14DE  98                                   cbw
2913:14DF  8B F0                                mov     si,ax
2913:14E1  8A 94 5487                           mov     dl,ds:data_223e[si]     ; (2913:5487=0)
2913:14E5  84 D2                                test    dl,dl
2913:14E7  74 3B                                jz      loc_120
2913:14E9  8A 85 50D7                           mov     al,ds:ship_angle_e[di]  ; (2913:50D7=0)
2913:14ED .BB 15C5                              mov     bx,offset data_137      ; (2913:15C5=1)
2913:14F0  D7                                   xlat
2913:14F1  22 84 15F2                           and     al,data_139[si]         ; (2913:15F2=8)
2913:14F5  74 2D                                jz      loc_120
2913:14F7  B4 06                                mov     ah,6
2913:14F9  B0 25                                mov     al,25h                  ; '%'
2913:14FB  2A 85 5019                           sub     al,ds:data_191e[di]     ; (2913:5019=0)
2913:14FF  3A 85 4FEF                           cmp     al,ds:data_190e[di]     ; (2913:4FEF=0)
2913:1503  72 02                                jb      loc_118
2913:1505  B4 09                                mov     ah,9
2913:1507                       loc_118:                                        ;  xref 2913:1503
2913:1507  B6 0C                                mov     dh,0Ch
2913:1509  8A 85 4FEF                           mov     al,ds:data_190e[di]     ; (2913:4FEF=0)
2913:150D  40                                   inc     ax
2913:150E  3A 85 5019                           cmp     al,ds:data_191e[di]     ; (2913:5019=0)
2913:1512  72 02                                jb      loc_119
2913:1514  B6 03                                mov     dh,3
2913:1516                       loc_119:                                        ;  xref 2913:1512
2913:1516  22 E6                                and     ah,dh
2913:1518  22 E2                                and     ah,dl
2913:151A  74 08                                jz      loc_120
2913:151C  80 85 51F9 02                        add     byte ptr ds:data_202e[di],2 ; (2913:51F9=0)
2913:1521  E8 01CC                              call    sub_22                  ; (16F0)
2913:1524                       loc_120:                                        ;  xref 2913:14AB, 14BE, 14E7, 14F5
                                                                                ;            151A
2913:1524  4F                                   dec     di
2913:1525  78 03                                js      loc_ret_121
2913:1527  E9 FF4C                              jmp     loc_112                 ; (1476)

2913:152A                       loc_ret_121:                                    ;  xref 2913:1525
2913:152A  C3                                   retn
                                sub_18          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:14AE
                                ;==========================================================================

2913:152B                       sub_19          proc    near
2913:152B  8A 85 4F9B                           mov     al,ds:data_188e[di]     ; (2913:4F9B=0)
2913:152F  2A 06 4F9B                           sub     al,ds:data_188e         ; (2913:4F9B=0)
2913:1533  04 03                                add     al,3
2913:1535  3C 07                                cmp     al,7
2913:1537  73 42                                jae     loc_126
2913:1539  98                                   cbw
2913:153A  D1 E0                                shl     ax,1
2913:153C  8B D8                                mov     bx,ax
2913:153E  8A 85 4FC5                           mov     al,ds:data_189e[di]     ; (2913:4FC5=0)
2913:1542  2A 06 4FC5                           sub     al,ds:data_189e         ; (2913:4FC5=0)
2913:1546  04 03                                add     al,3
2913:1548  3C 07                                cmp     al,7
2913:154A  73 2F                                jae     loc_126
2913:154C  98                                   cbw
2913:154D  D1 E0                                shl     ax,1
2913:154F  8B F0                                mov     si,ax
2913:1551  8A 85 4FEF                           mov     al,ds:data_190e[di]     ; (2913:4FEF=0)
2913:1555  2A 06 4FEF                           sub     al,ds:data_190e         ; (2913:4FEF=0)
2913:1559  FF A7 15A9                           jmp     word ptr data_123[bx]   ;*(2913:15A9=155Dh)  14 entries

                                ;===== Indexed Entry Point ================================================

2913:155D                       loc_122:                                        ;  xref 2913:1559, 15A9
2913:155D  78 1C                                js      loc_126
2913:155F  3C 0E                                cmp     al,0Eh
2913:1561  73 1A                                jae     loc_127
2913:1563  EB 16                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:1565                       loc_123:                                        ;  xref 2913:1559, 15AB
2913:1565  79 16                                jns     loc_127
2913:1567  3C E8                                cmp     al,0E8h
2913:1569  73 12                                jae     loc_127
2913:156B  EB 0E                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:156D                       loc_124:                                        ;  xref 2913:1559, 15B3
2913:156D  78 0E                                js      loc_127
2913:156F  3C 19                                cmp     al,19h
2913:1571  72 0A                                jb      loc_127
2913:1573  EB 06                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:1575                       loc_125:                                        ;  xref 2913:1559, 15B5
2913:1575  79 04                                jns     loc_126
2913:1577  3C F3                                cmp     al,0F3h
2913:1579  72 02                                jb      loc_127
2913:157B                       loc_126:                                        ;  xref 2913:1537, 154A, 155D, 1563
                                                                                ;            156B, 1573, 1575, 1589
                                                                                ;            158F, 1597, 159F, 15A1
2913:157B ,F8                                   clc
2913:157C  C3                                   retn

                                ;===== Indexed Entry Point ================================================

2913:157D                       loc_127:                                        ;  xref 2913:1559, 1561, 1565, 1569
                                                                                ;            156D, 1571, 1579, 15AD
                                                                                ;            15AF, 15B1
2913:157D  8A 85 5019                           mov     al,ds:data_191e[di]     ; (2913:5019=0)
2913:1581  2A 06 5019                           sub     al,ds:data_191e         ; (2913:5019=0)
2913:1585  FF A4 15B7                           jmp     word ptr data_130[si]   ;*(2913:15B7=1589h)  7 entries

                                ;===== Indexed Entry Point ================================================

2913:1589                       loc_128:                                        ;  xref 2913:1559, 1585, 15B7
2913:1589  78 F0                                js      loc_126
2913:158B  3C 15                                cmp     al,15h
2913:158D  73 18                                jae     loc_132
2913:158F  EB EA                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:1591                       loc_129:                                        ;  xref 2913:1559, 1585, 15B9
2913:1591  79 14                                jns     loc_132
2913:1593  3C EF                                cmp     al,0EFh
2913:1595  73 10                                jae     loc_132
2913:1597  EB E2                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:1599                       loc_130:                                        ;  xref 2913:1559, 1585, 15C1
2913:1599  78 0C                                js      loc_132
2913:159B  3C 13                                cmp     al,13h
2913:159D  72 08                                jb      loc_132
2913:159F  EB DA                                jmp     short loc_126           ; (157B)

                                ;===== Indexed Entry Point ================================================

2913:15A1                       loc_131:                                        ;  xref 2913:1559, 1585, 15C3
2913:15A1  79 D8                                jns     loc_126
2913:15A3  3C EB                                cmp     al,0EBh
2913:15A5  72 00                                jb      loc_132

                                ;===== Indexed Entry Point ================================================

2913:15A7                       loc_132:                                        ;  xref 2913:1559, 1585, 158D, 1591
                                                                                ;            1595, 1599, 159D, 15A5
                                                                                ;            15BB, 15BD, 15BF
2913:15A7  F9                                   stc
2913:15A8  C3                                   retn
                                sub_19          endp

2913:15A9  155D                 data_123        dw      offset loc_122          ; Data table (indexed access)
                                                                                ;  xref 2913:1559
2913:15AB  1565                 data_124        dw      offset loc_123          ;  xref 2913:1559
2913:15AD  157D                 data_125        dw      offset loc_127          ;  xref 2913:1559
2913:15AF  157D                 data_126        dw      offset loc_127          ;  xref 2913:1559
2913:15B1  157D                 data_127        dw      offset loc_127          ;  xref 2913:1559
2913:15B3  156D                 data_128        dw      offset loc_124          ;  xref 2913:1559
2913:15B5  1575                 data_129        dw      offset loc_125          ;  xref 2913:1559
2913:15B7  1589                 data_130        dw      offset loc_128          ; Data table (indexed access)
                                                                                ;  xref 2913:1559, 1585
2913:15B9  1591                 data_131        dw      offset loc_129          ;  xref 2913:1559, 1585
2913:15BB  15A7                 data_132        dw      offset loc_132          ;  xref 2913:1559, 1585
2913:15BD  15A7                 data_133        dw      offset loc_132          ;  xref 2913:1559, 1585
2913:15BF  15A7                 data_134        dw      offset loc_132          ;  xref 2913:1559, 1585
2913:15C1  1599                 data_135        dw      offset loc_130          ;  xref 2913:1559, 1585
2913:15C3  15A1                 data_136        dw      offset loc_131          ;  xref 2913:1559, 1585
2913:15C5  01                   data_137        db      1                       ;  xref 2913:14ED
2913:15C6  02 04 08 10 20 40                    db       02h, 04h, 08h, 10h, 20h, 40h
2913:15CC  80                                   db       80h
2913:15CD  2A 28 28 28 26 26    data_138        db      '*(((&&&&&$'            ;  xref 2913:14B3
2913:15D3  26 26 26 24
2913:15D7  24 24 24 24                          db      '$$$$'
2913:15DB  22 22 22 22 22 20                    db      '"""""     '
2913:15E1  20 20 20 20
2913:15E5  1E 1E 1E 1E 1E 1C                    db       1Eh, 1Eh, 1Eh, 1Eh, 1Eh, 1Ch
2913:15EB  1C 1C 1C 1C 1A 1A                    db       1Ch, 1Ch, 1Ch, 1Ch, 1Ah, 1Ah
2913:15F1  1A                                   db       1Ah
2913:15F2  08                   data_139        db      8                       ; Data table (indexed access)
                                                                                ;  xref 2913:14F1
2913:15F3  08 00 10 00 20 20                    db       08h, 00h, 10h, 00h, 20h, 20h
2913:15F9  08 08 08 10 20 20                    db       08h, 08h, 08h, 10h, 20h, 20h
2913:15FF  20 00 08 08 38 20                    db       20h, 00h, 08h, 08h, 38h, 20h
2913:1605  20 00 04 04 0E FF                    db       20h, 00h, 04h, 04h, 0Eh,0FFh
2913:160B  E0                                   db      0E0h
2913:160C  40                   data_140        db      40h
2913:160D  40 00 02 02 83 80                    db       40h, 00h, 02h, 02h, 83h, 80h
2913:1613  80 00 02 02 02 01                    db       80h, 00h, 02h, 02h, 02h, 01h
2913:1619  80 80 80 02 02 00                    db       80h, 80h, 80h, 02h, 02h, 00h
2913:161F  01 00 80 80                          db       01h, 00h, 80h, 80h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0252
                                ;==========================================================================

2913:1623                       sub_20          proc    near
2913:1623  B4 0E                                mov     ah,0Eh
2913:1625  E8 EC99                              call    ega_map_mask            ; (02C1)
2913:1628 .BE 001E                              mov     si,data_7e              ; (2913:001E=0)
2913:162B                       loc_133:                                        ;  xref 2913:167E
2913:162B  80 BC 51B9 00                        cmp     byte ptr ds:data_200e[si],0 ; (2913:51B9=0)
2913:1630  75 4B                                jne     loc_135
2913:1632  32 FF                                xor     bh,bh
2913:1634  8A 9C 51D9                           mov     bl,ds:data_201e[si]     ; (2913:51D9=0)
2913:1638  D0 E3                                shl     bl,1
2913:163A  8B 97 0A7C                           mov     dx,data_92[bx]          ; (2913:0A7C=0FF00h)
2913:163E  8A 9C 5179                           mov     bl,ds:data_198e[si]     ; (2913:5179=0)
2913:1642  8A BC 5199                           mov     bh,ds:data_199e[si]     ; (2913:5199=0)
2913:1646  8B EB                                mov     bp,bx
2913:1648  B9 000C                              mov     cx,0Ch

2913:164B                       locloop_134:                                    ;  xref 2913:165C
2913:164B  E8 EED7                              call    vid_offset              ; (0525)
2913:164E  26: 84 05                            test    al,es:[di]
2913:1651  75 2E                                jnz     loc_136
2913:1653  02 FE                                add     bh,dh
2913:1655  02 DA                                add     bl,dl
2913:1657  E8 0108                              call    sub_23                  ; (1762)
2913:165A  72 38                                jc      loc_137
2913:165C  E2 ED                                loop    locloop_134

2913:165E  B1 03                                mov     cl,3
2913:1660  D2 E2                                shl     dl,cl
2913:1662  D2 E6                                shl     dh,cl
2913:1664  8B DD                                mov     bx,bp
2913:1666  02 DA                                add     bl,dl
2913:1668  02 FE                                add     bh,dh
2913:166A  E8 00F5                              call    sub_23                  ; (1762)
2913:166D  72 25                                jc      loc_137
2913:166F  E8 EEB3                              call    vid_offset              ; (0525)
2913:1672  26: 08 05                            or      es:[di],al
2913:1675  88 9C 5179                           mov     ds:data_198e[si],bl     ; (2913:5179=0)
2913:1679  88 BC 5199                           mov     ds:data_199e[si],bh     ; (2913:5199=0)
2913:167D                       loc_135:                                        ;  xref 2913:1630, 1692, 169A
2913:167D ,4E                                   dec     si
2913:167E  79 AB                                jns     loc_133
2913:1680  C3                                   retn
2913:1681                       loc_136:                                        ;  xref 2913:1651
2913:1681  C6 84 51B9 06                        mov     byte ptr ds:data_200e[si],6 ; (2913:51B9=0)
2913:1686  90                                   nop
2913:1687  88 9C 5179                           mov     ds:data_198e[si],bl     ; (2913:5179=0)
2913:168B  88 BC 5199                           mov     ds:data_199e[si],bh     ; (2913:5199=0)
2913:168F  E8 015D                              call    sub_26                  ; (17EF)
2913:1692  EB E9                                jmp     short loc_135           ; (167D)
2913:1694                       loc_137:                                        ;  xref 2913:165A, 166D
2913:1694  C6 84 51B9 FF                        mov     byte ptr ds:data_200e[si],0FFh ; (2913:51B9=0)
2913:1699  90                                   nop
2913:169A  EB E1                                jmp     short loc_135           ; (167D)
                                sub_20          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:022F
                                ;==========================================================================

2913:169C                       sub_21          proc    near
2913:169C  32 FF                                xor     bh,bh
2913:169E  8A 1E 5178                           mov     bl,ds:vel_angle_e       ; (2913:5178=0)
2913:16A2  02 1E 50D7                           add     bl,ds:ship_angle_e      ; (2913:50D7=0)
2913:16A6  80 E3 07                             and     bl,7
2913:16A9  A0 50B7                              mov     al,ds:vel_magn_e        ; (2913:50B7=0)
2913:16AC  D0 E0                                shl     al,1
2913:16AE  D0 E0                                shl     al,1
2913:16B0  D0 E0                                shl     al,1
2913:16B2  74 33                                jz      loc_ret_140
2913:16B4  02 D8                                add     bl,al
2913:16B6  D0 E3                                shl     bl,1
2913:16B8  8B 97 0A6C                           mov     dx,data_91[bx]          ; (2913:0A6C=0)
2913:16BC  F6 DA                                neg     dl
2913:16BE  F6 DE                                neg     dh
2913:16C0 .BE 001E                              mov     si,data_7e              ; (2913:001E=0)
2913:16C3                       loc_138:                                        ;  xref 2913:16E5
2913:16C3  F6 84 51B9 80                        test    byte ptr ds:data_200e[si],80h ; (2913:51B9=0)
2913:16C8  90                                   nop
2913:16C9  78 19                                js      loc_139
2913:16CB  8A 9C 5179                           mov     bl,ds:data_198e[si]     ; (2913:5179=0)
2913:16CF  8A BC 5199                           mov     bh,ds:data_199e[si]     ; (2913:5199=0)
2913:16D3  02 FE                                add     bh,dh
2913:16D5  02 DA                                add     bl,dl
2913:16D7  E8 0088                              call    sub_23                  ; (1762)
2913:16DA  72 0C                                jc      loc_141
2913:16DC  88 9C 5179                           mov     ds:data_198e[si],bl     ; (2913:5179=0)
2913:16E0  88 BC 5199                           mov     ds:data_199e[si],bh     ; (2913:5199=0)
2913:16E4                       loc_139:                                        ;  xref 2913:16C9, 16EE
2913:16E4 ,4E                                   dec     si
2913:16E5  79 DC                                jns     loc_138

2913:16E7                       loc_ret_140:                                    ;  xref 2913:16B2
2913:16E7  C3                                   retn
2913:16E8                       loc_141:                                        ;  xref 2913:16DA
2913:16E8  C6 84 51B9 FF                        mov     byte ptr ds:data_200e[si],0FFh ; (2913:51B9=0)
2913:16ED  90                                   nop
2913:16EE  EB F4                                jmp     short loc_139           ; (16E4)
                                sub_21          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:14A8, 1521
                                ;==========================================================================

2913:16F0                       sub_22          proc    near
2913:16F0  8A 9D 4F9B                           mov     bl,ds:data_188e[di]     ; (2913:4F9B=0)
2913:16F4  8A BD 4FC5                           mov     bh,ds:data_189e[di]     ; (2913:4FC5=0)
2913:16F8  8A 95 4FEF                           mov     dl,ds:data_190e[di]     ; (2913:4FEF=0)
2913:16FC  8A B5 5019                           mov     dh,ds:data_191e[di]     ; (2913:5019=0)
2913:1700  E8 006D                              call    sub_24                  ; (1770)
2913:1703  72 3A                                jc      loc_145
2913:1705 .BE 001E                              mov     si,data_7e              ; (2913:001E=0)
2913:1708  32 C0                                xor     al,al
2913:170A                       loc_142:                                        ;  xref 2913:1711
2913:170A  38 84 51B9                           cmp     ds:data_200e[si],al     ; (2913:51B9=0)
2913:170E  78 05                                js      loc_143
2913:1710  4E                                   dec     si
2913:1711  79 F7                                jns     loc_142
2913:1713  EB 3C                                jmp     short loc_ret_148       ; (1751)
2913:1715                       loc_143:                                        ;  xref 2913:170E
2913:1715  88 84 51B9                           mov     ds:data_200e[si],al     ; (2913:51B9=0)
2913:1719  8A 85 50D7                           mov     al,ds:ship_angle_e[di]  ; (2913:50D7=0)
2913:171D  85 FF                                test    di,di
2913:171F  75 03                                jnz     loc_144
2913:1721  A0 5177                              mov     al,ds:gun_angle_e       ; (2913:5177=0)
2913:1724                       loc_144:                                        ;  xref 2913:171F
2913:1724  88 84 51D9                           mov     ds:data_201e[si],al     ; (2913:51D9=0)
2913:1728  53                                   push    bx
2913:1729  D0 E0                                shl     al,1
2913:172B  98                                   cbw
2913:172C  8B D8                                mov     bx,ax
2913:172E  8B 97 1752                           mov     dx,data_141[bx]         ; (2913:1752=0FF03h)
2913:1732  5B                                   pop     bx
2913:1733  02 DA                                add     bl,dl
2913:1735  02 FE                                add     bh,dh
2913:1737  88 9C 5179                           mov     ds:data_198e[si],bl     ; (2913:5179=0)
2913:173B  88 BC 5199                           mov     ds:data_199e[si],bh     ; (2913:5199=0)
2913:173F                       loc_145:                                        ;  xref 2913:1703
2913:173F  B1 1E                                mov     cl,1Eh

2913:1741                       locloop_146:                                    ;  xref 2913:174F
2913:1741  B5 20                                mov     ch,20h                  ; ' '
2913:1743  E4 61                                in      al,61h                  ; port 61h, 8255 port B, read
2913:1745  32 06 2F66                           xor     al,data_181             ; (2913:2F66=2)
2913:1749  E6 61                                out     61h,al                  ; port 61h, 8255 B - spkr, etc
2913:174B                       loc_147:                                        ;  xref 2913:174D
2913:174B  FE CD                                dec     ch
2913:174D  75 FC                                jnz     loc_147
2913:174F  E2 F0                                loop    locloop_146


2913:1751                       loc_ret_148:                                    ;  xref 2913:1713
2913:1751  C3                                   retn
                                sub_22          endp

2913:1752  FF03                 data_141        dw      0FF03h                  ; Data table (indexed access)
                                                                                ;  xref 2913:172E
2913:1754  07 FF 07 03 07 07                    db       07h,0FFh, 07h, 03h, 07h, 07h
2913:175A  03 07 FF 07 FF 03                    db       03h, 07h,0FFh, 07h,0FFh, 03h
2913:1760  FF FF                                db      0FFh,0FFh

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1657, 166A, 16D7
                                ;==========================================================================

2913:1762                       sub_23          proc    near
2913:1762  80 FB CF                             cmp     bl,0CFh
2913:1765  77 07                                ja      loc_149
2913:1767  80 FF BE                             cmp     bh,0BEh
2913:176A  77 02                                ja      loc_149
2913:176C  F8                                   clc
2913:176D  C3                                   retn
2913:176E                       loc_149:                                        ;  xref 2913:1765, 176A
2913:176E  F9                                   stc
2913:176F  C3                                   retn
                                sub_23          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1700, 1A1B, 1E13, 1EAD, 24F7
                                ;==========================================================================

2913:1770                       sub_24          proc    near
2913:1770  2A 1E 4F9B                           sub     bl,ds:data_188e         ; (2913:4F9B=0)
2913:1774  80 C3 03                             add     bl,3
2913:1777  80 FB 07                             cmp     bl,7
2913:177A  73 4A                                jae     loc_151
2913:177C  8A C3                                mov     al,bl
2913:177E  8A DA                                mov     bl,dl
2913:1780  D0 E0                                shl     al,1
2913:1782  02 D8                                add     bl,al
2913:1784  D0 E0                                shl     al,1
2913:1786  02 D8                                add     bl,al
2913:1788  D0 E0                                shl     al,1
2913:178A  D0 E0                                shl     al,1
2913:178C  D0 E0                                shl     al,1
2913:178E  9F                                   lahf
2913:178F  02 D8                                add     bl,al
2913:1791  78 03                                js      loc_150
2913:1793  9E                                   sahf
2913:1794  78 30                                js      loc_151
2913:1796                       loc_150:                                        ;  xref 2913:1791
2913:1796  2A 1E 4FEF                           sub     bl,ds:data_190e         ; (2913:4FEF=0)
2913:179A  80 EB 0A                             sub     bl,0Ah
2913:179D  2A 3E 4FC5                           sub     bh,ds:data_189e         ; (2913:4FC5=0)
2913:17A1  80 C7 03                             add     bh,3
2913:17A4  80 FF 07                             cmp     bh,7
2913:17A7  73 1D                                jae     loc_151
2913:17A9  8A C7                                mov     al,bh
2913:17AB  8A FE                                mov     bh,dh
2913:17AD  D0 E0                                shl     al,1
2913:17AF  02 F8                                add     bh,al
2913:17B1  D0 E0                                shl     al,1
2913:17B3  02 F8                                add     bh,al
2913:17B5  D0 E0                                shl     al,1
2913:17B7  D0 E0                                shl     al,1
2913:17B9  D0 E0                                shl     al,1
2913:17BB  02 F8                                add     bh,al
2913:17BD  2A 3E 5019                           sub     bh,ds:data_191e         ; (2913:5019=0)
2913:17C1  80 EF 16                             sub     bh,16h
2913:17C4  F8                                   clc
2913:17C5  C3                                   retn
2913:17C6                       loc_151:                                        ;  xref 2913:177A, 1794, 17A7
2913:17C6  B3 FF                                mov     bl,0FFh
2913:17C8  8A FB                                mov     bh,bl
2913:17CA  F9                                   stc
2913:17CB  C3                                   retn
                                sub_24          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:17FE
                                ;==========================================================================

2913:17CC                       sub_25          proc    near
2913:17CC  B0 DA                                mov     al,0DAh
2913:17CE  8A E3                                mov     ah,bl
2913:17D0  B3 FF                                mov     bl,0FFh
2913:17D2                       loc_152:                                        ;  xref 2913:17D8
2913:17D2  FE C3                                inc     bl
2913:17D4  02 E0                                add     ah,al
2913:17D6  3A E0                                cmp     ah,al
2913:17D8  72 F8                                jb      loc_152
2913:17DA  2A E0                                sub     ah,al
2913:17DC  8A D4                                mov     dl,ah
2913:17DE  8A E7                                mov     ah,bh
2913:17E0  B7 FF                                mov     bh,0FFh
2913:17E2                       loc_153:                                        ;  xref 2913:17E8
2913:17E2  FE C7                                inc     bh
2913:17E4  02 E0                                add     ah,al
2913:17E6  3A E0                                cmp     ah,al
2913:17E8  72 F8                                jb      loc_153
2913:17EA  2A E0                                sub     ah,al
2913:17EC  8A F4                                mov     dh,ah
2913:17EE  C3                                   retn
                                sub_25          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:168F
                                ;==========================================================================

2913:17EF                       sub_26          proc    near
2913:17EF  53                                   push    bx
2913:17F0  80 C3 0D                             add     bl,0Dh
2913:17F3  02 1E 4FEF                           add     bl,ds:data_190e         ; (2913:4FEF=0)
2913:17F7  80 C7 13                             add     bh,13h
2913:17FA  02 3E 5019                           add     bh,ds:data_191e         ; (2913:5019=0)
2913:17FE  E8 FFCB                              call    sub_25                  ; (17CC)
2913:1801  80 EB 03                             sub     bl,3
2913:1804  02 1E 4F9B                           add     bl,ds:data_188e         ; (2913:4F9B=0)
2913:1808  80 EF 03                             sub     bh,3
2913:180B  02 3E 4FC5                           add     bh,ds:data_189e         ; (2913:4FC5=0)
2913:180F  58                                   pop     ax
2913:1810  2C 6B                                sub     al,6Bh                  ; 'k'
2913:1812  04 07                                add     al,7
2913:1814  3C 0F                                cmp     al,0Fh
2913:1816  73 17                                jae     loc_154
2913:1818  80 EC 5F                             sub     ah,5Fh                  ; '_'
2913:181B  80 C4 07                             add     ah,7
2913:181E  80 FC 0F                             cmp     ah,0Fh
2913:1821  73 0C                                jae     loc_154
2913:1823  C6 06 506D 0A                        mov     byte ptr ds:data_193e,0Ah ; (2913:506D=0)
2913:1828  90                                   nop
2913:1829  C6 06 5043 01                        mov     byte ptr ds:coll_flags1_e,1 ; (2913:5043=0)
2913:182E  90                                   nop
2913:182F                       loc_154:                                        ;  xref 2913:1816, 1821
2913:182F  8B EB                                mov     bp,bx
2913:1831  33 C9                                xor     cx,cx
2913:1833  E8 005D                              call    sub_27                  ; (1893)
2913:1836  80 FA 06                             cmp     dl,6
2913:1839  73 09                                jae     loc_155
2913:183B  FE C1                                inc     cl
2913:183D  FE CB                                dec     bl
2913:183F  E8 0051                              call    sub_27                  ; (1893)
2913:1842  EB 0C                                jmp     short loc_156           ; (1850)
2913:1844                       loc_155:                                        ;  xref 2913:1839
2913:1844  80 FA 20                             cmp     dl,20h                  ; ' '
2913:1847  72 07                                jb      loc_156
2913:1849  FE C9                                dec     cl
2913:184B  FE C3                                inc     bl
2913:184D  E8 0043                              call    sub_27                  ; (1893)
2913:1850                       loc_156:                                        ;  xref 2913:1842, 1847
2913:1850  80 FE 06                             cmp     dh,6
2913:1853  73 1D                                jae     loc_158
2913:1855  FE CF                                dec     bh
2913:1857  E8 0039                              call    sub_27                  ; (1893)
2913:185A  84 C9                                test    cl,cl
2913:185C  74 34                                jz      loc_ret_160
2913:185E  78 09                                js      loc_157
2913:1860  FE CB                                dec     bl
2913:1862  FE CF                                dec     bh
2913:1864  E8 002C                              call    sub_27                  ; (1893)
2913:1867  EB 29                                jmp     short loc_ret_160       ; (1892)
2913:1869                       loc_157:                                        ;  xref 2913:185E
2913:1869  FE C3                                inc     bl
2913:186B  FE CF                                dec     bh
2913:186D  E8 0023                              call    sub_27                  ; (1893)
2913:1870  EB 20                                jmp     short loc_ret_160       ; (1892)
2913:1872                       loc_158:                                        ;  xref 2913:1853
2913:1872  80 FE 20                             cmp     dh,20h                  ; ' '
2913:1875  72 1B                                jb      loc_ret_160
2913:1877  FE C7                                inc     bh
2913:1879  E8 0017                              call    sub_27                  ; (1893)
2913:187C  84 C9                                test    cl,cl
2913:187E  74 12                                jz      loc_ret_160
2913:1880  78 09                                js      loc_159
2913:1882  FE CB                                dec     bl
2913:1884  FE C7                                inc     bh
2913:1886  E8 000A                              call    sub_27                  ; (1893)
2913:1889  EB 07                                jmp     short loc_ret_160       ; (1892)
2913:188B                       loc_159:                                        ;  xref 2913:1880
2913:188B  FE C3                                inc     bl
2913:188D  FE C7                                inc     bh
2913:188F  E8 0001                              call    sub_27                  ; (1893)

2913:1892                       loc_ret_160:                                    ;  xref 2913:185C, 1867, 1870, 1875
                                                                                ;            187E, 1889
2913:1892  C3                                   retn
                                sub_26          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1833, 183F, 184D, 1857, 1864, 186D, 1879
                                ;                             1886, 188F
                                ;==========================================================================

2913:1893                       sub_27          proc    near
2913:1893  E8 0A6F                              call    tmp1_readxy             ; (2305)
2913:1896  8B DD                                mov     bx,bp
2913:1898  EB 07                                jmp     short loc_162           ; (18A1)
2913:189A                       loc_161:                                        ;  xref 2913:18B0, 18B6, 18D2, 18EE
                                                                                ;            18FC, 1920
2913:189A ,8A 85 50F7                           mov     al,ds:data_195e[di]     ; (2913:50F7=0)
2913:189E  98                                   cbw
2913:189F  84 C0                                test    al,al
2913:18A1                       loc_162:                                        ;  xref 2913:1898
2913:18A1  8B F8                                mov     di,ax
2913:18A3  75 01                                jnz     loc_163
2913:18A5  C3                                   retn
2913:18A6                       loc_163:                                        ;  xref 2913:18A3
2913:18A6  8A 85 5043                           mov     al,ds:coll_flags1_e[di] ; (2913:5043=0)
2913:18AA  84 C0                                test    al,al
2913:18AC  74 0A                                jz      loc_164
2913:18AE  3C 01                                cmp     al,1
2913:18B0  74 E8                                je      loc_161
2913:18B2  24 70                                and     al,70h                  ; 'p'
2913:18B4  3C 10                                cmp     al,10h
2913:18B6  74 E2                                je      loc_161
2913:18B8                       loc_164:                                        ;  xref 2913:18AC
2913:18B8  8A C3                                mov     al,bl
2913:18BA  2A 85 4F9B                           sub     al,ds:data_188e[di]     ; (2913:4F9B=0)
2913:18BE  74 08                                jz      loc_166
2913:18C0  79 04                                jns     loc_165
2913:18C2  B0 DA                                mov     al,0DAh
2913:18C4  EB 02                                jmp     short loc_166           ; (18C8)
2913:18C6                       loc_165:                                        ;  xref 2913:18C0
2913:18C6  B0 26                                mov     al,26h                  ; '&'
2913:18C8                       loc_166:                                        ;  xref 2913:18BE, 18C4
2913:18C8  02 C2                                add     al,dl
2913:18CA  2A 85 4FEF                           sub     al,ds:data_190e[di]     ; (2913:4FEF=0)
2913:18CE  04 06                                add     al,6
2913:18D0  3C 0D                                cmp     al,0Dh
2913:18D2  73 C6                                jae     loc_161
2913:18D4  8A C7                                mov     al,bh
2913:18D6  2A 85 4FC5                           sub     al,ds:data_189e[di]     ; (2913:4FC5=0)
2913:18DA  74 08                                jz      loc_168
2913:18DC  79 04                                jns     loc_167
2913:18DE  B0 DA                                mov     al,0DAh
2913:18E0  EB 02                                jmp     short loc_168           ; (18E4)
2913:18E2                       loc_167:                                        ;  xref 2913:18DC
2913:18E2  B0 26                                mov     al,26h                  ; '&'
2913:18E4                       loc_168:                                        ;  xref 2913:18DA, 18E0
2913:18E4  02 C6                                add     al,dh
2913:18E6  2A 85 5019                           sub     al,ds:data_191e[di]     ; (2913:5019=0)
2913:18EA  04 06                                add     al,6
2913:18EC  3C 0D                                cmp     al,0Dh
2913:18EE  73 AA                                jae     loc_161
2913:18F0  8A 85 5043                           mov     al,ds:coll_flags1_e[di] ; (2913:5043=0)
2913:18F4  8A E0                                mov     ah,al
2913:18F6  80 E4 70                             and     ah,70h                  ; 'p'
2913:18F9  80 FC 60                             cmp     ah,60h                  ; '`'
2913:18FC  74 9C                                je      loc_161
2913:18FE  84 E4                                test    ah,ah
2913:1900  74 0B                                jz      loc_169
2913:1902  24 0F                                and     al,0Fh
2913:1904  98                                   cbw
2913:1905  53                                   push    bx
2913:1906  8B D8                                mov     bx,ax
2913:1908  88 A7 521A                           mov     ds:data_204e[bx],ah     ; (2913:521A=0)
2913:190C  5B                                   pop     bx
2913:190D                       loc_169:                                        ;  xref 2913:1900
2913:190D  C6 85 506D 0A                        mov     byte ptr ds:data_193e[di],0Ah ; (2913:506D=0)
2913:1912  90                                   nop
2913:1913  C6 85 5043 01                        mov     byte ptr ds:coll_flags1_e[di],1 ; (2913:5043=0)
2913:1918  90                                   nop
2913:1919  52                                   push    dx
2913:191A  B2 01                                mov     dl,1
2913:191C  E8 03A8                              call    inc_fuel                ; (1CC7)
2913:191F  5A                                   pop     dx
2913:1920  E9 FF77                              jmp     loc_161                 ; (189A)
                                sub_27          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1CAF
                                ;==========================================================================

2913:1923                       sub_28          proc    near
2913:1923 .BE 001E                              mov     si,data_7e              ; (2913:001E=0)
2913:1926                       loc_170:                                        ;  xref 2913:19AA
2913:1926 ,8A 84 51B9                           mov     al,ds:data_200e[si]     ; (2913:51B9=0)
2913:192A  84 C0                                test    al,al
2913:192C  78 0B                                js      loc_171
2913:192E  74 09                                jz      loc_171
2913:1930  98                                   cbw
2913:1931  48                                   dec     ax
2913:1932  75 07                                jnz     loc_172
2913:1934  48                                   dec     ax
2913:1935  88 84 51B9                           mov     ds:data_200e[si],al     ; (2913:51B9=0)
2913:1939                       loc_171:                                        ;  xref 2913:192C, 192E
2913:1939  EB 6C                                jmp     short loc_178           ; (19A7)
2913:193B                       loc_172:                                        ;  xref 2913:1932
2913:193B  B9 0007                              mov     cx,7
2913:193E  88 84 51B9                           mov     ds:data_200e[si],al     ; (2913:51B9=0)
2913:1942  3C 02                                cmp     al,2
2913:1944  72 61                                jb      loc_178
2913:1946  8A BC 5199                           mov     bh,ds:data_199e[si]     ; (2913:5199=0)
2913:194A  02 F9                                add     bh,cl
2913:194C  80 FF C7                             cmp     bh,0C7h
2913:194F  73 56                                jae     loc_178
2913:1951  80 EF 0A                             sub     bh,0Ah
2913:1954  8A 9C 5179                           mov     bl,ds:data_198e[si]     ; (2913:5179=0)
2913:1958  80 C3 03                             add     bl,3
2913:195B  80 FB D3                             cmp     bl,0D3h
2913:195E  73 47                                jae     loc_178
2913:1960  D0 E0                                shl     al,1
2913:1962  8B F8                                mov     di,ax
2913:1964  8B AD 19AA                           mov     bp,word ptr ds:[19AAh][di] ; (2913:19AA=79E9h)

2913:1968                       locloop_173:                                    ;  xref 2913:19A5
2913:1968  E4 61                                in      al,61h                  ; port 61h, 8255 port B, read
2913:196A  32 06 2F66                           xor     al,data_181             ; (2913:2F66=2)
2913:196E  E6 61                                out     61h,al                  ; port 61h, 8255 B - spkr, etc
2913:1970  80 FF C0                             cmp     bh,0C0h
2913:1973  73 2D                                jae     loc_177
2913:1975  F8                                   clc
2913:1976  E8 EBAC                              call    vid_offset              ; (0525)
2913:1979  8A E8                                mov     ch,al
2913:197B  8A C2                                mov     al,dl
2913:197D  8A 46 00                             mov     al,[bp]
2913:1980  E8 0330                              call    sub_31                  ; (1CB3)
2913:1983  98                                   cbw
2913:1984                       loc_174:                                        ;  xref 2913:198A
2913:1984 ,D0 ED                                shr     ch,1
2913:1986  74 04                                jz      loc_175
2913:1988  D1 E0                                shl     ax,1
2913:198A  EB F8                                jmp     short loc_174           ; (1984)
2913:198C                       loc_175:                                        ;  xref 2913:1986
2913:198C  8A D3                                mov     dl,bl
2913:198E  80 EA 08                             sub     dl,8
2913:1991  80 FA D0                             cmp     dl,0D0h
2913:1994  73 04                                jae     loc_176
2913:1996  26: 08 65 FF                         or      es:[di-1],ah
2913:199A                       loc_176:                                        ;  xref 2913:1994
2913:199A  80 FB D0                             cmp     bl,0D0h
2913:199D  73 03                                jae     loc_177
2913:199F  26: 08 05                            or      es:[di],al
2913:19A2                       loc_177:                                        ;  xref 2913:1973, 199D
2913:19A2  FE C7                                inc     bh
2913:19A4  45                                   inc     bp
2913:19A5  E2 C1                                loop    locloop_173

2913:19A7                       loc_178:                                        ;  xref 2913:1939, 1944, 194F, 195E
2913:19A7  4E                                   dec     si
2913:19A8  78 03                                js      loc_ret_179
2913:19AA  E9 FF79                              jmp     loc_170                 ; (1926)

2913:19AD                       loc_ret_179:                                    ;  xref 2913:19A8
2913:19AD  C3                                   retn
                                sub_28          endp

2913:19AE  B6 19 BD 19 C4 19                    db      0B6h, 19h,0BDh, 19h,0C4h, 19h
2913:19B4  C4 19 00 00 1C 1C                    db      0C4h, 19h, 00h, 00h, 1Ch, 1Ch
2913:19BA  1C 00 00 00 1C 3E                    db       1Ch, 00h, 00h, 00h, 1Ch, 3Eh
2913:19C0  3E 3E 1C 00 1C 3E                    db       3Eh, 3Eh, 1Ch, 00h, 1Ch, 3Eh
2913:19C6  7F 7F 7F 3E 1C                       db       7Fh, 7Fh, 7Fh, 3Eh, 1Ch
2913:19CB  FE                   data_143        db      0FEh                    ;  xref 2913:1CBC
2913:19CC  FD FB F7 EF DF BF                    db      0FDh,0FBh,0F7h,0EFh,0DFh,0BFh
2913:19D2  FF FE FD FB F7 EF                    db      0FFh,0FEh,0FDh,0FBh,0F7h,0EFh
2913:19D8  DF BF FF FE FD FB                    db      0DFh,0BFh,0FFh,0FEh,0FDh,0FBh
2913:19DE  F7 EF DF BF FF FA                    db      0F7h,0EFh,0DFh,0BFh,0FFh,0FAh
2913:19E4  F6 EE DE BE F5 ED                    db      0F6h,0EEh,0DEh,0BEh,0F5h,0EDh
2913:19EA  DD BD EB DB BB D7                    db      0DDh,0BDh,0EBh,0DBh,0BBh,0D7h
2913:19F0  B7 AF FF EA DA BA                    db      0B7h,0AFh,0FFh,0EAh,0DAh,0BAh
2913:19F6  D6 B6 AE D5 B5 AD                    db      0D6h,0B6h,0AEh,0D5h,0B5h,0ADh
2913:19FC  AB                                   db      0ABh
2913:19FD  000E[FF]                             db      14 dup (0FFh)

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1C91
                                ;==========================================================================

2913:1A0B                       sub_29          proc    near
2913:1A0B  8A 9C 4F9B                           mov     bl,ds:data_188e[si]     ; (2913:4F9B=0)
2913:1A0F  8A BC 4FC5                           mov     bh,ds:data_189e[si]     ; (2913:4FC5=0)
2913:1A13  8A 94 4FEF                           mov     dl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:1A17  8A B4 5019                           mov     dh,ds:data_191e[si]     ; (2913:5019=0)
2913:1A1B  E8 FD52                              call    sub_24                  ; (1770)
2913:1A1E  73 03                                jnc     loc_180
2913:1A20  E9 0087                              jmp     loc_ret_189             ; (1AAA)
2913:1A23                       loc_180:                                        ;  xref 2913:1A1E
2913:1A23  80 EF 07                             sub     bh,7
2913:1A26  80 C3 0D                             add     bl,0Dh
2913:1A29  8A 84 506D                           mov     al,ds:data_193e[si]     ; (2913:506D=0)
2913:1A2D  D0 E0                                shl     al,1
2913:1A2F  98                                   cbw
2913:1A30  8B E8                                mov     bp,ax
2913:1A32  8B AE 1AA5                           mov     bp,[bp+1AA5h]
2913:1A36  B9 0015                              mov     cx,15h

2913:1A39                       locloop_181:                                    ;  xref 2913:1AA8
2913:1A39  E4 61                                in      al,61h                  ; port 61h, 8255 port B, read
2913:1A3B  32 06 2F66                           xor     al,data_181             ; (2913:2F66=2)
2913:1A3F  E6 61                                out     61h,al                  ; port 61h, 8255 B - spkr, etc
2913:1A41  51                                   push    cx
2913:1A42  80 FF BF                             cmp     bh,0BFh
2913:1A45  77 5B                                ja      loc_187
2913:1A47  F8                                   clc
2913:1A48  E8 EADA                              call    vid_offset              ; (0525)
2913:1A4B  8A E8                                mov     ch,al
2913:1A4D  8A 46 00                             mov     al,[bp]
2913:1A50  E8 0260                              call    sub_31                  ; (1CB3)
2913:1A53  8A D0                                mov     dl,al
2913:1A55  45                                   inc     bp
2913:1A56  8A 46 00                             mov     al,[bp]
2913:1A59  E8 0257                              call    sub_31                  ; (1CB3)
2913:1A5C  8A E0                                mov     ah,al
2913:1A5E  45                                   inc     bp
2913:1A5F  8A 46 00                             mov     al,[bp]
2913:1A62  E8 024E                              call    sub_31                  ; (1CB3)
2913:1A65  45                                   inc     bp
2913:1A66  32 F6                                xor     dh,dh
2913:1A68                       loc_182:                                        ;  xref 2913:1A70
2913:1A68 ,D0 ED                                shr     ch,1
2913:1A6A  74 06                                jz      loc_183
2913:1A6C  D1 E0                                shl     ax,1
2913:1A6E  D1 D2                                rcl     dx,1
2913:1A70  EB F6                                jmp     short loc_182           ; (1A68)
2913:1A72                       loc_183:                                        ;  xref 2913:1A6A
2913:1A72  8A CB                                mov     cl,bl
2913:1A74  80 E9 18                             sub     cl,18h
2913:1A77  80 F9 D0                             cmp     cl,0D0h
2913:1A7A  73 04                                jae     loc_184
2913:1A7C  26: 08 75 FD                         or      es:[di-3],dh
2913:1A80                       loc_184:                                        ;  xref 2913:1A7A
2913:1A80  80 C1 08                             add     cl,8
2913:1A83  80 F9 D0                             cmp     cl,0D0h
2913:1A86  73 04                                jae     loc_185
2913:1A88  26: 08 55 FE                         or      es:[di-2],dl
2913:1A8C                       loc_185:                                        ;  xref 2913:1A86
2913:1A8C  80 C1 08                             add     cl,8
2913:1A8F  80 F9 D0                             cmp     cl,0D0h
2913:1A92  73 04                                jae     loc_186
2913:1A94  26: 08 65 FF                         or      es:[di-1],ah
2913:1A98                       loc_186:                                        ;  xref 2913:1A92
2913:1A98  80 FB D0                             cmp     bl,0D0h
2913:1A9B  73 08                                jae     loc_188
2913:1A9D  26: 08 05                            or      es:[di],al
2913:1AA0  EB 03                                jmp     short loc_188           ; (1AA5)
2913:1AA2                       loc_187:                                        ;  xref 2913:1A45
2913:1AA2  45                                   inc     bp
2913:1AA3  45                                   inc     bp
2913:1AA4  45                                   inc     bp
2913:1AA5                       loc_188:                                        ;  xref 2913:1A9B, 1AA0
2913:1AA5  FE C7                                inc     bh
2913:1AA7  59                                   pop     cx
2913:1AA8  E2 8F                                loop    locloop_181


2913:1AAA                       loc_ret_189:                                    ;  xref 2913:1A20
2913:1AAA  C3                                   retn
                                sub_29          endp

                                                                                ; Inter-segment boundary
2913:1AAB  35 1C F6 1B BA 1B                    db       35h, 1Ch,0F6h, 1Bh,0BAh, 1Bh
2913:1AB1  81 1B 4B 1B 18 1B                    db       81h, 1Bh, 4Bh, 1Bh, 18h, 1Bh
2913:1AB7  E8 1A BB 1A                          db      0E8h, 1Ah,0BBh, 1Ah
2913:1ABB  0016[00]                             db      22 dup (0)
2913:1AD1  0E 00 00 1F 00 00                    db       0Eh, 00h, 00h, 1Fh, 00h, 00h
2913:1AD7  3F 80 00 3F 80 00                    db       3Fh, 80h, 00h, 3Fh, 80h, 00h
2913:1ADD  3F 80 00 1F 00 00                    db       3Fh, 80h, 00h, 1Fh, 00h, 00h
2913:1AE3  0E                                   db       0Eh
2913:1AE4  0017[00]                             db      23 dup (0)
2913:1AFB  0E 00 00 1F 00 00                    db       0Eh, 00h, 00h, 1Fh, 00h, 00h
2913:1B01  3F 80 00 7F C0 00                    db       3Fh, 80h, 00h, 7Fh,0C0h, 00h
2913:1B07  7F C0 00 7F C0 00                    db       7Fh,0C0h, 00h, 7Fh,0C0h, 00h
2913:1B0D  3F 80 00 1F 00 00                    db       3Fh, 80h, 00h, 1Fh, 00h, 00h
2913:1B13  0E                                   db       0Eh
2913:1B14  0014[00]                             db      20 dup (0)
2913:1B28  0E 00 00 3F 80 00                    db       0Eh, 00h, 00h, 3Fh, 80h, 00h
2913:1B2E  7F C0 00 7F C0 00                    db       7Fh,0C0h, 00h, 7Fh,0C0h, 00h
2913:1B34  FF E0 00 FF E0 00                    db      0FFh,0E0h, 00h,0FFh,0E0h, 00h
2913:1B3A  FF E0 00 7F C0 00                    db      0FFh,0E0h, 00h, 7Fh,0C0h, 00h
2913:1B40  7F C0 00 3F 80 00                    db       7Fh,0C0h, 00h, 3Fh, 80h, 00h
2913:1B46  0E                                   db       0Eh
2913:1B47  0011[00]                             db      17 dup (0)
2913:1B58  1F 00 00 7F C0 00                    db       1Fh, 00h, 00h, 7Fh,0C0h, 00h
2913:1B5E  FF E0 00 FF E0 01                    db      0FFh,0E0h, 00h,0FFh,0E0h, 01h
2913:1B64  FF F0 01 FF F0 01                    db      0FFh,0F0h, 01h,0FFh,0F0h, 01h
2913:1B6A  FF F0 01 FF F0 01                    db      0FFh,0F0h, 01h,0FFh,0F0h, 01h
2913:1B70  FF F0 00 FF E0 00                    db      0FFh,0F0h, 00h,0FFh,0E0h, 00h
2913:1B76  FF E0 00 7F C0 00                    db      0FFh,0E0h, 00h, 7Fh,0C0h, 00h
2913:1B7C  1F                                   db       1Fh
2913:1B7D  000E[00]                             db      14 dup (0)
2913:1B8B  1F 00 00 7F C0 00                    db       1Fh, 00h, 00h, 7Fh,0C0h, 00h
2913:1B91  FF E0 01 FF F0 01                    db      0FFh,0E0h, 01h,0FFh,0F0h, 01h
2913:1B97  FF F0 03 F1 F8 03                    db      0FFh,0F0h, 03h,0F1h,0F8h, 03h
2913:1B9D  E0 F8 03 E0 F8 03                    db      0E0h,0F8h, 03h,0E0h,0F8h, 03h
2913:1BA3  E0 F8 03 F1 F8 01                    db      0E0h,0F8h, 03h,0F1h,0F8h, 01h
2913:1BA9  FF F0 01 FF F0 00                    db      0FFh,0F0h, 01h,0FFh,0F0h, 00h
2913:1BAF  FF E0 00 7F C0 00                    db      0FFh,0E0h, 00h, 7Fh,0C0h, 00h
2913:1BB5  1F                                   db       1Fh
2913:1BB6  000B[00]                             db      11 dup (0)
2913:1BC1  1F 00 00 7F C0 00                    db       1Fh, 00h, 00h, 7Fh,0C0h, 00h
2913:1BC7  FF E0 01 FF F0 03                    db      0FFh,0E0h, 01h,0FFh,0F0h, 03h
2913:1BCD  FF F8 03 F1 F8 07                    db      0FFh,0F8h, 03h,0F1h,0F8h, 07h
2913:1BD3  E0 FC 07 C0 7C 07                    db      0E0h,0FCh, 07h,0C0h, 7Ch, 07h
2913:1BD9  C0 7C 07 C0 7C 07                    db      0C0h, 7Ch, 07h,0C0h, 7Ch, 07h
2913:1BDF  E0 FC 03 F1 F8 03                    db      0E0h,0FCh, 03h,0F1h,0F8h, 03h
2913:1BE5  FF F8 01 FF F0 00                    db      0FFh,0F8h, 01h,0FFh,0F0h, 00h
2913:1BEB  FF E0 00 7F C0 00                    db      0FFh,0E0h, 00h, 7Fh,0C0h, 00h
2913:1BF1  1F                                   db       1Fh
2913:1BF2  0008[00]                             db      8 dup (0)
2913:1BFA  3F 80 00 FF E0 01                    db       3Fh, 80h, 00h,0FFh,0E0h, 01h
2913:1C00  FF F0 03 F1 F8 07                    db      0FFh,0F0h, 03h,0F1h,0F8h, 07h
2913:1C06  C0 7C 07 80 3C 0F                    db      0C0h, 7Ch, 07h, 80h, 3Ch, 0Fh
2913:1C0C  00 1E 0F 00 1E 0E                    db       00h, 1Eh, 0Fh, 00h, 1Eh, 0Eh
2913:1C12  00 0E 0E 00 0E 0E                    db       00h, 0Eh, 0Eh, 00h, 0Eh, 0Eh
2913:1C18  00 0E 0F 00 1E 0F                    db       00h, 0Eh, 0Fh, 00h, 1Eh, 0Fh
2913:1C1E  00 1E 07 80 3C 07                    db       00h, 1Eh, 07h, 80h, 3Ch, 07h
2913:1C24  C0 7C 03 F1 F8 01                    db      0C0h, 7Ch, 03h,0F1h,0F8h, 01h
2913:1C2A  FF F0 00 FF E0 00                    db      0FFh,0F0h, 00h,0FFh,0E0h, 00h
2913:1C30  3F 80 00 00 00 00    data_152        db       3Fh, 80h, 00h, 00h, 00h, 00h
2913:1C36  3F 80 00 80 20 01                    db       3Fh, 80h, 00h, 80h, 20h, 01h
2913:1C3C  00 10 02 00 08 04                    db       00h, 10h, 02h, 00h, 08h, 04h
2913:1C42  00 04 08 00 02 00                    db       00h, 04h, 08h, 00h, 02h, 00h
2913:1C48  00 00 10 00 01 10                    db       00h, 00h, 10h, 00h, 01h, 10h
2913:1C4E  00 01 10 00 01 10                    db       00h, 01h, 10h, 00h, 01h, 10h
2913:1C54  00 01 10 00 01 10                    db       00h, 01h, 10h, 00h, 01h, 10h
2913:1C5A  00 01 10 00 01 00                    db       00h, 01h, 10h, 00h, 01h, 00h
2913:1C60  00 00 08 00 02 04                    db       00h, 00h, 08h, 00h, 02h, 04h
2913:1C66  00 04 02 00 08 01                    db       00h, 04h, 02h, 00h, 08h, 01h
2913:1C6C  00 10 00 80 20 00                    db       00h, 10h, 00h, 80h, 20h, 00h
2913:1C72  3F 80                                db       3Fh, 80h
                                                                                ; Inter-segment boundary

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:023F
                                ;==========================================================================

2913:1C74                       sub_30          proc    near
2913:1C74  B4 0E                                mov     ah,0Eh
2913:1C76  E8 E648                              call    ega_map_mask            ; (02C1)
2913:1C79 .BE 0029                              mov     si,data_10e             ; (2913:0029=0)
2913:1C7C                       loc_190:                                        ;  xref 2913:1CAD
2913:1C7C  8A 84 5043                           mov     al,ds:coll_flags1_e[si] ; (2913:5043=0)
2913:1C80  84 C0                                test    al,al
2913:1C82  74 28                                jz      loc_192
2913:1C84  78 26                                js      loc_192
2913:1C86  A8 60                                test    al,60h                  ; '`'
2913:1C88  75 22                                jnz     loc_192
2913:1C8A  80 BC 506D 03                        cmp     byte ptr ds:data_193e[si],3 ; (2913:506D=0)
2913:1C8F  72 03                                jb      loc_191
2913:1C91  E8 FD77                              call    sub_29                  ; (1A0B)
2913:1C94                       loc_191:                                        ;  xref 2913:1C8F
2913:1C94  FE 8C 506D                           dec     byte ptr ds:data_193e[si] ; (2913:506D=0)
2913:1C98  75 12                                jnz     loc_192
2913:1C9A  C6 84 5043 FF                        mov     byte ptr ds:coll_flags1_e[si],0FFh ; (2913:5043=0)
2913:1C9F  90                                   nop
2913:1CA0  83 FE 20                             cmp     si,20h
2913:1CA3  73 07                                jae     loc_192
2913:1CA5  85 F6                                test    si,si
2913:1CA7  74 03                                jz      loc_192
2913:1CA9  E8 0698                              call    sub_45                  ; (2344)
2913:1CAC                       loc_192:                                        ;  xref 2913:1C82, 1C84, 1C88, 1C98
                                                                                ;            1CA3, 1CA7
2913:1CAC  4E                                   dec     si
2913:1CAD  79 CD                                jns     loc_190
2913:1CAF  E8 FC71                              call    sub_28                  ; (1923)
2913:1CB2  C3                                   retn
                                sub_30          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1980, 1A50, 1A59, 1A62
                                ;==========================================================================

2913:1CB3                       sub_31          proc    near
2913:1CB3  53                                   push    bx
2913:1CB4  52                                   push    dx
2913:1CB5  8B D0                                mov     dx,ax
2913:1CB7  B0 40                                mov     al,40h                  ; '@'
2913:1CB9  E8 1215                              call    rnd_update              ; (2ED1)
2913:1CBC .BB 19CB                              mov     bx,offset data_143      ; (2913:19CB=0FEh)
2913:1CBF  D7                                   xlat
2913:1CC0  22 C2                                and     al,dl
2913:1CC2  8A E6                                mov     ah,dh
2913:1CC4  5A                                   pop     dx
2913:1CC5  5B                                   pop     bx
2913:1CC6  C3                                   retn
                                sub_31          endp


                                ;==========================================================================
                                ;         Update the fuel level based on DL
                                ;
                                ;         Called from:   2913:191C, 1E81, 2596
                                ;==========================================================================

2913:1CC7                       inc_fuel        proc    near
2913:1CC7  80 FA 01                             cmp     dl,1
2913:1CCA  77 05                                ja      loc_193
2913:1CCC  B8 0064                              mov     ax,64h
2913:1CCF  EB 03                                jmp     short loc_194           ; (1CD4)
2913:1CD1                       loc_193:                                        ;  xref 2913:1CCA
2913:1CD1  B8 1F40                              mov     ax,1F40h
2913:1CD4                       loc_194:                                        ;  xref 2913:1CCF
2913:1CD4  01 06 4F97                           add     ds:fuel_level_e,ax      ; (2913:4F97=0)
2913:1CD8  81 3E 4F97 3FFF                      cmp     word ptr ds:fuel_level_e,3FFFh ; (2913:4F97=0)
2913:1CDE  76 06                                jbe     loc_195
2913:1CE0  C7 06 4F97 3FFF                      mov     word ptr ds:fuel_level_e,3FFFh ; (2913:4F97=0)
2913:1CE6                       loc_195:                                        ;  xref 2913:1CDE
2913:1CE6  8A 26 2F54                           mov     ah,level                ; (2913:2F54=0)
2913:1CEA  FE C4                                inc     ah
2913:1CEC  B9 0006                              mov     cx,6
2913:1CEF .BB 2F5B                              mov     bx,offset strb_score+5  ; (2913:2F5B=0)

2913:1CF2                       locloop_196:                                    ;  xref 2913:1D11
2913:1CF2  8A 07                                mov     al,[bx]
2913:1CF4  3C 25                                cmp     al,25h                  ; '%'
2913:1CF6  72 02                                jb      loc_197
2913:1CF8  32 C0                                xor     al,al
2913:1CFA                       loc_197:                                        ;  xref 2913:1CF6
2913:1CFA  D0 EA                                shr     dl,1
2913:1CFC  75 0C                                jnz     loc_198
2913:1CFE  02 C4                                add     al,ah
2913:1D00  32 E4                                xor     ah,ah
2913:1D02  3C 0A                                cmp     al,0Ah
2913:1D04  72 04                                jb      loc_198
2913:1D06  2C 0A                                sub     al,0Ah
2913:1D08  FE C4                                inc     ah
2913:1D0A                       loc_198:                                        ;  xref 2913:1CFC, 1D04
2913:1D0A  88 07                                mov     [bx],al
2913:1D0C  84 E4                                test    ah,ah
2913:1D0E  74 03                                jz      loc_199
2913:1D10  4B                                   dec     bx
2913:1D11  E2 DF                                loop    locloop_196

2913:1D13                       loc_199:                                        ;  xref 2913:1D0E
2913:1D13  E8 F324                              call    disp_score              ; (103A)
2913:1D16  C3                                   retn
                                inc_fuel        endp


                                ;==========================================================================
                                ;         Update values of high score, level and density
                                ;
                                ;         Called from:   2913:015C
                                ;==========================================================================

2913:1D17                       update_hisco    proc    near
2913:1D17 .BE 2F56                              mov     si,offset strb_score    ; (2913:2F56=25h)
2913:1D1A .BB 2F5D                              mov     bx,offset strb_hisco    ; (2913:2F5D=25h)
2913:1D1D  B9 0006                              mov     cx,6

2913:1D20                       locloop_200:                                    ;  xref 2913:1D39
2913:1D20  8A 04                                mov     al,[si]
2913:1D22  3C 25                                cmp     al,25h                  ; '%'
2913:1D24  75 02                                jne     loc_201
2913:1D26  32 C0                                xor     al,al
2913:1D28                       loc_201:                                        ;  xref 2913:1D24
2913:1D28  8A 27                                mov     ah,[bx]
2913:1D2A  80 FC 25                             cmp     ah,25h                  ; '%'
2913:1D2D  75 02                                jne     loc_202
2913:1D2F  32 E4                                xor     ah,ah
2913:1D31                       loc_202:                                        ;  xref 2913:1D2D
2913:1D31  3A C4                                cmp     al,ah
2913:1D33  77 07                                ja      loc_203
2913:1D35  72 22                                jc      loc_ret_205
2913:1D37  46                                   inc     si
2913:1D38  43                                   inc     bx
2913:1D39  E2 E5                                loop    locloop_200

2913:1D3B  C3                                   retn
2913:1D3C                       loc_203:                                        ;  xref 2913:1D33
2913:1D3C  A0 2F54                              mov     al,level                ; (2913:2F54=0)
2913:1D3F  A2 2F64                              mov     high_level,al           ; (2913:2F64=0)
2913:1D42  A0 2F55                              mov     al,density              ; (2913:2F55=0)
2913:1D45  A2 2F65                              mov     high_dens,al            ; (2913:2F65=0)
2913:1D48 .BE 2F56                              mov     si,offset strb_score    ; (2913:2F56=25h)
2913:1D4B .BB 2F5D                              mov     bx,offset strb_hisco    ; (2913:2F5D=25h)
2913:1D4E  B9 0006                              mov     cx,6

2913:1D51                       locloop_204:                                    ;  xref 2913:1D57
2913:1D51  8A 04                                mov     al,[si]
2913:1D53  88 07                                mov     [bx],al
2913:1D55  43                                   inc     bx
2913:1D56  46                                   inc     si
2913:1D57  E2 F8                                loop    locloop_204


2913:1D59                       loc_ret_205:                                    ;  xref 2913:1D35
2913:1D59  C3                                   retn
                                update_hisco    endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:019E
                                ;==========================================================================

2913:1D5A                       sub_32          proc    near
2913:1D5A  BD 0005                              mov     bp,5
2913:1D5D                       loc_206:                                        ;  xref 2913:1D81, 1D85, 1D91, 1D95
                                                                                ;            1DA0, 1DA4, 1DB0, 1DB4
                                                                                ;            1DD9
2913:1D5D  E8 11B8                              call    maze_rnd_xy             ; (2F18)
2913:1D60  98                                   cbw
2913:1D61  8B D8                                mov     bx,ax
2913:1D63  80 BF 1DE5 03                        cmp     byte ptr data_153[bx],3 ; (2913:1DE5=0)
2913:1D68  74 4C                                je      loc_210
2913:1D6A  8A 87 1DF4                           mov     al,data_154[bx]         ; (2913:1DF4=7)
2913:1D6E  88 04                                mov     [si],al
2913:1D70  E8 0538                              call    sub_42                  ; (22AB)
2913:1D73  B4 08                                mov     ah,8
2913:1D75  88 1C                                mov     [si],bl
2913:1D77  F6 C3 02                             test    bl,2
2913:1D7A  75 0B                                jnz     loc_207
2913:1D7C  A0 5455                              mov     al,ds:data_218e         ; (2913:5455=0)
2913:1D7F  84 C0                                test    al,al
2913:1D81  78 DA                                js      loc_206
2913:1D83  3A C4                                cmp     al,ah
2913:1D85  74 D6                                je      loc_206
2913:1D87                       loc_207:                                        ;  xref 2913:1D7A
2913:1D87  F6 C3 04                             test    bl,4
2913:1D8A  75 0B                                jnz     loc_208
2913:1D8C  A0 545F                              mov     al,ds:data_221e         ; (2913:545F=0)
2913:1D8F  84 C0                                test    al,al
2913:1D91  78 CA                                js      loc_206
2913:1D93  3A C4                                cmp     al,ah
2913:1D95  74 C6                                je      loc_206
2913:1D97                       loc_208:                                        ;  xref 2913:1D8A
2913:1D97  84 DC                                test    bl,ah
2913:1D99  75 0B                                jnz     loc_209
2913:1D9B  A0 5467                              mov     al,ds:data_222e         ; (2913:5467=0)
2913:1D9E  84 C0                                test    al,al
2913:1DA0  78 BB                                js      loc_206
2913:1DA2  3A C4                                cmp     al,ah
2913:1DA4  74 B7                                je      loc_206
2913:1DA6                       loc_209:                                        ;  xref 2913:1D99
2913:1DA6  F6 C3 01                             test    bl,1
2913:1DA9  75 0B                                jnz     loc_210
2913:1DAB  A0 545D                              mov     al,ds:data_219e         ; (2913:545D=0)
2913:1DAE  84 C0                                test    al,al
2913:1DB0  78 AB                                js      loc_206
2913:1DB2  3A C4                                cmp     al,ah
2913:1DB4  74 A7                                je      loc_206
2913:1DB6                       loc_210:                                        ;  xref 2913:1D68, 1DA9
2913:1DB6  8A 04                                mov     al,[si]
2913:1DB8  88 86 522C                           mov     ss:data_207e[bp],al     ; (2913:522C=0)
2913:1DBC  0C 80                                or      al,80h
2913:1DBE  88 04                                mov     [si],al
2913:1DC0  88 96 5220                           mov     ss:data_205e[bp],dl     ; (2913:5220=0)
2913:1DC4  88 B6 5226                           mov     ss:data_206e[bp],dh     ; (2913:5226=0)
2913:1DC8  32 C0                                xor     al,al
2913:1DCA  88 86 521A                           mov     ss:data_204e[bp],al     ; (2913:521A=0)
2913:1DCE  88 86 5238                           mov     [bp+5238h],al
2913:1DD2  C6 86 5232 1C                        mov     byte ptr [bp+5232h],1Ch
2913:1DD7  90                                   nop
2913:1DD8  4D                                   dec     bp
2913:1DD9  79 82                                jns     loc_206
2913:1DDB .BF 523E                              mov     di,data_208e            ; (2913:523E=0)
2913:1DDE  B9 01F8                              mov     cx,1F8h
2913:1DE1  48                                   dec     ax
2913:1DE2  F3/ AA                               rep     stosb
2913:1DE4  C3                                   retn
                                sub_32          endp

2913:1DE5  00                   data_153        db      0                       ; Data table (indexed access)
                                                                                ;  xref 2913:1D63
2913:1DE6  01 01 02 01 02 02                    db      1, 1, 2, 1, 2, 2
2913:1DEC  03 01 02 02 03 02                    db      3, 1, 2, 2, 3, 2
2913:1DF2  03 03                                db      3, 3
2913:1DF4  07                   data_154        db      7                       ; Data table (indexed access)
                                                                                ;  xref 2913:1D6A
2913:1DF5  0007[07]                             db      7 dup (7)
2913:1DFC  0D 0D 0B 0B 0D 0D                    db       0Dh, 0Dh, 0Bh, 0Bh, 0Dh, 0Dh
2913:1E02  0E                                   db       0Eh

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2011, 2037
                                ;==========================================================================

2913:1E03                       sub_33          proc    near
2913:1E03  B4 0B                                mov     ah,0Bh
2913:1E05  E8 E4B9                              call    ega_map_mask            ; (02C1)
2913:1E08  8A 9E 5220                           mov     bl,ss:data_205e[bp]     ; (2913:5220=0)
2913:1E0C  8A BE 5226                           mov     bh,ss:data_206e[bp]     ; (2913:5226=0)
2913:1E10  BA 1414                              mov     dx,1414h
2913:1E13  E8 F95A                              call    sub_24                  ; (1770)
2913:1E16  72 35                                jc      loc_213
2913:1E18  8A 86 521A                           mov     al,ss:data_204e[bp]     ; (2913:521A=0)
2913:1E1C  A8 81                                test    al,81h
2913:1E1E  75 6C                                jnz     loc_217
2913:1E20  B9 0004                              mov     cx,4
2913:1E23  02 D9                                add     bl,cl
2913:1E25  80 FB D4                             cmp     bl,0D4h
2913:1E28  73 62                                jae     loc_217
2913:1E2A  8A C7                                mov     al,bh
2913:1E2C  02 C1                                add     al,cl
2913:1E2E  3C D4                                cmp     al,0D4h
2913:1E30  73 5A                                jae     loc_217
2913:1E32 .BE 1FBB                              mov     si,offset data_156      ; (2913:1FBB=6)
2913:1E35  32 F6                                xor     dh,dh

2913:1E37                       locloop_211:                                    ;  xref 2913:1E73
2913:1E37  AC                                   lodsb
2913:1E38  86 D0                                xchg    dl,al
2913:1E3A  80 FF C0                             cmp     bh,0C0h
2913:1E3D  73 32                                jae     loc_216
2913:1E3F  F8                                   clc
2913:1E40  E8 E6E2                              call    vid_offset              ; (0525)
2913:1E43  86 D0                                xchg    dl,al
2913:1E45                       loc_212:                                        ;  xref 2913:1E4B
2913:1E45 ,D0 EA                                shr     dl,1
2913:1E47  74 07                                jz      loc_214
2913:1E49  D1 E0                                shl     ax,1
2913:1E4B  EB F8                                jmp     short loc_212           ; (1E45)
2913:1E4D                       loc_213:                                        ;  xref 2913:1E16
2913:1E4D  32 E4                                xor     ah,ah
2913:1E4F  C3                                   retn
2913:1E50                       loc_214:                                        ;  xref 2913:1E47
2913:1E50  80 FB D0                             cmp     bl,0D0h
2913:1E53  73 09                                jae     loc_215
2913:1E55  26: 8A 15                            mov     dl,es:[di]
2913:1E58  22 D0                                and     dl,al
2913:1E5A  0A F2                                or      dh,dl
2913:1E5C  AA                                   stosb
2913:1E5D  4F                                   dec     di
2913:1E5E                       loc_215:                                        ;  xref 2913:1E53
2913:1E5E  4F                                   dec     di
2913:1E5F  8A C3                                mov     al,bl
2913:1E61  2C 08                                sub     al,8
2913:1E63  3C D0                                cmp     al,0D0h
2913:1E65  73 0A                                jae     loc_216
2913:1E67  26: 8A 15                            mov     dl,es:[di]
2913:1E6A  22 D4                                and     dl,ah
2913:1E6C  0A F2                                or      dh,dl
2913:1E6E  86 C4                                xchg    al,ah
2913:1E70  AA                                   stosb
2913:1E71                       loc_216:                                        ;  xref 2913:1E3D, 1E65
2913:1E71  FE C7                                inc     bh
2913:1E73  E2 C2                                loop    locloop_211

2913:1E75  84 F6                                test    dh,dh
2913:1E77  74 13                                jz      loc_217
2913:1E79  C6 86 521A E6                        mov     byte ptr ss:data_204e[bp],0E6h ; (2913:521A=0)
2913:1E7E  90                                   nop
2913:1E7F  B2 04                                mov     dl,4
2913:1E81  E8 FE43                              call    inc_fuel                ; (1CC7)
2913:1E84  E8 ED00                              call    sub_15                  ; (0B87)
2913:1E87  8B D3                                mov     dx,bx
2913:1E89  E8 041F                              call    sub_42                  ; (22AB)
2913:1E8C                       loc_217:                                        ;  xref 2913:1E1E, 1E28, 1E30, 1E77
2913:1E8C  B4 0B                                mov     ah,0Bh
2913:1E8E  E8 E430                              call    ega_map_mask            ; (02C1)
2913:1E91  8B F5                                mov     si,bp
2913:1E93  D1 E6                                shl     si,1
2913:1E95  8B C6                                mov     ax,si
2913:1E97  D1 E6                                shl     si,1
2913:1E99  D1 E6                                shl     si,1
2913:1E9B  D1 E6                                shl     si,1
2913:1E9D  2B F0                                sub     si,ax
2913:1E9F  8A 9E 5220                           mov     bl,ss:data_205e[bp]     ; (2913:5220=0)
2913:1EA3  8A BE 5226                           mov     bh,ss:data_206e[bp]     ; (2913:5226=0)
2913:1EA7  BA 0808                              mov     dx,808h
2913:1EAA  55                                   push    bp
2913:1EAB  33 ED                                xor     bp,bp
2913:1EAD  E8 F8C0                              call    sub_24                  ; (1770)
2913:1EB0  72 39                                jc      loc_218
2913:1EB2  80 C3 15                             add     bl,15h
2913:1EB5  53                                   push    bx
2913:1EB6  56                                   push    si
2913:1EB7  81 C6 523E                           add     si,523Eh
2913:1EBB  E8 0031                              call    sub_34                  ; (1EEF)
2913:1EBE  5E                                   pop     si
2913:1EBF  5B                                   pop     bx
2913:1EC0  80 C7 15                             add     bh,15h
2913:1EC3  53                                   push    bx
2913:1EC4  56                                   push    si
2913:1EC5  81 C6 5292                           add     si,5292h
2913:1EC9  E8 0023                              call    sub_34                  ; (1EEF)
2913:1ECC  5E                                   pop     si
2913:1ECD  5B                                   pop     bx
2913:1ECE  80 EF 15                             sub     bh,15h
2913:1ED1  D1 E6                                shl     si,1
2913:1ED3  56                                   push    si
2913:1ED4  80 C3 07                             add     bl,7
2913:1ED7  53                                   push    bx
2913:1ED8  81 C6 52E6                           add     si,52E6h
2913:1EDC  E8 0084                              call    sub_35                  ; (1F63)
2913:1EDF  5B                                   pop     bx
2913:1EE0  5E                                   pop     si
2913:1EE1  80 EB 15                             sub     bl,15h
2913:1EE4  81 C6 538E                           add     si,538Eh
2913:1EE8  E8 0078                              call    sub_35                  ; (1F63)
2913:1EEB                       loc_218:                                        ;  xref 2913:1EB0
2913:1EEB  8B C5                                mov     ax,bp
2913:1EED  5D                                   pop     bp
2913:1EEE  C3                                   retn
                                sub_33          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1EBB, 1EC9
                                ;==========================================================================

2913:1EEF                       sub_34          proc    near
2913:1EEF  B9 0007                              mov     cx,7

2913:1EF2                       locloop_219:                                    ;  xref 2913:1F60
2913:1EF2  80 FF C0                             cmp     bh,0C0h
2913:1EF5  73 65                                jae     loc_227
2913:1EF7  F8                                   clc
2913:1EF8  E8 E62A                              call    vid_offset              ; (0525)
2913:1EFB  8A F0                                mov     dh,al
2913:1EFD  8A E8                                mov     ch,al
2913:1EFF  8B 04                                mov     ax,[si]
2913:1F01  80 E4 3F                             and     ah,3Fh                  ; '?'
2913:1F04  32 D2                                xor     dl,dl
2913:1F06                       loc_220:                                        ;  xref 2913:1F0E
2913:1F06 ,D0 ED                                shr     ch,1
2913:1F08  74 06                                jz      loc_221
2913:1F0A  D1 E0                                shl     ax,1
2913:1F0C  D0 D2                                rcl     dl,1
2913:1F0E  EB F6                                jmp     short loc_220           ; (1F06)
2913:1F10                       loc_221:                                        ;  xref 2913:1F08
2913:1F10  80 FB D0                             cmp     bl,0D0h
2913:1F13  73 0B                                jae     loc_222
2913:1F15  26: 8A 2D                            mov     ch,es:[di]
2913:1F18  AA                                   stosb
2913:1F19  4F                                   dec     di
2913:1F1A  22 E8                                and     ch,al
2913:1F1C  0B E9                                or      bp,cx
2913:1F1E  32 C5                                xor     al,ch
2913:1F20                       loc_222:                                        ;  xref 2913:1F13
2913:1F20  4F                                   dec     di
2913:1F21  8A EB                                mov     ch,bl
2913:1F23  80 ED 08                             sub     ch,8
2913:1F26  80 FD D0                             cmp     ch,0D0h
2913:1F29  73 0C                                jae     loc_223
2913:1F2B  26: 8A 2D                            mov     ch,es:[di]
2913:1F2E  26: 08 25                            or      es:[di],ah
2913:1F31  22 EC                                and     ch,ah
2913:1F33  0B E9                                or      bp,cx
2913:1F35  32 E5                                xor     ah,ch
2913:1F37                       loc_223:                                        ;  xref 2913:1F29
2913:1F37  4F                                   dec     di
2913:1F38  8A EB                                mov     ch,bl
2913:1F3A  80 ED 10                             sub     ch,10h
2913:1F3D  80 FD D0                             cmp     ch,0D0h
2913:1F40  73 0C                                jae     loc_224
2913:1F42  26: 8A 2D                            mov     ch,es:[di]
2913:1F45  26: 08 15                            or      es:[di],dl
2913:1F48  22 EA                                and     ch,dl
2913:1F4A  0B E9                                or      bp,cx
2913:1F4C  32 D5                                xor     dl,ch
2913:1F4E                       loc_224:                                        ;  xref 2913:1F40
2913:1F4E  8A EE                                mov     ch,dh
2913:1F50                       loc_225:                                        ;  xref 2913:1F58
2913:1F50 ,D0 ED                                shr     ch,1
2913:1F52  74 06                                jz      loc_226
2913:1F54  D0 EA                                shr     dl,1
2913:1F56  D1 D8                                rcr     ax,1
2913:1F58  EB F6                                jmp     short loc_225           ; (1F50)
2913:1F5A                       loc_226:                                        ;  xref 2913:1F52
2913:1F5A  89 04                                mov     [si],ax
2913:1F5C                       loc_227:                                        ;  xref 2913:1EF5
2913:1F5C  46                                   inc     si
2913:1F5D  46                                   inc     si
2913:1F5E  FE C7                                inc     bh
2913:1F60  E2 90                                loop    locloop_219

2913:1F62  C3                                   retn
                                sub_34          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1EDC, 1EE8
                                ;==========================================================================

2913:1F63                       sub_35          proc    near
2913:1F63  B9 001C                              mov     cx,1Ch

2913:1F66                       locloop_228:                                    ;  xref 2913:1FB8
2913:1F66  80 FF C0                             cmp     bh,0C0h
2913:1F69  73 47                                jae     loc_235
2913:1F6B  F8                                   clc
2913:1F6C  E8 E5B6                              call    vid_offset              ; (0525)
2913:1F6F  8A F0                                mov     dh,al
2913:1F71  8A EE                                mov     ch,dh
2913:1F73  8A 04                                mov     al,[si]
2913:1F75  24 7F                                and     al,7Fh
2913:1F77                       loc_229:                                        ;  xref 2913:1F7D
2913:1F77 ,D0 ED                                shr     ch,1
2913:1F79  74 04                                jz      loc_230
2913:1F7B  D1 E0                                shl     ax,1
2913:1F7D  EB F8                                jmp     short loc_229           ; (1F77)
2913:1F7F                       loc_230:                                        ;  xref 2913:1F79
2913:1F7F  80 FB D0                             cmp     bl,0D0h
2913:1F82  73 0B                                jae     loc_231
2913:1F84  26: 8A 2D                            mov     ch,es:[di]
2913:1F87  AA                                   stosb
2913:1F88  4F                                   dec     di
2913:1F89  22 E8                                and     ch,al
2913:1F8B  0B E9                                or      bp,cx
2913:1F8D  32 C5                                xor     al,ch
2913:1F8F                       loc_231:                                        ;  xref 2913:1F82
2913:1F8F  4F                                   dec     di
2913:1F90  8A EB                                mov     ch,bl
2913:1F92  80 ED 08                             sub     ch,8
2913:1F95  80 FD D0                             cmp     ch,0D0h
2913:1F98  73 0C                                jae     loc_232
2913:1F9A  26: 8A 2D                            mov     ch,es:[di]
2913:1F9D  26: 08 25                            or      es:[di],ah
2913:1FA0  22 EC                                and     ch,ah
2913:1FA2  0B E9                                or      bp,cx
2913:1FA4  32 E5                                xor     ah,ch
2913:1FA6                       loc_232:                                        ;  xref 2913:1F98
2913:1FA6  8A EE                                mov     ch,dh
2913:1FA8                       loc_233:                                        ;  xref 2913:1FAE
2913:1FA8 ,D0 ED                                shr     ch,1
2913:1FAA  74 04                                jz      loc_234
2913:1FAC  D1 E8                                shr     ax,1
2913:1FAE  EB F8                                jmp     short loc_233           ; (1FA8)
2913:1FB0                       loc_234:                                        ;  xref 2913:1FAA
2913:1FB0  88 04                                mov     [si],al
2913:1FB2                       loc_235:                                        ;  xref 2913:1F69
2913:1FB2  46                                   inc     si
2913:1FB3  FE C7                                inc     bh
2913:1FB5  83 C7 29                             add     di,29h
2913:1FB8  E2 AC                                loop    locloop_228

2913:1FBA  C3                                   retn
                                sub_35          endp

2913:1FBB  06                   data_156        db      6                       ;  xref 2913:1E32
2913:1FBC  0F 0F 06                             db       0Fh, 0Fh, 06h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0242
                                ;==========================================================================

2913:1FBF                       sub_36          proc    near
2913:1FBF  FE 0E 4F9A                           dec     byte ptr ds:data_187e   ; (2913:4F9A=0)
2913:1FC3  75 06                                jnz     loc_236
2913:1FC5  C6 06 4F9A 28                        mov     byte ptr ds:data_187e,28h ; (2913:4F9A=0) '('
2913:1FCA  90                                   nop
2913:1FCB                       loc_236:                                        ;  xref 2913:1FC3
2913:1FCB .BD 0005                              mov     bp,data_4e              ; (2913:0005=0)
2913:1FCE                       loc_237:                                        ;  xref 2913:203E
2913:1FCE  32 C0                                xor     al,al
2913:1FD0  38 86 521A                           cmp     ss:data_204e[bp],al     ; (2913:521A=0)
2913:1FD4  74 04                                je      loc_238
2913:1FD6  78 54                                js      loc_243
2913:1FD8  EB 10                                jmp     short loc_239           ; (1FEA)
2913:1FDA                       loc_238:                                        ;  xref 2913:1FD4
2913:1FDA  8A 86 5232                           mov     al,[bp+5232h]
2913:1FDE  E8 0EF0                              call    rnd_update              ; (2ED1)
2913:1FE1  75 07                                jnz     loc_239
2913:1FE3  FE 86 521A                           inc     byte ptr ss:data_204e[bp] ; (2913:521A=0)
2913:1FE7  E8 038F                              call    sub_46                  ; (2379)
2913:1FEA                       loc_239:                                        ;  xref 2913:1FD8, 1FE1
2913:1FEA  E8 009C                              call    sub_38                  ; (2089)
2913:1FED  FE 86 5238                           inc     byte ptr [bp+5238h]
2913:1FF1  8A 86 5238                           mov     al,[bp+5238h]
2913:1FF5  3C 40                                cmp     al,40h                  ; '@'
2913:1FF7  75 18                                jne     loc_241
2913:1FF9  FE 8E 5238                           dec     byte ptr [bp+5238h]
2913:1FFD  B4 1C                                mov     ah,1Ch
2913:1FFF  8A 86 5232                           mov     al,[bp+5232h]
2913:2003  D0 E0                                shl     al,1
2913:2005  72 06                                jc      loc_240
2913:2007  3A E0                                cmp     ah,al
2913:2009  72 02                                jb      loc_240
2913:200B  8A E0                                mov     ah,al
2913:200D                       loc_240:                                        ;  xref 2913:2005, 2009
2913:200D  88 A6 5232                           mov     [bp+5232h],ah
2913:2011                       loc_241:                                        ;  xref 2913:1FF7
2913:2011  E8 FDEF                              call    sub_33                  ; (1E03)
2913:2014  84 E4                                test    ah,ah
2913:2016  74 25                                jz      loc_244
2913:2018  B4 01                                mov     ah,1
2913:201A  8A 86 5232                           mov     al,[bp+5232h]
2913:201E  D0 E8                                shr     al,1
2913:2020  3A E0                                cmp     ah,al
2913:2022  73 02                                jae     loc_242
2913:2024  8A E0                                mov     ah,al
2913:2026                       loc_242:                                        ;  xref 2913:2022
2913:2026  88 A6 5232                           mov     [bp+5232h],ah
2913:202A  EB 11                                jmp     short loc_244           ; (203D)
2913:202C                       loc_243:                                        ;  xref 2913:1FD6
2913:202C  80 BE 521A FF                        cmp     byte ptr ss:data_204e[bp],0FFh ; (2913:521A=0)
2913:2031  74 0A                                je      loc_244
2913:2033  FE 86 521A                           inc     byte ptr ss:data_204e[bp] ; (2913:521A=0)
2913:2037  E8 FDC9                              call    sub_33                  ; (1E03)
2913:203A  E8 0004                              call    sub_37                  ; (2041)
2913:203D                       loc_244:                                        ;  xref 2913:2016, 202A, 2031
2913:203D  4D                                   dec     bp
2913:203E  79 8E                                jns     loc_237
2913:2040  C3                                   retn
                                sub_36          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:203A
                                ;==========================================================================

2913:2041                       sub_37          proc    near
2913:2041  B0 02                                mov     al,2
2913:2043  E8 0E8B                              call    rnd_update              ; (2ED1)
2913:2046  75 40                                jnz     loc_ret_246
2913:2048 .BF 000A                              mov     di,data_5e              ; (2913:000A=0)
2913:204B                       loc_245:                                        ;  xref 2913:2052
2913:204B  4F                                   dec     di
2913:204C  78 3A                                js      loc_ret_246
2913:204E  38 85 5063                           cmp     ds:data_192e[di],al     ; (2913:5063=0)
2913:2052  79 F7                                jns     loc_245
2913:2054  83 C7 20                             add     di,20h
2913:2057  40                                   inc     ax
2913:2058  88 85 5043                           mov     ds:coll_flags1_e[di],al ; (2913:5043=0)
2913:205C  8A 86 5220                           mov     al,ss:data_205e[bp]     ; (2913:5220=0)
2913:2060  88 85 4F9B                           mov     ds:data_188e[di],al     ; (2913:4F9B=0)
2913:2064  8A 86 5226                           mov     al,ss:data_206e[bp]     ; (2913:5226=0)
2913:2068  88 85 4FC5                           mov     ds:data_189e[di],al     ; (2913:4FC5=0)
2913:206C  C6 85 506D 0A                        mov     byte ptr ds:data_193e[di],0Ah ; (2913:506D=0)
2913:2071  90                                   nop
2913:2072  B0 20                                mov     al,20h                  ; ' '
2913:2074  E8 0E5A                              call    rnd_update              ; (2ED1)
2913:2077  04 03                                add     al,3
2913:2079  88 85 4FEF                           mov     ds:data_190e[di],al     ; (2913:4FEF=0)
2913:207D  B0 20                                mov     al,20h                  ; ' '
2913:207F  E8 0E4F                              call    rnd_update              ; (2ED1)
2913:2082  04 03                                add     al,3
2913:2084  88 85 5019                           mov     ds:data_191e[di],al     ; (2913:5019=0)

2913:2088                       loc_ret_246:                                    ;  xref 2913:2046, 204C
2913:2088  C3                                   retn
                                sub_37          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1FEA
                                ;==========================================================================

2913:2089                       sub_38          proc    near
2913:2089  80 3E 4F9A 28                        cmp     byte ptr ds:data_187e,28h ; (2913:4F9A=0) '('
2913:208E  74 03                                je      loc_247
2913:2090  E9 00C4                              jmp     loc_ret_254             ; (2157)
2913:2093                       loc_247:                                        ;  xref 2913:208E
2913:2093  57                                   push    di
2913:2094  8B DD                                mov     bx,bp
2913:2096  D1 E3                                shl     bx,1
2913:2098  8B C3                                mov     ax,bx
2913:209A  D1 E3                                shl     bx,1
2913:209C  D1 E3                                shl     bx,1
2913:209E  D1 E3                                shl     bx,1
2913:20A0  2B D8                                sub     bx,ax
2913:20A2  B2 FF                                mov     dl,0FFh
2913:20A4  B9 000C                              mov     cx,0Ch
2913:20A7 .8D B7 5240                           lea     si,ds:data_209e[bx]     ; (2913:5240=0)

2913:20AB                       locloop_248:                                    ;  xref 2913:20AF
2913:20AB  AC                                   lodsb
2913:20AC  88 44 FD                             mov     [si-3],al
2913:20AF  E2 FA                                loop    locloop_248

2913:20B1  88 54 FF                             mov     [si-1],dl
2913:20B4  88 54 FE                             mov     [si-2],dl
2913:20B7  B9 000C                              mov     cx,0Ch
2913:20BA .8D B7 529D                           lea     si,ds:data_210e[bx]     ; (2913:529D=0)
2913:20BE  FD                                   std

2913:20BF                       locloop_249:                                    ;  xref 2913:20C3
2913:20BF  AC                                   lodsb
2913:20C0  88 44 03                             mov     [si+3],al
2913:20C3  E2 FA                                loop    locloop_249

2913:20C5  88 54 01                             mov     [si+1],dl
2913:20C8  88 54 02                             mov     [si+2],dl
2913:20CB  FC                                   cld
2913:20CC .BE 5394                              mov     si,data_215e            ; (2913:5394=0)
2913:20CF .BF 52EC                              mov     di,data_212e            ; (2913:52EC=0)
2913:20D2  D1 E3                                shl     bx,1
2913:20D4  03 F3                                add     si,bx
2913:20D6  03 FB                                add     di,bx
2913:20D8  8A 24                                mov     ah,[si]
2913:20DA  80 0C 01                             or      byte ptr [si],1
2913:20DD  80 4C 0F 01                          or      byte ptr [si+0Fh],1
2913:20E1  8A 35                                mov     dh,[di]
2913:20E3  80 0D 40                             or      byte ptr [di],40h       ; '@'
2913:20E6  80 4D 0F 40                          or      byte ptr [di+0Fh],40h   ; '@'
2913:20EA  B9 000E                              mov     cx,0Eh
2913:20ED  46                                   inc     si
2913:20EE  47                                   inc     di

2913:20EF                       locloop_250:                                    ;  xref 2913:2107
2913:20EF  8A C4                                mov     al,ah
2913:20F1  8A 24                                mov     ah,[si]
2913:20F3  0A 44 01                             or      al,[si+1]
2913:20F6  24 01                                and     al,1
2913:20F8  08 04                                or      [si],al
2913:20FA  8A C6                                mov     al,dh
2913:20FC  8A 35                                mov     dh,[di]
2913:20FE  0A 45 01                             or      al,[di+1]
2913:2101  24 40                                and     al,40h                  ; '@'
2913:2103  08 05                                or      [di],al
2913:2105  46                                   inc     si
2913:2106  47                                   inc     di
2913:2107  E2 E6                                loop    locloop_250

2913:2109  B9 0006                              mov     cx,6
2913:210C .BE 538E                              mov     si,data_214e            ; (2913:538E=0)
2913:210F  03 F3                                add     si,bx
2913:2111 .BF 52E6                              mov     di,data_211e            ; (2913:52E6=0)
2913:2114  03 FB                                add     di,bx
2913:2116  56                                   push    si
2913:2117  57                                   push    di

2913:2118                       locloop_251:                                    ;  xref 2913:2124
2913:2118  8A 44 01                             mov     al,[si+1]
2913:211B  88 04                                mov     [si],al
2913:211D  8A 45 01                             mov     al,[di+1]
2913:2120  88 05                                mov     [di],al
2913:2122  46                                   inc     si
2913:2123  47                                   inc     di
2913:2124  E2 F2                                loop    locloop_251

2913:2126  B9 0006                              mov     cx,6
2913:2129 .BE 53A8                              mov     si,data_216e            ; (2913:53A8=0)
2913:212C  03 F3                                add     si,bx
2913:212E .BF 5300                              mov     di,data_213e            ; (2913:5300=0)
2913:2131  03 FB                                add     di,bx

2913:2133                       locloop_252:                                    ;  xref 2913:213F
2913:2133  8A 04                                mov     al,[si]
2913:2135  88 44 01                             mov     [si+1],al
2913:2138  8A 05                                mov     al,[di]
2913:213A  88 45 01                             mov     [di+1],al
2913:213D  4E                                   dec     si
2913:213E  4F                                   dec     di
2913:213F  E2 F2                                loop    locloop_252

2913:2141  5F                                   pop     di
2913:2142  5E                                   pop     si
2913:2143  B9 001C                              mov     cx,1Ch

2913:2146                       locloop_253:                                    ;  xref 2913:2154
2913:2146  8A 04                                mov     al,[si]
2913:2148  D0 E0                                shl     al,1
2913:214A  08 04                                or      [si],al
2913:214C  8A 05                                mov     al,[di]
2913:214E  D0 E8                                shr     al,1
2913:2150  08 05                                or      [di],al
2913:2152  46                                   inc     si
2913:2153  47                                   inc     di
2913:2154  E2 F0                                loop    locloop_253

2913:2156  5F                                   pop     di

2913:2157                       loc_ret_254:                                    ;  xref 2913:2090
2913:2157  C3                                   retn
                                sub_38          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2250
                                ;==========================================================================

2913:2158                       sub_39          proc    near
2913:2158  80 EA 04                             sub     dl,4
2913:215B  80 EE 04                             sub     dh,4
2913:215E  BF 54B8                              mov     di,54B8h
2913:2161  BB 2185                              mov     bx,2185h
2913:2164  BD 5436                              mov     bp,5436h
2913:2167  E8 0DD2                              call    maze_readxy             ; (2F3C)
2913:216A  B1 09                                mov     cl,9

2913:216C                       locloop_255:                                    ;  xref 2913:2182
2913:216C  B5 09                                mov     ch,9
2913:216E  B2 08                                mov     dl,8
2913:2170                       loc_256:                                        ;  xref 2913:217D
2913:2170  AC                                   lodsb
2913:2171  0A 07                                or      al,[bx]
2913:2173  79 03                                jns     loc_257
2913:2175  88 56 00                             mov     [bp],dl
2913:2178                       loc_257:                                        ;  xref 2913:2173
2913:2178  AA                                   stosb
2913:2179  43                                   inc     bx
2913:217A  45                                   inc     bp
2913:217B  FE CD                                dec     ch
2913:217D  75 F1                                jnz     loc_256
2913:217F  83 C6 37                             add     si,37h
2913:2182  E2 E8                                loop    locloop_255

2913:2184  C3                                   retn
                                sub_39          endp

2913:2185  03 02 02 02 02 02                    db      3, 2, 2, 2, 2, 2
2913:218B  02 02 06 01 00 00                    db      2, 2, 6, 1, 0, 0
2913:2191  00 00 00 00 00 04                    db      0, 0, 0, 0, 0, 4
2913:2197  01 00 00 00 00 00                    db      1, 0, 0, 0, 0, 0
2913:219D  00 00 04 01 00 00                    db      0, 0, 4, 1, 0, 0
2913:21A3  00 00 00 00 00 04                    db      0, 0, 0, 0, 0, 4
2913:21A9  01 00 00 00 00 00                    db      1, 0, 0, 0, 0, 0
2913:21AF  00 00 04 01 00 00                    db      0, 0, 4, 1, 0, 0
2913:21B5  00 00 00 00 00 04                    db      0, 0, 0, 0, 0, 4
2913:21BB  01 00 00 00 00 00                    db      1, 0, 0, 0, 0, 0
2913:21C1  00 00 04 01 00 00                    db      0, 0, 4, 1, 0, 0
2913:21C7  00 00 00 00 00 04                    db      0, 0, 0, 0, 0, 4
2913:21CD  09 08 08 08 08 08                    db      9, 8, 8, 8, 8, 8, 8, 8, 0Ch
2913:21D3  08 08 0C

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2253
                                ;==========================================================================

2913:21D6                       sub_40          proc    near
2913:21D6  32 FF                                xor     bh,bh
2913:21D8  B9 0204                              mov     cx,204h
2913:21DB  BA 0608                              mov     dx,608h
2913:21DE .BE 5509                              mov     si,data_226e            ; (2913:5509=0)
2913:21E1  88 16 545E                           mov     ds:data_220e,dl         ; (2913:545E=0)
2913:21E5  C6 04 28                             mov     byte ptr [si],28h       ; '('
2913:21E8  8B FE                                mov     di,si
2913:21EA  47                                   inc     di
2913:21EB                       loc_258:                                        ;  xref 2913:2241
2913:21EB  AC                                   lodsb
2913:21EC  8A D8                                mov     bl,al
2913:21EE  8A A7 54B8                           mov     ah,ds:data_224e[bx]     ; (2913:54B8=0)
2913:21F2  FE CB                                dec     bl
2913:21F4  D0 EC                                shr     ah,1
2913:21F6  72 0D                                jc      loc_259
2913:21F8  38 BF 5436                           cmp     ds:data_217e[bx],bh     ; (2913:5436=0)
2913:21FC  79 07                                jns     loc_259
2913:21FE  88 AF 5436                           mov     ds:data_217e[bx],ch     ; (2913:5436=0)
2913:2202  8A C3                                mov     al,bl
2913:2204  AA                                   stosb
2913:2205                       loc_259:                                        ;  xref 2913:21F6, 21FC
2913:2205  2A DA                                sub     bl,dl
2913:2207  D0 EC                                shr     ah,1
2913:2209  72 0D                                jc      loc_260
2913:220B  38 BF 5436                           cmp     ds:data_217e[bx],bh     ; (2913:5436=0)
2913:220F  79 07                                jns     loc_260
2913:2211  88 8F 5436                           mov     ds:data_217e[bx],cl     ; (2913:5436=0)
2913:2215  8A C3                                mov     al,bl
2913:2217  AA                                   stosb
2913:2218                       loc_260:                                        ;  xref 2913:2209, 220F
2913:2218  80 C3 0A                             add     bl,0Ah
2913:221B  D0 EC                                shr     ah,1
2913:221D  72 0D                                jc      loc_261
2913:221F  38 BF 5436                           cmp     ds:data_217e[bx],bh     ; (2913:5436=0)
2913:2223  79 07                                jns     loc_261
2913:2225  88 B7 5436                           mov     ds:data_217e[bx],dh     ; (2913:5436=0)
2913:2229  8A C3                                mov     al,bl
2913:222B  AA                                   stosb
2913:222C                       loc_261:                                        ;  xref 2913:221D, 2223
2913:222C  02 DA                                add     bl,dl
2913:222E  D0 EC                                shr     ah,1
2913:2230  72 0D                                jc      loc_262
2913:2232  38 BF 5436                           cmp     ds:data_217e[bx],bh     ; (2913:5436=0)
2913:2236  79 07                                jns     loc_262
2913:2238  88 BF 5436                           mov     ds:data_217e[bx],bh     ; (2913:5436=0)
2913:223C  8A C3                                mov     al,bl
2913:223E  AA                                   stosb
2913:223F                       loc_262:                                        ;  xref 2913:2230, 2236
2913:223F  3B F7                                cmp     si,di
2913:2241  75 A8                                jne     loc_258
2913:2243  C3                                   retn
                                sub_40          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:22B2
                                ;==========================================================================

2913:2244                       sub_41          proc    near
2913:2244  0E                                   push    cs
2913:2245  07                                   pop     es
2913:2246 .BF 5436                              mov     di,data_217e            ; (2913:5436=0)
2913:2249  B0 80                                mov     al,80h
2913:224B  B9 0051                              mov     cx,51h
2913:224E  F3/ AA                               rep     stosb
2913:2250  E8 FF05                              call    sub_39                  ; (2158)
2913:2253  E8 FF80                              call    sub_40                  ; (21D6)
2913:2256  C3                                   retn
                                sub_41          endp

2913:2257  FF                   data_159        db      0FFh                    ;  xref 2913:22C1
2913:2258  00 FF 00 81 0F 81                    db       00h,0FFh, 00h, 81h, 0Fh, 81h
2913:225E  01 00 01 00 84 0F                    db       01h, 00h, 01h, 00h, 84h, 0Fh
2913:2264  84 F7 00 F9 00 82                    db       84h,0F7h, 00h,0F9h, 00h, 82h
2913:226A  0F 82 09 00 07 00                    db       0Fh, 82h, 09h, 00h, 07h, 00h
2913:2270  88 0F 88 FF F7 FF                    db       88h, 0Fh, 88h,0FFh,0F7h,0FFh
2913:2276  F9 81 03 82 01 09                    db      0F9h, 81h, 03h, 82h, 01h, 09h
2913:227C  01 07 81 09 88 F7                    db       01h, 07h, 81h, 09h, 88h,0F7h
2913:2282  FF F9 FF 82 0C 81                    db      0FFh,0F9h,0FFh, 82h, 0Ch, 81h
2913:2288  F7 01 F9 01 82 09                    db      0F7h, 01h,0F9h, 01h, 82h, 09h
2913:228E  84 01 F7 01 F9 84                    db       84h, 01h,0F7h, 01h,0F9h, 84h
2913:2294  06 82 01 09 01 07                    db       06h, 82h, 01h, 09h, 01h, 07h
2913:229A  84 0C 88 09 FF 07                    db       84h, 0Ch, 88h, 09h,0FFh, 07h
2913:22A0  FF 88 06 81 09 01                    db      0FFh, 88h, 06h, 81h, 09h, 01h
2913:22A6  07 01 88 03 84                       db       07h, 01h, 88h, 03h, 84h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0A65, 0CDF, 1D70, 1E89
                                ;==========================================================================

2913:22AB                       sub_42          proc    near
2913:22AB  55                                   push    bp
2913:22AC  56                                   push    si
2913:22AD  57                                   push    di
2913:22AE  51                                   push    cx
2913:22AF  52                                   push    dx
2913:22B0  53                                   push    bx
2913:22B1  06                                   push    es
2913:22B2  E8 FF8F                              call    sub_41                  ; (2244)
2913:22B5 .BF 5487                              mov     di,data_3e              ; (0200:5487=74h)
2913:22B8  B9 0031                              mov     cx,31h
2913:22BB  32 C0                                xor     al,al
2913:22BD  F3/ AA                               rep     stosb
2913:22BF  B1 0C                                mov     cl,0Ch
2913:22C1 .BE 2257                              mov     si,offset data_159      ; (2913:2257=0FFh)

2913:22C4                       locloop_263:                                    ;  xref 2913:22E2
2913:22C4  51                                   push    cx
2913:22C5  56                                   push    si
2913:22C6  AC                                   lodsb
2913:22C7  98                                   cbw
2913:22C8  95                                   xchg    bp,ax
2913:22C9  AC                                   lodsb
2913:22CA  98                                   cbw
2913:22CB  97                                   xchg    di,ax
2913:22CC  AD                                   lodsw
2913:22CD  92                                   xchg    dx,ax
2913:22CE  AC                                   lodsb
2913:22CF  86 E8                                xchg    ch,al
2913:22D1  AD                                   lodsw
2913:22D2 .BE 54E0                              mov     si,data_225e            ; (2913:54E0=0)
2913:22D5 .BB 0018                              mov     bx,data_6e              ; (2913:0018=0)
2913:22D8  B1 06                                mov     cl,6
2913:22DA  E8 000F                              call    sub_43                  ; (22EC)
2913:22DD  5E                                   pop     si
2913:22DE  83 C6 07                             add     si,7
2913:22E1  59                                   pop     cx
2913:22E2  E2 E0                                loop    locloop_263

2913:22E4  07                                   pop     es
2913:22E5  5B                                   pop     bx
2913:22E6  5A                                   pop     dx
2913:22E7  59                                   pop     cx
2913:22E8  5F                                   pop     di
2913:22E9  5E                                   pop     si
2913:22EA  5D                                   pop     bp
2913:22EB  C3                                   retn
                                sub_42          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:22DA
                                ;==========================================================================

2913:22EC                       sub_43          proc    near
2913:22EC                       loc_264:                                        ;  xref 2913:2302
2913:22EC  84 2C                                test    ch,[si]
2913:22EE  75 14                                jnz     loc_ret_265
2913:22F0  02 DA                                add     bl,dl
2913:22F2  08 87 5487                           or      ds:data_223e[bx],al     ; (2913:5487=0)
2913:22F6  03 F5                                add     si,bp
2913:22F8  34 0F                                xor     al,0Fh
2913:22FA  86 D6                                xchg    dl,dh
2913:22FC  86 E5                                xchg    ah,ch
2913:22FE  87 FD                                xchg    di,bp
2913:2300  FE C9                                dec     cl
2913:2302  75 E8                                jnz     loc_264

2913:2304                       loc_ret_265:                                    ;  xref 2913:22EE
2913:2304  C3                                   retn
                                sub_43          endp


                                ;==========================================================================
                                ;                                tmp1_readxy
                                ;
                                ;     input: bl:x, bh:y
                                ;     output: ax, di, zf
                                ;     Read from the byte array tmp1_buf_e[64][64]
                                ;     di = tmp1_buf_e + x + y*64
                                ;     ax = sext(*di)
                                ;     zf = test(ax)
                                ;
                                ;         Called from:   2913:1893, 231F, 28B9
                                ;==========================================================================

2913:2305                       tmp1_readxy     proc    near
2913:2305  8A C3                                mov     al,bl
2913:2307  98                                   cbw
2913:2308  8B F8                                mov     di,ax
2913:230A  8A E7                                mov     ah,bh
2913:230C  32 C0                                xor     al,al
2913:230E  D1 F8                                sar     ax,1
2913:2310  D1 F8                                sar     ax,1
2913:2312  03 F8                                add     di,ax
2913:2314 .81 C7 2F89                           add     di,tmp1_buf_e           ; (2913:2F89=0)
2913:2318  8A 05                                mov     al,[di]
2913:231A  98                                   cbw
2913:231B  84 C0                                test    al,al
2913:231D  C3                                   retn
                                tmp1_readxy     endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:23FF, 27E0, 287C
                                ;==========================================================================

2913:231E                       sub_44          proc    near
2913:231E  57                                   push    di
2913:231F  E8 FFE3                              call    tmp1_readxy             ; (2305)
2913:2322  88 84 50F7                           mov     ds:data_195e[si],al     ; (2913:50F7=0)
2913:2326  74 0A                                jz      loc_266
2913:2328  57                                   push    di
2913:2329  8B F8                                mov     di,ax
2913:232B  8B C6                                mov     ax,si
2913:232D  88 85 5117                           mov     ds:data_196e[di],al     ; (2913:5117=0)
2913:2331  5F                                   pop     di
2913:2332                       loc_266:                                        ;  xref 2913:2326
2913:2332  8B C6                                mov     ax,si
2913:2334  88 05                                mov     [di],al
2913:2336  88 A4 5117                           mov     ds:data_196e[si],ah     ; (2913:5117=0)
2913:233A  D1 E6                                shl     si,1
2913:233C  89 BC 5137                           mov     ds:data_197e[si],di     ; (2913:5137=0)
2913:2340  D1 EE                                shr     si,1
2913:2342  5F                                   pop     di
2913:2343  C3                                   retn
                                sub_44          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1CA9, 23A8, 27DD, 2879
                                ;==========================================================================

2913:2344                       sub_45          proc    near
2913:2344  57                                   push    di
2913:2345  8A 84 5117                           mov     al,ds:data_196e[si]     ; (2913:5117=0)
2913:2349  98                                   cbw
2913:234A  84 C0                                test    al,al
2913:234C  74 0C                                jz      loc_267
2913:234E  8B F8                                mov     di,ax
2913:2350  8A 84 50F7                           mov     al,ds:data_195e[si]     ; (2913:50F7=0)
2913:2354  88 85 50F7                           mov     ds:data_195e[di],al     ; (2913:50F7=0)
2913:2358  EB 0E                                jmp     short loc_268           ; (2368)
2913:235A                       loc_267:                                        ;  xref 2913:234C
2913:235A  D1 E6                                shl     si,1
2913:235C  8B BC 5137                           mov     di,ds:data_197e[si]     ; (2913:5137=0)
2913:2360  D1 EE                                shr     si,1
2913:2362  8A 84 50F7                           mov     al,ds:data_195e[si]     ; (2913:50F7=0)
2913:2366  88 05                                mov     [di],al
2913:2368                       loc_268:                                        ;  xref 2913:2358
2913:2368  84 C0                                test    al,al
2913:236A  74 0B                                jz      loc_269
2913:236C  98                                   cbw
2913:236D  8B F8                                mov     di,ax
2913:236F  8A 84 5117                           mov     al,ds:data_196e[si]     ; (2913:5117=0)
2913:2373  88 85 5117                           mov     ds:data_196e[di],al     ; (2913:5117=0)
2913:2377                       loc_269:                                        ;  xref 2913:236A
2913:2377  5F                                   pop     di
2913:2378  C3                                   retn
                                sub_45          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:1FE7
                                ;==========================================================================

2913:2379                       sub_46          proc    near
2913:2379  8B FD                                mov     di,bp
2913:237B .BE 0020                              mov     si,data_9e              ; (2913:0020=0)
2913:237E  33 DB                                xor     bx,bx
2913:2380  32 D2                                xor     dl,dl
2913:2382                       loc_270:                                        ;  xref 2913:23BC, 23DD, 23E3
2913:2382 ,4E                                   dec     si
2913:2383  75 2F                                jnz     loc_273
2913:2385  8A 85 5220                           mov     al,ds:data_205e[di]     ; (2913:5220=0)
2913:2389  2A 06 4F9B                           sub     al,ds:data_188e         ; (2913:4F9B=0)
2913:238D  04 0A                                add     al,0Ah
2913:238F  3C 15                                cmp     al,15h
2913:2391  73 1A                                jae     loc_271
2913:2393  8A 85 5226                           mov     al,ds:data_206e[di]     ; (2913:5226=0)
2913:2397  2A 06 4FC5                           sub     al,ds:data_189e         ; (2913:4FC5=0)
2913:239B  04 0A                                add     al,0Ah
2913:239D  3C 15                                cmp     al,15h
2913:239F  73 0C                                jae     loc_271
2913:23A1  80 FA 08                             cmp     dl,8
2913:23A4  72 07                                jb      loc_271
2913:23A6  8B F3                                mov     si,bx
2913:23A8  E8 FF99                              call    sub_45                  ; (2344)
2913:23AB  EB 38                                jmp     short loc_277           ; (23E5)
2913:23AD                       loc_271:                                        ;  xref 2913:2391, 239F, 23A4
2913:23AD  88 BD 521A                           mov     ds:data_204e[di],bh     ; (2913:521A=0)
2913:23B1                       loc_272:                                        ;  xref 2913:2455
2913:23B1 ,8B EF                                mov     bp,di
2913:23B3  C3                                   retn
2913:23B4                       loc_273:                                        ;  xref 2913:2383
2913:23B4  32 C0                                xor     al,al
2913:23B6  38 84 5043                           cmp     ds:coll_flags1_e[si],al ; (2913:5043=0)
2913:23BA  78 29                                js      loc_277
2913:23BC  75 C4                                jnz     loc_270
2913:23BE  A0 4F9B                              mov     al,ds:data_188e         ; (2913:4F9B=0)
2913:23C1  2A 84 4F9B                           sub     al,ds:data_188e[si]     ; (2913:4F9B=0)
2913:23C5  79 02                                jns     loc_274
2913:23C7  F6 D8                                neg     al
2913:23C9                       loc_274:                                        ;  xref 2913:23C5
2913:23C9  8A 26 4FC5                           mov     ah,ds:data_189e         ; (2913:4FC5=0)
2913:23CD  2A A4 4FC5                           sub     ah,ds:data_189e[si]     ; (2913:4FC5=0)
2913:23D1  79 02                                jns     loc_275
2913:23D3  F6 DC                                neg     ah
2913:23D5                       loc_275:                                        ;  xref 2913:23D1
2913:23D5  3A E0                                cmp     ah,al
2913:23D7  72 02                                jb      loc_276
2913:23D9  8A C4                                mov     al,ah
2913:23DB                       loc_276:                                        ;  xref 2913:23D7
2913:23DB  3A C2                                cmp     al,dl
2913:23DD  72 A3                                jb      loc_270
2913:23DF  8A D0                                mov     dl,al
2913:23E1  8B DE                                mov     bx,si
2913:23E3  EB 9D                                jmp     short loc_270           ; (2382)
2913:23E5                       loc_277:                                        ;  xref 2913:23AB, 23BA
2913:23E5  8A 9D 5220                           mov     bl,ds:data_205e[di]     ; (2913:5220=0)
2913:23E9  88 9C 4F9B                           mov     ds:data_188e[si],bl     ; (2913:4F9B=0)
2913:23ED  8A BD 5226                           mov     bh,ds:data_206e[di]     ; (2913:5226=0)
2913:23F1  88 BC 4FC5                           mov     ds:data_189e[si],bh     ; (2913:4FC5=0)
2913:23F5  B0 13                                mov     al,13h
2913:23F7  88 84 4FEF                           mov     ds:data_190e[si],al     ; (2913:4FEF=0)
2913:23FB  88 84 5019                           mov     ds:data_191e[si],al     ; (2913:5019=0)
2913:23FF  E8 FF1C                              call    sub_44                  ; (231E)
2913:2402  8A 1E 2F54                           mov     bl,level                ; (2913:2F54=0)
2913:2406  32 FF                                xor     bh,bh
2913:2408  53                                   push    bx
2913:2409  D1 E3                                shl     bx,1
2913:240B  8B 9F 245C                           mov     bx,data_161[bx]         ; (2913:245C=246Eh)
2913:240F  B0 40                                mov     al,40h                  ; '@'
2913:2411  E8 0ABD                              call    rnd_update              ; (2ED1)
2913:2414                       loc_278:                                        ;  xref 2913:241B
2913:2414 ,3A 07                                cmp     al,[bx]
2913:2416  76 05                                jbe     loc_279
2913:2418  43                                   inc     bx
2913:2419  FE C4                                inc     ah
2913:241B  EB F7                                jmp     short loc_278           ; (2414)
2913:241D                       loc_279:                                        ;  xref 2913:2416
2913:241D  5B                                   pop     bx
2913:241E  02 A7 247A                           add     ah,data_162[bx]         ; (2913:247A=0)
2913:2422  88 A4 5097                           mov     ds:data_194e[si],ah     ; (2913:5097=0)
2913:2426  8A DC                                mov     bl,ah
2913:2428  8A 87 2483                           mov     al,data_163[bx]         ; (2913:2483=1)
2913:242C  88 84 50B7                           mov     ds:vel_magn_e[si],al    ; (2913:50B7=0)
2913:2430                       loc_280:                                        ;  xref 2913:243F
2913:2430  B0 04                                mov     al,4
2913:2432  E8 0A9C                              call    rnd_update              ; (2ED1)
2913:2435  8B D8                                mov     bx,ax
2913:2437  8A 95 522C                           mov     dl,ds:data_207e[di]     ; (2913:522C=0)
2913:243B  84 97 2458                           test    dl,data_160[bx]         ; (2913:2458=2)
2913:243F  75 EF                                jnz     loc_280
2913:2441  D0 E0                                shl     al,1
2913:2443  88 84 50D7                           mov     ds:ship_angle_e[si],al  ; (2913:50D7=0)
2913:2447  8B C7                                mov     ax,di
2913:2449  0C 50                                or      al,50h                  ; 'P'
2913:244B  88 84 5043                           mov     ds:coll_flags1_e[si],al ; (2913:5043=0)
2913:244F  C6 84 506D 03                        mov     byte ptr ds:data_193e[si],3 ; (2913:506D=0)
2913:2454  90                                   nop
2913:2455  E9 FF59                              jmp     loc_272                 ; (23B1)
                                sub_46          endp

2913:2458  02                   data_160        db      2                       ; Data table (indexed access)
                                                                                ;  xref 2913:243B
2913:2459  04 08 01                             db      4, 8, 1
2913:245C  246E                 data_161        dw      246Eh                   ; Data table (indexed access)
                                                                                ;  xref 2913:240B
2913:245E  6F 24                                db      'o$'
2913:2460  72 24                                db      'r$'
2913:2462  72 24                                db      'r$'
2913:2464  72 24                                db      'r$'
2913:2466  72 24                                db      'r$'
2913:2468  72 24                                db      'r$'
2913:246A  72 24                                db      'r$'
2913:246C  77 24                                db      'w$'
2913:246E  40                                   db      '@'
2913:246F  16 2B 40 08 18 28                    db       16h, 2Bh, 40h, 08h, 18h, 28h
2913:2475  38 40 18                             db       38h, 40h, 18h
2913:2478  30 40                                db       30h, 40h
2913:247A  00                   data_162        db      0                       ; Data table (indexed access)
                                                                                ;  xref 2913:241E
2913:247B  01 04 09 0E 13 18                    db       01h, 04h, 09h, 0Eh, 13h, 18h
2913:2481  1D                                   db       1Dh
2913:2482  22                                   db      22h
2913:2483  01                   data_163        db      1                       ; Data table (indexed access)
                                                                                ;  xref 2913:2428
2913:2484  01 02 01 01 02 01                    db      1, 2, 1, 1, 2, 1
2913:248A  03 02 02 01 03 02                    db      3, 2, 2, 1, 3, 2
2913:2490  04 01 03 02 04 03                    db      4, 1, 3, 2, 4, 3
2913:2496  03 02 04 03 05 02                    db      3, 2, 4, 3, 5, 2
2913:249C  04 03 05 04 04 03                    db      4, 3, 5, 4, 4, 3
2913:24A2  05 04 05 05 04 05                    db      5, 4, 5, 5, 4, 5
2913:24A8  00                   data_164        db      0                       ; Data table (indexed access)
                                                                                ;  xref 2913:2515
2913:24A9  00 00 18 00 00 18                    db       00h, 00h, 18h, 00h, 00h, 18h
2913:24AF  08 18 00 18 08 18                    db       08h, 18h, 00h, 18h, 08h, 18h
2913:24B5  08 18 08 18 08 20                    db       08h, 18h, 08h, 18h, 08h, 20h
2913:24BB  08 18 08 20 10 18                    db       08h, 18h, 08h, 20h, 10h, 18h
2913:24C1  08 20 10 20 08 20                    db       08h, 20h, 10h, 20h, 08h, 20h
2913:24C7  10 20 28 10                          db       10h, 20h, 28h, 10h
2913:24CB  20 28                                db       20h, 28h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:0245
                                ;==========================================================================

2913:24CD                       sub_47          proc    near
2913:24CD  BD 0020                              mov     bp,20h
2913:24D0                       loc_281:                                        ;  xref 2913:2599
2913:24D0 ,B4 0A                                mov     ah,0Ah
2913:24D2  E8 DDEC                              call    ega_map_mask            ; (02C1)
2913:24D5                       loc_282:                                        ;  xref 2913:24DF, 24E5, 24FA, 2504
                                                                                ;            250C
2913:24D5  4D                                   dec     bp
2913:24D6  75 01                                jnz     loc_283
2913:24D8  C3                                   retn
2913:24D9                       loc_283:                                        ;  xref 2913:24D6
2913:24D9  8A 86 5043                           mov     al,ss:coll_flags1_e[bp] ; (2913:5043=0)
2913:24DD  84 C0                                test    al,al
2913:24DF  78 F4                                js      loc_282
2913:24E1  74 04                                jz      loc_284
2913:24E3  A8 60                                test    al,60h                  ; '`'
2913:24E5  74 EE                                jz      loc_282
2913:24E7                       loc_284:                                        ;  xref 2913:24E1
2913:24E7  8A 9E 4F9B                           mov     bl,ss:data_188e[bp]     ; (2913:4F9B=0)
2913:24EB  8A BE 4FC5                           mov     bh,ss:data_189e[bp]     ; (2913:4FC5=0)
2913:24EF  8A 96 4FEF                           mov     dl,ss:data_190e[bp]     ; (2913:4FEF=0)
2913:24F3  8A B6 5019                           mov     dh,ss:data_191e[bp]     ; (2913:5019=0)
2913:24F7  E8 F276                              call    sub_24                  ; (1770)
2913:24FA  72 D9                                jc      loc_282
2913:24FC  B9 0007                              mov     cx,7
2913:24FF  02 D9                                add     bl,cl
2913:2501  80 FB D7                             cmp     bl,0D7h
2913:2504  73 CF                                jae     loc_282
2913:2506  8A C7                                mov     al,bh
2913:2508  02 C1                                add     al,cl
2913:250A  3C C7                                cmp     al,0C7h
2913:250C  73 C7                                jae     loc_282
2913:250E  8A 86 5097                           mov     al,ss:data_194e[bp]     ; (2913:5097=0)
2913:2512  98                                   cbw
2913:2513  8B F0                                mov     si,ax
2913:2515  8A 84 24A8                           mov     al,data_164[si]         ; (2913:24A8=0)
2913:2519  02 86 50D7                           add     al,ss:ship_angle_e[bp]  ; (2913:50D7=0)
2913:251D  8B F0                                mov     si,ax
2913:251F  D1 E6                                shl     si,1
2913:2521  D1 E6                                shl     si,1
2913:2523  D1 E6                                shl     si,1
2913:2525  2B F0                                sub     si,ax
2913:2527 .81 C6 259D                           add     si,offset sprites_1x7   ; (2913:259D=10h)
2913:252B  32 F6                                xor     dh,dh

2913:252D                       locloop_285:                                    ;  xref 2913:2568
2913:252D  AC                                   lodsb
2913:252E  86 D0                                xchg    dl,al
2913:2530  80 FF C0                             cmp     bh,0C0h
2913:2533  73 31                                jae     loc_289
2913:2535  F8                                   clc
2913:2536  E8 DFEC                              call    vid_offset              ; (0525)
2913:2539  86 D0                                xchg    dl,al
2913:253B                       loc_286:                                        ;  xref 2913:2541
2913:253B ,D0 EA                                shr     dl,1
2913:253D  74 04                                jz      loc_287
2913:253F  D1 E0                                shl     ax,1
2913:2541  EB F8                                jmp     short loc_286           ; (253B)
2913:2543                       loc_287:                                        ;  xref 2913:253D
2913:2543  80 FB D0                             cmp     bl,0D0h
2913:2546  73 09                                jae     loc_288
2913:2548  26: 8A 15                            mov     dl,es:[di]
2913:254B  22 D0                                and     dl,al
2913:254D  0A F2                                or      dh,dl
2913:254F  AA                                   stosb
2913:2550  4F                                   dec     di
2913:2551                       loc_288:                                        ;  xref 2913:2546
2913:2551  4F                                   dec     di
2913:2552  8A D3                                mov     dl,bl
2913:2554  80 EA 08                             sub     dl,8
2913:2557  80 FA D0                             cmp     dl,0D0h
2913:255A  73 0A                                jae     loc_289
2913:255C  26: 8A 15                            mov     dl,es:[di]
2913:255F  22 D4                                and     dl,ah
2913:2561  0A F2                                or      dh,dl
2913:2563  86 C4                                xchg    al,ah
2913:2565  AA                                   stosb
2913:2566                       loc_289:                                        ;  xref 2913:2533, 255A
2913:2566  FE C7                                inc     bh
2913:2568  E2 C3                                loop    locloop_285

2913:256A  84 F6                                test    dh,dh
2913:256C  74 2B                                jz      loc_291
2913:256E  8A 86 5043                           mov     al,ss:coll_flags1_e[bp] ; (2913:5043=0)
2913:2572  8A E0                                mov     ah,al
2913:2574  80 E4 F0                             and     ah,0F0h
2913:2577  80 FC 60                             cmp     ah,60h                  ; '`'
2913:257A  74 1D                                je      loc_291
2913:257C  C6 86 506D 0A                        mov     byte ptr ss:data_193e[bp],0Ah ; (2913:506D=0)
2913:2581  90                                   nop
2913:2582  F6 C4 70                             test    ah,70h                  ; 'p'
2913:2585  74 09                                jz      loc_290
2913:2587  24 0F                                and     al,0Fh
2913:2589  98                                   cbw
2913:258A  8B F8                                mov     di,ax
2913:258C  88 A5 521A                           mov     ds:data_204e[di],ah     ; (2913:521A=0)
2913:2590                       loc_290:                                        ;  xref 2913:2585
2913:2590  B2 01                                mov     dl,1
2913:2592  88 96 5043                           mov     ss:coll_flags1_e[bp],dl ; (2913:5043=0)
2913:2596  E8 F72E                              call    inc_fuel                ; (1CC7)
2913:2599                       loc_291:                                        ;  xref 2913:256C, 257A
2913:2599  E9 FF34                              jmp     loc_281                 ; (24D0)
                                sub_47          endp

2913:259C  C3                                   db      0C3h
2913:259D  10 10 38 6C C6 82    sprites_1x7     db       10h, 10h, 38h, 6Ch,0C6h, 82h ;  xref 2913:11AC, 2527
2913:25A3  00 02 FC 8C 04 04                    db       00h, 02h,0FCh, 8Ch, 04h, 04h
2913:25A9  04 0C 60 30 18 0E                    db       04h, 0Ch, 60h, 30h, 18h, 0Eh
2913:25AF  18 30 60 0C 04 04                    db       18h, 30h, 60h, 0Ch, 04h, 04h
2913:25B5  04 8C FC 02 00 82                    db       04h, 8Ch,0FCh, 02h, 00h, 82h
2913:25BB  C6 6C 38 10 10 60                    db      0C6h, 6Ch, 38h, 10h, 10h, 60h
2913:25C1  40 40 40 62 7E 80                    db       40h, 40h, 40h, 62h, 7Eh, 80h
2913:25C7  0C 18 30 E0 30 18                    db       0Ch, 18h, 30h,0E0h, 30h, 18h
2913:25CD  0C 80 7E 62 40 40                    db       0Ch, 80h, 7Eh, 62h, 40h, 40h
2913:25D3  40 60 10 92 92 FE                    db       40h, 60h, 10h, 92h, 92h,0FEh
2913:25D9  82 82 00 20 44 E8                    db       82h, 82h, 00h, 20h, 44h,0E8h
2913:25DF  30 1A 0C 08 7C 10                    db       30h, 1Ah, 0Ch, 08h, 7Ch, 10h
2913:25E5  10 1E 10 10 7C 08                    db       10h, 1Eh, 10h, 10h, 7Ch, 08h
2913:25EB  0C 1A 30 E8 44 20                    db       0Ch, 1Ah, 30h,0E8h, 44h, 20h
2913:25F1  00 82 82 FE 92 92                    db       00h, 82h, 82h,0FEh, 92h, 92h
2913:25F7  10 20 60 B0 18 2E                    db       10h, 20h, 60h,0B0h, 18h, 2Eh
2913:25FD  44 08 7C 10 10 F0                    db       44h, 08h, 7Ch, 10h, 10h,0F0h
2913:2603  10 10 7C 08 44 2E                    db       10h, 10h, 7Ch, 08h, 44h, 2Eh
2913:2609  18 B0 60 20 10 10                    db       18h,0B0h, 60h, 20h, 10h, 10h
2913:260F  38 38 7C 6C 44 02                    db       38h, 38h, 7Ch, 6Ch, 44h, 02h
2913:2615  1C 7C FC 18 18 10                    db       1Ch, 7Ch,0FCh, 18h, 18h, 10h
2913:261B  00 E0 78 3E 78 E0                    db       00h,0E0h, 78h, 3Eh, 78h,0E0h
2913:2621  00 10 18 18 FC 7C                    db       00h, 10h, 18h, 18h,0FCh, 7Ch
2913:2627  1C 02 44 6C 7C 38                    db       1Ch, 02h, 44h, 6Ch, 7Ch, 38h
2913:262D  38 10 10 10 30 30                    db       38h, 10h, 10h, 10h, 30h, 30h
2913:2633  7E 7C 70 80 00 0E                    db       7Eh, 7Ch, 70h, 80h, 00h, 0Eh
2913:2639  3C F8 3C 0E 00 80                    db       3Ch,0F8h, 3Ch, 0Eh, 00h, 80h
2913:263F  70 7C 7E 30 30 10                    db       70h, 7Ch, 7Eh, 30h, 30h, 10h
2913:2645  10 38 6C 44 44 44                    db       10h, 38h, 6Ch, 44h, 44h, 44h
2913:264B  44 1E 32 62 C6 0C                    db       44h, 1Eh, 32h, 62h,0C6h, 0Ch
2913:2651  18 10 00 F8 0C 06                    db       18h, 10h, 00h,0F8h, 0Ch, 06h
2913:2657  0C F8 00 10 18 0C                    db       0Ch,0F8h, 00h, 10h, 18h, 0Ch
2913:265D  C6 62 32 1E 44 44                    db      0C6h, 62h, 32h, 1Eh, 44h, 44h
2913:2663  44 44 6C 38 10 10                    db       44h, 44h, 6Ch, 38h, 10h, 10h
2913:2669  30 60 C6 8C 98 F0                    db       30h, 60h,0C6h, 8Ch, 98h,0F0h
2913:266F  00 3E 60 C0 60 3E                    db       00h, 3Eh, 60h,0C0h, 60h, 3Eh
2913:2675  00 F0 98 8C C6 60                    db       00h,0F0h, 98h, 8Ch,0C6h, 60h
2913:267B  30 10 10 10 38 7C                    db       30h, 10h, 10h, 10h, 38h, 7Ch
2913:2681  7C 7C 7C 06 3E 7C                    db       7Ch, 7Ch, 7Ch, 06h, 3Eh, 7Ch
2913:2687  FC 7C 38 10 00 F0                    db      0FCh, 7Ch, 38h, 10h, 00h,0F0h
2913:268D  F8 FE F8 F0 00 10                    db      0F8h,0FEh,0F8h,0F0h, 00h, 10h
2913:2693  38 7C FC 7C 3E 06                    db       38h, 7Ch,0FCh, 7Ch, 3Eh, 06h
2913:2699  7C 7C 7C 7C 38 10                    db       7Ch, 7Ch, 7Ch, 7Ch, 38h, 10h
2913:269F  10 10 38 7C 7E 7C                    db       10h, 10h, 38h, 7Ch, 7Eh, 7Ch
2913:26A5  F8 C0 00 1E 3E FE                    db      0F8h,0C0h, 00h, 1Eh, 3Eh,0FEh
2913:26AB  3E 1E 00 C0 F8 7C                    db       3Eh, 1Eh, 00h,0C0h,0F8h, 7Ch
2913:26B1  7E 7C 38 10 10 38                    db       7Eh, 7Ch, 38h, 10h, 10h, 38h
2913:26B7  7C 7C 7C 7C 38 1E                    db       7Ch, 7Ch, 7Ch, 7Ch, 38h, 1Eh
2913:26BD  3E 7E FE FC 78 30                    db       3Eh, 7Eh,0FEh,0FCh, 78h, 30h
2913:26C3  00 78 FC FE FC 78                    db       00h, 78h,0FCh,0FEh,0FCh, 78h
2913:26C9  00 30 78 FC FE 7E                    db       00h, 30h, 78h,0FCh,0FEh, 7Eh
2913:26CF  3E 1E 38 7C 7C 7C                    db       3Eh, 1Eh, 38h, 7Ch, 7Ch, 7Ch
2913:26D5  7C 38 10 18 3C 7E                    db       7Ch, 38h, 10h, 18h, 3Ch, 7Eh
2913:26DB  FE FC F8 F0 00 3C                    db      0FEh,0FCh,0F8h,0F0h, 00h, 3Ch
2913:26E1  7E FE 7E 3C 00 F0                    db       7Eh,0FEh, 7Eh, 3Ch, 00h,0F0h
2913:26E7  F8 FC FE 7E 3C 18                    db      0F8h,0FCh,0FEh, 7Eh, 3Ch, 18h

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:022C
                                ;==========================================================================

2913:26ED                       sub_48          proc    near
2913:26ED .BE 0020                              mov     si,data_9e              ; (2913:0020=0)
2913:26F0                       loc_292:                                        ;  xref 2913:26FC, 2702, 275C, 2781
                                                                                ;            2868
2913:26F0 ,4E                                   dec     si
2913:26F1  75 01                                jnz     loc_293
2913:26F3  C3                                   retn
2913:26F4                       loc_293:                                        ;  xref 2913:26F1
2913:26F4  8A 84 5043                           mov     al,ds:coll_flags1_e[si] ; (2913:5043=0)
2913:26F8  8A D8                                mov     bl,al
2913:26FA  84 C0                                test    al,al
2913:26FC  78 F2                                js      loc_292
2913:26FE  74 04                                jz      loc_295
2913:2700                       loc_294:
2913:2700  A8 60                                test    al,60h                  ; '`'
2913:2702  74 EC                                jz      loc_292
2913:2704                       loc_295:                                        ;  xref 2913:26FE
2913:2704  B6 FF                                mov     dh,0FFh
2913:2706  8A CE                                mov     cl,dh
2913:2708  8A EE                                mov     ch,dh
2913:270A                       loc_296:                                        ;  xref 2913:2895
2913:270A ,8A 94 506D                           mov     dl,ds:data_193e[si]     ; (2913:506D=0)
2913:270E  2A 94 50B7                           sub     dl,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:2712  79 70                                jns     loc_302
2913:2714  A8 70                                test    al,70h                  ; 'p'
2913:2716  74 42                                jz      loc_299
2913:2718  24 0F                                and     al,0Fh
2913:271A  A2 4F89                              mov     ds:data_183e,al         ; (2913:4F89=0)
2913:271D  98                                   cbw
2913:271E  8B F8                                mov     di,ax
2913:2720  38 A5 521A                           cmp     ds:data_204e[di],ah     ; (2913:521A=0)
2913:2724  78 30                                js      loc_298
2913:2726  8A C3                                mov     al,bl
2913:2728  24 70                                and     al,70h                  ; 'p'
2913:272A  8A E8                                mov     ch,al
2913:272C  3C 50                                cmp     al,50h                  ; 'P'
2913:272E  75 12                                jne     loc_297
2913:2730  B2 0E                                mov     dl,0Eh
2913:2732  C6 85 521A 02                        mov     byte ptr ds:data_204e[di],2 ; (2913:521A=0)
2913:2737  90                                   nop
2913:2738  8B C7                                mov     ax,di
2913:273A  0C 60                                or      al,60h                  ; '`'
2913:273C  88 84 5043                           mov     ds:coll_flags1_e[si],al ; (2913:5043=0)
2913:2740  EB 42                                jmp     short loc_302           ; (2784)
2913:2742                       loc_297:                                        ;  xref 2913:272E
2913:2742  3C 60                                cmp     al,60h                  ; '`'
2913:2744  75 10                                jne     loc_298
2913:2746  B2 05                                mov     dl,5
2913:2748  88 A5 521A                           mov     ds:data_204e[di],ah     ; (2913:521A=0)
2913:274C  8B C7                                mov     ax,di
2913:274E  0C 70                                or      al,70h                  ; 'p'
2913:2750  88 84 5043                           mov     ds:coll_flags1_e[si],al ; (2913:5043=0)
2913:2754  EB 2E                                jmp     short loc_302           ; (2784)
2913:2756                       loc_298:                                        ;  xref 2913:2724, 2744
2913:2756  88 A4 5043                           mov     ds:coll_flags1_e[si],ah ; (2913:5043=0)
2913:275A                       loc_299:                                        ;  xref 2913:2716
2913:275A  84 F6                                test    dh,dh
2913:275C  79 92                                jns     loc_292
2913:275E  51                                   push    cx
2913:275F  8A 84 5097                           mov     al,ds:data_194e[si]     ; (2913:5097=0)
2913:2763  98                                   cbw
2913:2764  8B D8                                mov     bx,ax
2913:2766  38 A7 2927                           cmp     data_165[bx],ah         ; (2913:2927=0)
2913:276A  75 05                                jne     loc_300
2913:276C  E8 0485                              call    sub_63                  ; (2BF4)
2913:276F  EB 03                                jmp     short loc_301           ; (2774)
2913:2771                       loc_300:                                        ;  xref 2913:276A
2913:2771  E8 0546                              call    sub_65                  ; (2CBA)
2913:2774                       loc_301:                                        ;  xref 2913:276F
2913:2774  59                                   pop     cx
2913:2775  8A C2                                mov     al,dl
2913:2777  2A 94 50B7                           sub     dl,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:277B  79 07                                jns     loc_302
2913:277D  88 84 506D                           mov     ds:data_193e[si],al     ; (2913:506D=0)
2913:2781  E9 FF6C                              jmp     loc_292                 ; (26F0)
2913:2784                       loc_302:                                        ;  xref 2913:2712, 2740, 2754, 277B
2913:2784  52                                   push    dx
2913:2785  8A 9C 4F9B                           mov     bl,ds:data_188e[si]     ; (2913:4F9B=0)
2913:2789  8A BC 4FC5                           mov     bh,ds:data_189e[si]     ; (2913:4FC5=0)
2913:278D  8A 94 4FEF                           mov     dl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2791  8A B4 5019                           mov     dh,ds:data_191e[si]     ; (2913:5019=0)
2913:2795  8A A4 50D7                           mov     ah,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2799  8A 84 50B7                           mov     al,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:279D  D0 E0                                shl     al,1
2913:279F  D0 E0                                shl     al,1
2913:27A1  D0 E0                                shl     al,1
2913:27A3  02 C4                                add     al,ah
2913:27A5  98                                   cbw
2913:27A6  D1 E0                                shl     ax,1
2913:27A8  8B F8                                mov     di,ax
2913:27AA  8B 85 0A6C                           mov     ax,data_91[di]          ; (2913:0A6C=0)
2913:27AE  02 D0                                add     dl,al
2913:27B0  B0 26                                mov     al,26h                  ; '&'
2913:27B2  78 0A                                js      loc_303
2913:27B4  3A D0                                cmp     dl,al
2913:27B6  72 0C                                jb      loc_305
2913:27B8  FE C3                                inc     bl
2913:27BA  2A D0                                sub     dl,al
2913:27BC  EB 04                                jmp     short loc_304           ; (27C2)
2913:27BE                       loc_303:                                        ;  xref 2913:27B2
2913:27BE  02 D0                                add     dl,al
2913:27C0  FE CB                                dec     bl
2913:27C2                       loc_304:                                        ;  xref 2913:27BC
2913:27C2  FE C1                                inc     cl
2913:27C4                       loc_305:                                        ;  xref 2913:27B6
2913:27C4  02 F4                                add     dh,ah
2913:27C6  78 0A                                js      loc_306
2913:27C8  3A F0                                cmp     dh,al
2913:27CA  72 0C                                jb      loc_308
2913:27CC  FE C7                                inc     bh
2913:27CE  2A F0                                sub     dh,al
2913:27D0  EB 04                                jmp     short loc_307           ; (27D6)
2913:27D2                       loc_306:                                        ;  xref 2913:27C6
2913:27D2  02 F0                                add     dh,al
2913:27D4  FE CF                                dec     bh
2913:27D6                       loc_307:                                        ;  xref 2913:27D0
2913:27D6  FE C1                                inc     cl
2913:27D8                       loc_308:                                        ;  xref 2913:27CA
2913:27D8  51                                   push    cx
2913:27D9  84 C9                                test    cl,cl
2913:27DB  78 06                                js      loc_309
2913:27DD  E8 FB64                              call    sub_45                  ; (2344)
2913:27E0  E8 FB3B                              call    sub_44                  ; (231E)
2913:27E3                       loc_309:                                        ;  xref 2913:27DB
2913:27E3  8B EB                                mov     bp,bx
2913:27E5  32 C9                                xor     cl,cl
2913:27E7  E8 00CE                              call    sub_49                  ; (28B8)
2913:27EA  75 26                                jnz     loc_312
2913:27EC  80 FA 06                             cmp     dl,6
2913:27EF  73 0A                                jae     loc_310
2913:27F1  FE C1                                inc     cl
2913:27F3  4B                                   dec     bx
2913:27F4  E8 00C1                              call    sub_49                  ; (28B8)
2913:27F7  75 19                                jnz     loc_312
2913:27F9  EB 0D                                jmp     short loc_311           ; (2808)
2913:27FB                       loc_310:                                        ;  xref 2913:27EF
2913:27FB  80 FA 20                             cmp     dl,20h                  ; ' '
2913:27FE  72 08                                jb      loc_311
2913:2800  FE C9                                dec     cl
2913:2802  43                                   inc     bx
2913:2803  E8 00B2                              call    sub_49                  ; (28B8)
2913:2806  75 63                                jnz     loc_318
2913:2808                       loc_311:                                        ;  xref 2913:27F9, 27FE
2913:2808  80 FE 06                             cmp     dh,6
2913:280B  73 21                                jae     loc_314
2913:280D  FE CF                                dec     bh
2913:280F  E8 00A6                              call    sub_49                  ; (28B8)
2913:2812                       loc_312:                                        ;  xref 2913:27EA, 27F7
2913:2812  75 57                                jnz     loc_318
2913:2814  84 C9                                test    cl,cl
2913:2816  74 3A                                jz      loc_316
2913:2818  78 0A                                js      loc_313
2913:281A  4B                                   dec     bx
2913:281B  FE CF                                dec     bh
2913:281D  E8 0098                              call    sub_49                  ; (28B8)
2913:2820  75 49                                jnz     loc_318
2913:2822  EB 2E                                jmp     short loc_316           ; (2852)
2913:2824                       loc_313:                                        ;  xref 2913:2818
2913:2824  43                                   inc     bx
2913:2825  FE CF                                dec     bh
2913:2827  E8 008E                              call    sub_49                  ; (28B8)
2913:282A  75 3F                                jnz     loc_318
2913:282C  EB 24                                jmp     short loc_316           ; (2852)
2913:282E                       loc_314:                                        ;  xref 2913:280B
2913:282E  80 FE 20                             cmp     dh,20h                  ; ' '
2913:2831  72 1F                                jb      loc_316
2913:2833  FE C7                                inc     bh
2913:2835  E8 0080                              call    sub_49                  ; (28B8)
2913:2838  75 31                                jnz     loc_318
2913:283A  84 C9                                test    cl,cl
2913:283C  74 14                                jz      loc_316
2913:283E  78 0A                                js      loc_315
2913:2840  4B                                   dec     bx
2913:2841  FE C7                                inc     bh
2913:2843  E8 0072                              call    sub_49                  ; (28B8)
2913:2846  75 23                                jnz     loc_318
2913:2848  EB 08                                jmp     short loc_316           ; (2852)
2913:284A                       loc_315:                                        ;  xref 2913:283E
2913:284A  43                                   inc     bx
2913:284B  FE C7                                inc     bh
2913:284D  E8 0068                              call    sub_49                  ; (28B8)
2913:2850  75 19                                jnz     loc_318
2913:2852                       loc_316:                                        ;  xref 2913:2816, 2822, 282C, 2831
                                                                                ;            283C, 2848
2913:2852  88 9C 4F9B                           mov     ds:data_188e[si],bl     ; (2913:4F9B=0)
2913:2856  88 BC 4FC5                           mov     ds:data_189e[si],bh     ; (2913:4FC5=0)
2913:285A  88 94 4FEF                           mov     ds:data_190e[si],dl     ; (2913:4FEF=0)
2913:285E  88 B4 5019                           mov     ds:data_191e[si],dh     ; (2913:5019=0)
2913:2862  59                                   pop     cx
2913:2863  5A                                   pop     dx
2913:2864  88 94 506D                           mov     ds:data_193e[si],dl     ; (2913:506D=0)
2913:2868                       loc_317:                                        ;  xref 2913:2881, 289A, 28A8, 28B6
2913:2868 ,E9 FE85                              jmp     loc_292                 ; (26F0)
2913:286B                       loc_318:                                        ;  xref 2913:2806, 2812, 2820, 282A
                                                                                ;            2838, 2846, 2850
2913:286B  59                                   pop     cx
2913:286C  5A                                   pop     dx
2913:286D  8A 9C 4F9B                           mov     bl,ds:data_188e[si]     ; (2913:4F9B=0)
2913:2871  8A BC 4FC5                           mov     bh,ds:data_189e[si]     ; (2913:4FC5=0)
2913:2875  84 C9                                test    cl,cl
2913:2877  78 06                                js      loc_319
2913:2879  E8 FAC8                              call    sub_45                  ; (2344)
2913:287C  E8 FA9F                              call    sub_44                  ; (231E)
2913:287F                       loc_319:                                        ;  xref 2913:2877
2913:287F  FE C6                                inc     dh
2913:2881  75 E5                                jnz     loc_317
2913:2883  8A A4 5043                           mov     ah,ds:coll_flags1_e[si] ; (2913:5043=0)
2913:2887  F6 C4 70                             test    ah,70h                  ; 'p'
2913:288A  75 0C                                jnz     loc_320
2913:288C  32 D2                                xor     dl,dl
2913:288E  88 94 506D                           mov     ds:data_193e[si],dl     ; (2913:506D=0)
2913:2892  E8 03B3                              call    sub_64                  ; (2C48)
2913:2895  E9 FE72                              jmp     loc_296                 ; (270A)
2913:2898                       loc_320:                                        ;  xref 2913:288A
2913:2898  84 ED                                test    ch,ch
2913:289A  78 CC                                js      loc_317
2913:289C  A0 4F89                              mov     al,ds:data_183e         ; (2913:4F89=0)
2913:289F  0A C5                                or      al,ch
2913:28A1  88 84 5043                           mov     ds:coll_flags1_e[si],al ; (2913:5043=0)
2913:28A5  80 FD 60                             cmp     ch,60h                  ; '`'
2913:28A8  75 BE                                jne     loc_317
2913:28AA  A0 4F89                              mov     al,ds:data_183e         ; (2913:4F89=0)
2913:28AD  98                                   cbw
2913:28AE  8B F8                                mov     di,ax
2913:28B0  C6 85 521A 02                        mov     byte ptr ds:data_204e[di],2 ; (2913:521A=0)
2913:28B5  90                                   nop
2913:28B6  EB B0                                jmp     short loc_317           ; (2868)
                                sub_48          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:27E7, 27F4, 2803, 280F, 281D, 2827, 2835
                                ;                             2843, 284D
                                ;==========================================================================

2913:28B8                       sub_49          proc    near
2913:28B8  51                                   push    cx
2913:28B9  E8 FA49                              call    tmp1_readxy             ; (2305)
2913:28BC  8B DD                                mov     bx,bp
2913:28BE  EB 07                                jmp     short loc_322           ; (28C7)
2913:28C0                       loc_321:                                        ;  xref 2913:28CF, 2905, 2921
2913:28C0  8A 85 50F7                           mov     al,ds:data_195e[di]     ; (2913:50F7=0)
2913:28C4  98                                   cbw
2913:28C5  84 C0                                test    al,al
2913:28C7                       loc_322:                                        ;  xref 2913:28BE
2913:28C7  8B F8                                mov     di,ax
2913:28C9  75 02                                jnz     loc_324
2913:28CB                       loc_323:                                        ;  xref 2913:2925
2913:28CB ,59                                   pop     cx
2913:28CC  C3                                   retn
2913:28CD                       loc_324:                                        ;  xref 2913:28C9
2913:28CD  3B FE                                cmp     di,si
2913:28CF  74 EF                                je      loc_321
2913:28D1  8A 85 5043                           mov     al,ds:coll_flags1_e[di] ; (2913:5043=0)
2913:28D5  84 C0                                test    al,al
2913:28D7  74 0F                                jz      loc_326
2913:28D9  3C 01                                cmp     al,1
2913:28DB  74 06                                je      loc_325
2913:28DD  24 70                                and     al,70h                  ; 'p'
2913:28DF  3C 10                                cmp     al,10h
2913:28E1  75 05                                jne     loc_326
2913:28E3                       loc_325:                                        ;  xref 2913:28DB
2913:28E3  B9 1B0E                              mov     cx,1B0Eh
2913:28E6  EB 03                                jmp     short loc_327           ; (28EB)
2913:28E8                       loc_326:                                        ;  xref 2913:28D7, 28E1
2913:28E8  B9 0F07                              mov     cx,0F07h
2913:28EB                       loc_327:                                        ;  xref 2913:28E6
2913:28EB  8A C3                                mov     al,bl
2913:28ED  2A 85 4F9B                           sub     al,ds:data_188e[di]     ; (2913:4F9B=0)
2913:28F1  74 08                                jz      loc_329
2913:28F3  79 04                                jns     loc_328
2913:28F5  B0 DA                                mov     al,0DAh
2913:28F7  EB 02                                jmp     short loc_329           ; (28FB)
2913:28F9                       loc_328:                                        ;  xref 2913:28F3
2913:28F9  B0 26                                mov     al,26h                  ; '&'
2913:28FB                       loc_329:                                        ;  xref 2913:28F1, 28F7
2913:28FB  02 C2                                add     al,dl
2913:28FD  2A 85 4FEF                           sub     al,ds:data_190e[di]     ; (2913:4FEF=0)
2913:2901  02 C1                                add     al,cl
2913:2903  3A C5                                cmp     al,ch
2913:2905  73 B9                                jae     loc_321
2913:2907  8A C7                                mov     al,bh
2913:2909  2A 85 4FC5                           sub     al,ds:data_189e[di]     ; (2913:4FC5=0)
2913:290D  74 08                                jz      loc_331
2913:290F  79 04                                jns     loc_330
2913:2911  B0 DA                                mov     al,0DAh
2913:2913  EB 02                                jmp     short loc_331           ; (2917)
2913:2915                       loc_330:                                        ;  xref 2913:290F
2913:2915  B0 26                                mov     al,26h                  ; '&'
2913:2917                       loc_331:                                        ;  xref 2913:290D, 2913
2913:2917  02 C6                                add     al,dh
2913:2919  2A 85 5019                           sub     al,ds:data_191e[di]     ; (2913:5019=0)
2913:291D  02 C1                                add     al,cl
2913:291F  3A C5                                cmp     al,ch
2913:2921  73 9D                                jae     loc_321
2913:2923  3A CD                                cmp     cl,ch
2913:2925  EB A4                                jmp     short loc_323           ; (28CB)
                                sub_49          endp

2913:2927  00                   data_165        db      0                       ; Data table (indexed access)
                                                                                ;  xref 2913:2766
2913:2928  00 00 01 00 00 01                    db      0, 0, 1, 0, 0, 1
2913:292E  00 01 00 01 00 01                    db      0, 1, 0, 1, 0, 1
2913:2934  00 01 00 01 00 01                    db      0, 1, 0, 1, 0, 1
2913:293A  00 01 00 01 00 01                    db      0, 1, 0, 1, 0, 1
2913:2940  00 01 00 01 00 01                    db      0, 1, 0, 1, 0, 1
2913:2946  00 01 01 00 01 01                    db      0, 1, 1, 0, 1, 1

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2BF4, 2C2A, 2C60, 2D5D, 2E88, 2E97
                                ;==========================================================================

2913:294C                       sub_50          proc    near
2913:294C  53                                   push    bx
2913:294D  57                                   push    di
2913:294E  52                                   push    dx
2913:294F  8A 94 4F9B                           mov     dl,ds:data_188e[si]     ; (2913:4F9B=0)
2913:2953  8A B4 4FC5                           mov     dh,ds:data_189e[si]     ; (2913:4FC5=0)
2913:2957  8B DE                                mov     bx,si
2913:2959  E8 05E0                              call    maze_readxy             ; (2F3C)
2913:295C  8B FE                                mov     di,si
2913:295E  8B F3                                mov     si,bx
2913:2960  8A 9C 50D7                           mov     bl,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2964  D1 E3                                shl     bx,1
2913:2966  B4 80                                mov     ah,80h
2913:2968  FF 97 2970                           call    word ptr data_166[bx]   ;*(2913:2970=2980h)  8 entries
2913:296C  5A                                   pop     dx
2913:296D  5F                                   pop     di
2913:296E  5B                                   pop     bx
2913:296F  C3                                   retn
                                sub_50          endp

2913:2970  2980                 data_166        dw      offset sub_51           ; Data table (indexed access) (2980)
                                                                                ;  xref 2913:2968
2913:2972  2A56                 data_167        dw      offset sub_55           ; (2A56)
                                                                                ;  xref 2913:2968
2913:2974  29A5                 data_168        dw      offset sub_52           ; (29A5)
                                                                                ;  xref 2913:2968
2913:2976  2AAF                 data_169        dw      offset sub_56           ; (2AAF)
                                                                                ;  xref 2913:2968
2913:2978  29CA                 data_170        dw      offset sub_53           ; (29CA)
                                                                                ;  xref 2913:2968
2913:297A  2B11                 data_171        dw      offset sub_57           ; (2B11)
                                                                                ;  xref 2913:2968
2913:297C  29EF                 data_172        dw      offset sub_54           ; (29EF)
                                                                                ;  xref 2913:2968
2913:297E  2B6E                 data_173        dw      offset sub_58           ; (2B6E)
                                                                                ;  xref 2913:2968

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2968, 2970
                                ;==========================================================================

2913:2980                       sub_51          proc    near
2913:2980  E8 0259                              call    sub_60                  ; (2BDC)
2913:2983  75 0F                                jnz     loc_332
2913:2985  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2989  80 FB 04                             cmp     bl,4
2913:298C  73 09                                jae     loc_333
2913:298E  F6 45 BF 8C                          test    byte ptr [di-41h],8Ch
2913:2992  74 0E                                jz      loc_334
2913:2994                       loc_332:                                        ;  xref 2913:2983, 29A0
2913:2994  E9 0088                              jmp     loc_347                 ; (2A1F)
2913:2997                       loc_333:                                        ;  xref 2913:298C
2913:2997  80 FB 21                             cmp     bl,21h                  ; '!'
2913:299A  72 06                                jb      loc_334
2913:299C  F6 45 C1 89                          test    byte ptr [di-3Fh],89h
2913:29A0  75 F2                                jnz     loc_332
2913:29A2                       loc_334:                                        ;  xref 2913:2992, 299A
2913:29A2  E9 009C                              jmp     loc_351                 ; (2A41)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2968, 2974

2913:29A5                       sub_52:
2913:29A5  E8 022C                              call    sub_59                  ; (2BD4)
2913:29A8  75 0F                                jnz     loc_335
2913:29AA  8A 9C 5019                           mov     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:29AE  80 FB 05                             cmp     bl,5
2913:29B1  73 09                                jae     loc_336
2913:29B3  F6 45 C1 89                          test    byte ptr [di-3Fh],89h
2913:29B7  74 0E                                jz      loc_337
2913:29B9                       loc_335:                                        ;  xref 2913:29A8, 29C5
2913:29B9  EB 59                                jmp     short loc_344           ; (2A14)
2913:29BB  90                                   db      90h
2913:29BC                       loc_336:                                        ;  xref 2913:29B1
2913:29BC  80 FB 22                             cmp     bl,22h                  ; '"'
2913:29BF  72 06                                jb      loc_337
2913:29C1  F6 45 41 83                          test    byte ptr [di+41h],83h
2913:29C5  75 F2                                jnz     loc_335
2913:29C7                       loc_337:                                        ;  xref 2913:29B7, 29BF
2913:29C7  EB 71                                jmp     short loc_350           ; (2A3A)
2913:29C9  90                                   db      90h

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2968, 2978

2913:29CA                       sub_53:
2913:29CA  E8 0217                              call    sub_61                  ; (2BE4)
2913:29CD  75 0F                                jnz     loc_338
2913:29CF  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:29D3  80 FB 04                             cmp     bl,4
2913:29D6  73 09                                jae     loc_339
2913:29D8  F6 45 3F 86                          test    byte ptr [di+3Fh],86h
2913:29DC  74 0E                                jz      loc_340
2913:29DE                       loc_338:                                        ;  xref 2913:29CD, 29EA
2913:29DE  EB 48                                jmp     short loc_348           ; (2A28)
2913:29E0  90                                   db      90h
2913:29E1                       loc_339:                                        ;  xref 2913:29D6
2913:29E1  80 FB 21                             cmp     bl,21h                  ; '!'
2913:29E4  72 06                                jb      loc_340
2913:29E6  F6 45 41 83                          test    byte ptr [di+41h],83h
2913:29EA  75 F2                                jnz     loc_338
2913:29EC                       loc_340:                                        ;  xref 2913:29DC, 29E4
2913:29EC  EB 5A                                jmp     short loc_352           ; (2A48)
2913:29EE  90                                   db      90h

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2968, 297C

2913:29EF                       sub_54:
2913:29EF  E8 01FA                              call    sub_62                  ; (2BEC)
2913:29F2  75 0F                                jnz     loc_341
2913:29F4  8A 9C 5019                           mov     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:29F8  80 FB 05                             cmp     bl,5
2913:29FB  73 09                                jae     loc_342
2913:29FD  F6 45 BF 8C                          test    byte ptr [di-41h],8Ch
2913:2A01  74 0E                                jz      loc_343
2913:2A03                       loc_341:                                        ;  xref 2913:29F2, 2A0F
2913:2A03  EB 2C                                jmp     short loc_349           ; (2A31)
2913:2A05  90                                   db      90h
2913:2A06                       loc_342:                                        ;  xref 2913:29FB
2913:2A06  80 FB 22                             cmp     bl,22h                  ; '"'
2913:2A09  72 06                                jb      loc_343
2913:2A0B  F6 45 3F 86                          test    byte ptr [di+3Fh],86h
2913:2A0F  75 F2                                jnz     loc_341
2913:2A11                       loc_343:                                        ;  xref 2913:2A01, 2A09
2913:2A11  EB 3C                                jmp     short loc_353           ; (2A4F)
2913:2A13  90                                   db      90h
2913:2A14                       loc_344:                                        ;  xref 2913:29B9, 2A89, 2AE8
2913:2A14 ,B0 1F                                mov     al,1Fh
2913:2A16  2A 84 4FEF                           sub     al,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A1A  79 02                                jns     loc_ret_346
2913:2A1C                       loc_345:                                        ;  xref 2913:2A25, 2A2E, 2A37
2913:2A1C  32 C0                                xor     al,al

2913:2A1E                       loc_ret_346:                                    ;  xref 2913:2A1A
2913:2A1E  C3                                   retn
2913:2A1F                       loc_347:                                        ;  xref 2913:2994, 2A8B, 2BA7
2913:2A1F ,8A 84 5019                           mov     al,ds:data_191e[si]     ; (2913:5019=0)
2913:2A23  2C 06                                sub     al,6
2913:2A25  78 F5                                js      loc_345
2913:2A27  C3                                   retn
2913:2A28                       loc_348:                                        ;  xref 2913:29DE, 2AE5, 2B48
2913:2A28 ,B0 20                                mov     al,20h                  ; ' '
2913:2A2A  2A 84 5019                           sub     al,ds:data_191e[si]     ; (2913:5019=0)
2913:2A2E  78 EC                                js      loc_345
2913:2A30  C3                                   retn
2913:2A31                       loc_349:                                        ;  xref 2913:2A03, 2B45, 2BA4
2913:2A31 ,8A 84 4FEF                           mov     al,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A35  2C 06                                sub     al,6
2913:2A37  78 E3                                js      loc_345
2913:2A39  C3                                   retn
2913:2A3A                       loc_350:                                        ;  xref 2913:29C7, 2AAD, 2AE2
2913:2A3A ,B0 44                                mov     al,44h                  ; 'D'
2913:2A3C  2A 84 4FEF                           sub     al,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A40  C3                                   retn
2913:2A41                       loc_351:                                        ;  xref 2913:29A2, 2A87, 2BA1
2913:2A41 ,B0 1F                                mov     al,1Fh
2913:2A43  02 84 5019                           add     al,ds:data_191e[si]     ; (2913:5019=0)
2913:2A47  C3                                   retn
2913:2A48                       loc_352:                                        ;  xref 2913:29EC, 2B0E, 2B6B
2913:2A48 ,B0 45                                mov     al,45h                  ; 'E'
2913:2A4A  2A 84 5019                           sub     al,ds:data_191e[si]     ; (2913:5019=0)
2913:2A4E  C3                                   retn
2913:2A4F                       loc_353:                                        ;  xref 2913:2A11, 2B42, 2BD1
2913:2A4F ,B0 1E                                mov     al,1Eh
2913:2A51  02 84 4FEF                           add     al,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A55  C3                                   retn
                                sub_51          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2968, 2972
                                ;==========================================================================

2913:2A56                       sub_55          proc    near
2913:2A56  8A 7D C1                             mov     bh,[di-3Fh]
2913:2A59  B3 25                                mov     bl,25h                  ; '%'
2913:2A5B  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2A5F  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A63  72 28                                jb      loc_358
2913:2A65  E8 0174                              call    sub_60                  ; (2BDC)
2913:2A68  75 21                                jnz     loc_357
2913:2A6A  F6 C7 81                             test    bh,81h
2913:2A6D  75 1A                                jnz     loc_356
2913:2A6F  B3 1D                                mov     bl,1Dh
2913:2A71  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2A75  72 06                                jc      loc_354
2913:2A77  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2A7B  73 0A                                jae     loc_355
2913:2A7D                       loc_354:                                        ;  xref 2913:2A75
2913:2A7D  F6 C7 08                             test    bh,8
2913:2A80  75 07                                jnz     loc_356
2913:2A82  E8 014F                              call    sub_59                  ; (2BD4)
2913:2A85  75 02                                jnz     loc_356
2913:2A87                       loc_355:                                        ;  xref 2913:2A7B
2913:2A87  EB B8                                jmp     short loc_351           ; (2A41)
2913:2A89                       loc_356:                                        ;  xref 2913:2A6D, 2A80, 2A85, 2A90
2913:2A89  EB 89                                jmp     short loc_344           ; (2A14)
2913:2A8B                       loc_357:                                        ;  xref 2913:2A68, 2A95, 2AA6, 2AAB
2913:2A8B  EB 92                                jmp     short loc_347           ; (2A1F)
2913:2A8D                       loc_358:                                        ;  xref 2913:2A63
2913:2A8D  E8 0144                              call    sub_59                  ; (2BD4)
2913:2A90  75 F7                                jnz     loc_356
2913:2A92  F6 C7 88                             test    bh,88h
2913:2A95  75 F4                                jnz     loc_357
2913:2A97  B3 2C                                mov     bl,2Ch                  ; ','
2913:2A99  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2A9D  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2AA1  72 0A                                jb      loc_359
2913:2AA3  F6 C7 81                             test    bh,81h
2913:2AA6  75 E3                                jnz     loc_357
2913:2AA8  E8 0131                              call    sub_60                  ; (2BDC)
2913:2AAB  75 DE                                jnz     loc_357
2913:2AAD                       loc_359:                                        ;  xref 2913:2AA1
2913:2AAD  EB 8B                                jmp     short loc_350           ; (2A3A)
                                sub_55          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2968, 2976
                                ;==========================================================================

2913:2AAF                       sub_56          proc    near
2913:2AAF  8A 7D 41                             mov     bh,[di+41h]
2913:2AB2  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2AB6  80 C3 01                             add     bl,1
2913:2AB9  3A 9C 5019                           cmp     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2ABD  72 2C                                jb      loc_364
2913:2ABF  E8 0112                              call    sub_59                  ; (2BD4)
2913:2AC2  75 24                                jnz     loc_363
2913:2AC4  F6 C7 82                             test    bh,82h
2913:2AC7  75 1C                                jnz     loc_362
2913:2AC9  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2ACD  80 EB 07                             sub     bl,7
2913:2AD0  72 06                                jc      loc_360
2913:2AD2  3A 9C 5019                           cmp     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2AD6  73 0A                                jae     loc_361
2913:2AD8                       loc_360:                                        ;  xref 2913:2AD0
2913:2AD8  F6 C7 01                             test    bh,1
2913:2ADB  75 08                                jnz     loc_362
2913:2ADD  E8 0104                              call    sub_61                  ; (2BE4)
2913:2AE0  75 03                                jnz     loc_362
2913:2AE2                       loc_361:                                        ;  xref 2913:2AD6
2913:2AE2  E9 FF55                              jmp     loc_350                 ; (2A3A)
2913:2AE5                       loc_362:                                        ;  xref 2913:2AC7, 2ADB, 2AE0, 2AEE
2913:2AE5  E9 FF40                              jmp     loc_348                 ; (2A28)
2913:2AE8                       loc_363:                                        ;  xref 2913:2AC2, 2AF3, 2B07, 2B0C
2913:2AE8  E9 FF29                              jmp     loc_344                 ; (2A14)
2913:2AEB                       loc_364:                                        ;  xref 2913:2ABD
2913:2AEB  E8 00F6                              call    sub_61                  ; (2BE4)
2913:2AEE  75 F5                                jnz     loc_362
2913:2AF0  F6 C7 81                             test    bh,81h
2913:2AF3  75 F3                                jnz     loc_363
2913:2AF5  8A 9C 5019                           mov     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2AF9  80 EB 09                             sub     bl,9
2913:2AFC  72 06                                jc      loc_365
2913:2AFE  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B02  73 0A                                jae     loc_366
2913:2B04                       loc_365:                                        ;  xref 2913:2AFC
2913:2B04  F6 C7 02                             test    bh,2
2913:2B07  75 DF                                jnz     loc_363
2913:2B09  E8 00C8                              call    sub_59                  ; (2BD4)
2913:2B0C  75 DA                                jnz     loc_363
2913:2B0E                       loc_366:                                        ;  xref 2913:2B02
2913:2B0E  E9 FF37                              jmp     loc_352                 ; (2A48)
                                sub_56          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2968, 297A
                                ;==========================================================================

2913:2B11                       sub_57          proc    near
2913:2B11  8A 7D 3F                             mov     bh,[di+3Fh]
2913:2B14  B3 25                                mov     bl,25h                  ; '%'
2913:2B16  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2B1A  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B1E  72 2B                                jb      loc_371
2913:2B20  E8 00C9                              call    sub_62                  ; (2BEC)
2913:2B23  75 20                                jnz     loc_369
2913:2B25  F6 C7 82                             test    bh,82h
2913:2B28  75 1E                                jnz     loc_370
2913:2B2A  B3 1D                                mov     bl,1Dh
2913:2B2C  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2B30  72 06                                jc      loc_367
2913:2B32  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B36  73 0A                                jae     loc_368
2913:2B38                       loc_367:                                        ;  xref 2913:2B30
2913:2B38  F6 C7 04                             test    bh,4
2913:2B3B  75 0B                                jnz     loc_370
2913:2B3D  E8 00A4                              call    sub_61                  ; (2BE4)
2913:2B40  75 06                                jnz     loc_370
2913:2B42                       loc_368:                                        ;  xref 2913:2B36
2913:2B42  E9 FF0A                              jmp     loc_353                 ; (2A4F)
2913:2B45                       loc_369:                                        ;  xref 2913:2B23, 2B53, 2B64, 2B69
2913:2B45  E9 FEE9                              jmp     loc_349                 ; (2A31)
2913:2B48                       loc_370:                                        ;  xref 2913:2B28, 2B3B, 2B40, 2B4E
2913:2B48  E9 FEDD                              jmp     loc_348                 ; (2A28)
2913:2B4B                       loc_371:                                        ;  xref 2913:2B1E
2913:2B4B  E8 0096                              call    sub_61                  ; (2BE4)
2913:2B4E  75 F8                                jnz     loc_370
2913:2B50  F6 C7 84                             test    bh,84h
2913:2B53  75 F0                                jnz     loc_369
2913:2B55  B3 2C                                mov     bl,2Ch                  ; ','
2913:2B57  2A 9C 5019                           sub     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2B5B  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B5F  72 0A                                jb      loc_372
2913:2B61  F6 C7 02                             test    bh,2
2913:2B64  75 DF                                jnz     loc_369
2913:2B66  E8 0083                              call    sub_62                  ; (2BEC)
2913:2B69  75 DA                                jnz     loc_369
2913:2B6B                       loc_372:                                        ;  xref 2913:2B5F
2913:2B6B  E9 FEDA                              jmp     loc_352                 ; (2A48)
                                sub_57          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2968, 297E
                                ;==========================================================================

2913:2B6E                       sub_58          proc    near
2913:2B6E  8A 7D BF                             mov     bh,[di-41h]
2913:2B71  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B75  80 C3 01                             add     bl,1
2913:2B78  3A 9C 5019                           cmp     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2B7C  72 2C                                jb      loc_377
2913:2B7E  E8 005B                              call    sub_60                  ; (2BDC)
2913:2B81  75 24                                jnz     loc_376
2913:2B83  F6 C7 84                             test    bh,84h
2913:2B86  75 1C                                jnz     loc_375
2913:2B88  8A 9C 4FEF                           mov     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2B8C  80 EB 07                             sub     bl,7
2913:2B8F  72 06                                jc      loc_373
2913:2B91  3A 9C 5019                           cmp     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2B95  73 0A                                jae     loc_374
2913:2B97                       loc_373:                                        ;  xref 2913:2B8F
2913:2B97  F6 C7 08                             test    bh,8
2913:2B9A  75 08                                jnz     loc_375
2913:2B9C  E8 004D                              call    sub_62                  ; (2BEC)
2913:2B9F  75 03                                jnz     loc_375
2913:2BA1                       loc_374:                                        ;  xref 2913:2B95
2913:2BA1  E9 FE9D                              jmp     loc_351                 ; (2A41)
2913:2BA4                       loc_375:                                        ;  xref 2913:2B86, 2B9A, 2B9F, 2BAD
2913:2BA4  E9 FE8A                              jmp     loc_349                 ; (2A31)
2913:2BA7                       loc_376:                                        ;  xref 2913:2B81, 2BB1, 2BB6, 2BCA
                                                                                ;            2BCF
2913:2BA7  E9 FE75                              jmp     loc_347                 ; (2A1F)
2913:2BAA                       loc_377:                                        ;  xref 2913:2B7C
2913:2BAA  E8 003F                              call    sub_62                  ; (2BEC)
2913:2BAD  75 F5                                jnz     loc_375
2913:2BAF  84 FF                                test    bh,bh
2913:2BB1  78 F4                                js      loc_376
2913:2BB3  F6 C7 08                             test    bh,8
2913:2BB6  75 EF                                jnz     loc_376
2913:2BB8  8A 9C 5019                           mov     bl,ds:data_191e[si]     ; (2913:5019=0)
2913:2BBC  80 EB 09                             sub     bl,9
2913:2BBF  72 06                                jc      loc_378
2913:2BC1  3A 9C 4FEF                           cmp     bl,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2BC5  73 0A                                jae     loc_379
2913:2BC7                       loc_378:                                        ;  xref 2913:2BBF
2913:2BC7  F6 C7 04                             test    bh,4
2913:2BCA  75 DB                                jnz     loc_376
2913:2BCC  E8 000D                              call    sub_60                  ; (2BDC)
2913:2BCF  75 D6                                jnz     loc_376
2913:2BD1                       loc_379:                                        ;  xref 2913:2BC5
2913:2BD1  E9 FE7B                              jmp     loc_353                 ; (2A4F)
                                sub_58          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:29A5, 2A82, 2A8D, 2ABF, 2B09
                                ;==========================================================================

2913:2BD4                       sub_59          proc    near
2913:2BD4  A8 04                                test    al,4
2913:2BD6  75 03                                jnz     loc_ret_380
2913:2BD8  84 65 01                             test    ah,[di+1]

2913:2BDB                       loc_ret_380:                                    ;  xref 2913:2BD6
2913:2BDB  C3                                   retn
                                sub_59          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2980, 2A65, 2AA8, 2B7E, 2BCC
                                ;==========================================================================

2913:2BDC                       sub_60          proc    near
2913:2BDC  A8 02                                test    al,2
2913:2BDE  75 03                                jnz     loc_ret_381
2913:2BE0  84 65 C0                             test    ah,[di-40h]

2913:2BE3                       loc_ret_381:                                    ;  xref 2913:2BDE
2913:2BE3  C3                                   retn
                                sub_60          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:29CA, 2ADD, 2AEB, 2B3D, 2B4B
                                ;==========================================================================

2913:2BE4                       sub_61          proc    near
2913:2BE4  A8 08                                test    al,8
2913:2BE6  75 03                                jnz     loc_ret_382
2913:2BE8  84 65 40                             test    ah,[di+40h]

2913:2BEB                       loc_ret_382:                                    ;  xref 2913:2BE6
2913:2BEB  C3                                   retn
                                sub_61          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:29EF, 2B20, 2B66, 2B9C, 2BAA
                                ;==========================================================================

2913:2BEC                       sub_62          proc    near
2913:2BEC  A8 01                                test    al,1
2913:2BEE  75 03                                jnz     loc_ret_383
2913:2BF0  84 65 FF                             test    ah,[di-1]

2913:2BF3                       loc_ret_383:                                    ;  xref 2913:2BEE
2913:2BF3  C3                                   retn
                                sub_62          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:276C
                                ;==========================================================================

2913:2BF4                       sub_63          proc    near
2913:2BF4                       loc_384:                                        ;  xref 2913:2D1F
2913:2BF4 ,E8 FD55                              call    sub_50                  ; (294C)
2913:2BF7  8A F8                                mov     bh,al
2913:2BF9  8A 9C 50D7                           mov     bl,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2BFD  3A BC 50B7                           cmp     bh,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:2C01  73 09                                jae     loc_386
2913:2C03                       loc_385:                                        ;  xref 2913:2C37
2913:2C03  B0 02                                mov     al,2
2913:2C05  E8 02C9                              call    rnd_update              ; (2ED1)
2913:2C08  74 11                                jz      loc_387
2913:2C0A  EB 13                                jmp     short loc_388           ; (2C1F)
2913:2C0C                       loc_386:                                        ;  xref 2913:2C01
2913:2C0C  B0 08                                mov     al,8
2913:2C0E  E8 02C0                              call    rnd_update              ; (2ED1)
2913:2C11  74 08                                jz      loc_387
2913:2C13  3C 01                                cmp     al,1
2913:2C15  74 08                                je      loc_388
2913:2C17  8A C7                                mov     al,bh
2913:2C19  EB 12                                jmp     short loc_390           ; (2C2D)
2913:2C1B                       loc_387:                                        ;  xref 2913:2C08, 2C11
2913:2C1B  FE CB                                dec     bl
2913:2C1D  EB 02                                jmp     short loc_389           ; (2C21)
2913:2C1F                       loc_388:                                        ;  xref 2913:2C0A, 2C15
2913:2C1F  FE C3                                inc     bl
2913:2C21                       loc_389:                                        ;  xref 2913:2C1D
2913:2C21  80 E3 07                             and     bl,7
2913:2C24  88 9C 50D7                           mov     ds:ship_angle_e[si],bl  ; (2913:50D7=0)
2913:2C28  FE C6                                inc     dh
2913:2C2A  E8 FD1F                              call    sub_50                  ; (294C)
2913:2C2D                       loc_390:                                        ;  xref 2913:2C19
2913:2C2D  8A F8                                mov     bh,al
2913:2C2F  2A 84 50B7                           sub     al,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:2C33  73 08                                jnc     loc_391
2913:2C35  84 F6                                test    dh,dh
2913:2C37  78 CA                                js      loc_385
2913:2C39  8A C7                                mov     al,bh
2913:2C3B  EB 08                                jmp     short loc_392           ; (2C45)
2913:2C3D                       loc_391:                                        ;  xref 2913:2C33
2913:2C3D  E8 02BA                              call    rndnum                  ; (2EFA)
2913:2C40  40                                   inc     ax
2913:2C41  02 84 50B7                           add     al,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:2C45                       loc_392:                                        ;  xref 2913:2C3B
2913:2C45  8A D0                                mov     dl,al
2913:2C47  C3                                   retn
                                sub_63          endp


                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2892
                                ;==========================================================================

2913:2C48                       sub_64          proc    near
2913:2C48  B0 02                                mov     al,2
2913:2C4A  E8 0284                              call    rnd_update              ; (2ED1)
2913:2C4D  8A A4 50D7                           mov     ah,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2C51  74 04                                jz      loc_393
2913:2C53  FE C4                                inc     ah
2913:2C55  EB 02                                jmp     short loc_394           ; (2C59)
2913:2C57                       loc_393:                                        ;  xref 2913:2C51
2913:2C57  FE CC                                dec     ah
2913:2C59                       loc_394:                                        ;  xref 2913:2C55
2913:2C59  80 E4 07                             and     ah,7
2913:2C5C  88 A4 50D7                           mov     ds:ship_angle_e[si],ah  ; (2913:50D7=0)
2913:2C60  E8 FCE9                              call    sub_50                  ; (294C)
2913:2C63  E8 0294                              call    rndnum                  ; (2EFA)
2913:2C66  88 84 506D                           mov     ds:data_193e[si],al     ; (2913:506D=0)
2913:2C6A  C3                                   retn
                                sub_64          endp

2913:2C6B  F7 01 09 FF                          db      0F7h, 01h, 09h,0FFh
2913:2C6F  00                   data_174        db      0                       ; Data table (indexed access)
                                                                                ;  xref 2913:2D15
2913:2C70  01 00 07 01 02 03                    db      1, 0, 7, 1, 2, 3
2913:2C76  00 00 03 04 05 07                    db      0, 0, 3, 4, 5, 7
2913:2C7C  00 05 06                             db      0, 5, 6
2913:2C7F  07                   data_175        db      7                       ; Data table (indexed access)
                                                                                ;  xref 2913:2D47
2913:2C80  07 01 01 01 03 01                    db      7, 1, 1, 1, 3, 1
2913:2C86  03 05 05 03 03 07                    db      3, 5, 5, 3, 3, 7
2913:2C8C  05 07 05                             db      5, 7, 5
2913:2C8F  06                   data_176        db      6                       ; Data table (indexed access)
                                                                                ;  xref 2913:2D55
2913:2C90  06 02 02 00 04 00                    db      6, 2, 2, 0, 4, 0
2913:2C96  04 06 06 02 02 00                    db      4, 6, 6, 2, 2, 0
2913:2C9C  04 00 04                             db      4, 0, 4
2913:2C9F  00                   data_177        db      0                       ;  xref 2913:2D63
2913:2CA0  03 06                                db      3, 6
2913:2CA2  03                   data_178        db      3                       ; Data table (indexed access)
                                                                                ;  xref 2913:2DB7
2913:2CA3  04 05 02 FF 06 01                    db       04h, 05h, 02h,0FFh, 06h, 01h
2913:2CA9  00 07                                db       00h, 07h
2913:2CAB  01                   data_179        db      1                       ; Data table (indexed access)
                                                                                ;  xref 2913:2DDF
2913:2CAC  01 01 01 FF FF FF                    db       01h, 01h, 01h,0FFh,0FFh,0FFh
2913:2CB2  00 01 01 01 01 FF                    db       00h, 01h, 01h, 01h, 01h,0FFh
2913:2CB8  FF FF                                db      0FFh,0FFh

                                ;==========================================================================
                                ;                              SUBROUTINE
                                ;
                                ;         Called from:   2913:2771
                                ;==========================================================================

2913:2CBA                       sub_65          proc    near
2913:2CBA  8A 84 4FC5                           mov     al,ds:data_189e[si]     ; (2913:4FC5=0)
2913:2CBE  2A 06 4FC5                           sub     al,ds:data_189e         ; (2913:4FC5=0)
2913:2CC2  04 04                                add     al,4
2913:2CC4  3C 09                                cmp     al,9
2913:2CC6  73 57                                jae     loc_396
2913:2CC8  8A E0                                mov     ah,al
2913:2CCA  D0 E0                                shl     al,1
2913:2CCC  D0 E0                                shl     al,1
2913:2CCE  D0 E0                                shl     al,1
2913:2CD0  02 E0                                add     ah,al
2913:2CD2  8A 84 4F9B                           mov     al,ds:data_188e[si]     ; (2913:4F9B=0)
2913:2CD6  2A 06 4F9B                           sub     al,ds:data_188e         ; (2913:4F9B=0)
2913:2CDA  04 04                                add     al,4
2913:2CDC  3C 09                                cmp     al,9
2913:2CDE  73 3F                                jae     loc_396
2913:2CE0  02 C4                                add     al,ah
2913:2CE2  98                                   cbw
2913:2CE3  8B F8                                mov     di,ax
2913:2CE5  8A 85 5436                           mov     al,ds:data_217e[di]     ; (2913:5436=0)
2913:2CE9  3C 08                                cmp     al,8
2913:2CEB  77 32                                ja      loc_396
2913:2CED  74 74                                jz      loc_400
2913:2CEF  8A F8                                mov     bh,al
2913:2CF1  8A D8                                mov     bl,al
2913:2CF3  D0 E8                                shr     al,1
2913:2CF5  8A E8                                mov     ch,al
2913:2CF7  B1 FF                                mov     cl,0FFh
2913:2CF9  8B E8                                mov     bp,ax
2913:2CFB  8B C7                                mov     ax,di
2913:2CFD  02 86 2C6B                           add     al,[bp+2C6Bh]
2913:2D01  8B F8                                mov     di,ax
2913:2D03  8A 85 5436                           mov     al,ds:data_217e[di]     ; (2913:5436=0)
2913:2D07  3C 08                                cmp     al,8
2913:2D09  74 0E                                je      loc_395
2913:2D0B  3A C7                                cmp     al,bh
2913:2D0D  74 0A                                je      loc_395
2913:2D0F  D0 E0                                shl     al,1
2913:2D11  02 C5                                add     al,ch
2913:2D13  8B F8                                mov     di,ax
2913:2D15  8A 9D 2C6F                           mov     bl,data_174[di]         ; (2913:2C6F=0)
2913:2D19                       loc_395:                                        ;  xref 2913:2D09, 2D0D, 2D2C
2913:2D19 ,E8 0173                              call    sub_67                  ; (2E8F)
2913:2D1C  73 04                                jnc     loc_397
2913:2D1E  C3                                   retn
2913:2D1F                       loc_396:                                        ;  xref 2913:2CC6, 2CDE, 2CEB
2913:2D1F  E9 FED2                              jmp     loc_384                 ; (2BF4)
2913:2D22                       loc_397:                                        ;  xref 2913:2D1C
2913:2D22  FE C5                                inc     ch
2913:2D24  75 08                                jnz     loc_398
2913:2D26  3A DF                                cmp     bl,bh
2913:2D28  74 04                                je      loc_398
2913:2D2A  8A DF                                mov     bl,bh
2913:2D2C  EB EB                                jmp     short loc_395           ; (2D19)
2913:2D2E                       loc_398:                                        ;  xref 2913:2D24, 2D28
2913:2D2E  32 C0                                xor     al,al
2913:2D30  80 BC 4FEF 13                        cmp     byte ptr ds:data_190e[si],13h ; (2913:4FEF=0)
2913:2D35  D0 D0                                rcl     al,1
2913:2D37  80 BC 5019 13                        cmp     byte ptr ds:data_191e[si],13h ; (2913:5019=0)
2913:2D3C  D0 D0                                rcl     al,1
2913:2D3E  8A E7                                mov     ah,bh
2913:2D40  D0 E4                                shl     ah,1
2913:2D42  02 C4                                add     al,ah
2913:2D44  98                                   cbw
2913:2D45  8B F8                                mov     di,ax
2913:2D47  8A 9D 2C7F                           mov     bl,data_175[di]         ; (2913:2C7F=7)
2913:2D4B  E8 0132                              call    sub_66                  ; (2E80)
2913:2D4E  73 01                                jnc     loc_399
2913:2D50  C3                                   retn
2913:2D51                       loc_399:                                        ;  xref 2913:2D4E
2913:2D51  8A 8C 50D7                           mov     cl,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2D55  8A 85 2C8F                           mov     al,data_176[di]         ; (2913:2C8F=6)
2913:2D59  88 84 50D7                           mov     ds:ship_angle_e[si],al  ; (2913:50D7=0)
2913:2D5D  E8 FBEC                              call    sub_50                  ; (294C)
2913:2D60  E9 0141                              jmp     loc_419                 ; (2EA4)
2913:2D63                       loc_400:                                        ;  xref 2913:2CED
2913:2D63 .BF 2C9F                              mov     di,offset data_177      ; (2913:2C9F=0)
2913:2D66  B0 13                                mov     al,13h
2913:2D68  8A F8                                mov     bh,al
2913:2D6A  2A 06 5019                           sub     al,ds:data_191e         ; (2913:5019=0)
2913:2D6E  02 84 5019                           add     al,ds:data_191e[si]     ; (2913:5019=0)
2913:2D72  79 04                                jns     loc_401
2913:2D74  32 FF                                xor     bh,bh
2913:2D76  EB 10                                jmp     short loc_402           ; (2D88)
2913:2D78                       loc_401:                                        ;  xref 2913:2D72
2913:2D78  3C 0E                                cmp     al,0Eh
2913:2D7A  72 0C                                jb      loc_402
2913:2D7C  47                                   inc     di
2913:2D7D  3C 19                                cmp     al,19h
2913:2D7F  72 07                                jb      loc_402
2913:2D81  47                                   inc     di
2913:2D82  3C 26                                cmp     al,26h                  ; '&'
2913:2D84  72 02                                jb      loc_402
2913:2D86  B7 25                                mov     bh,25h                  ; '%'
2913:2D88                       loc_402:                                        ;  xref 2913:2D76, 2D7A, 2D7F, 2D84
2913:2D88  8A 25                                mov     ah,[di]
2913:2D8A  33 FF                                xor     di,di
2913:2D8C  B0 12                                mov     al,12h
2913:2D8E  8A D8                                mov     bl,al
2913:2D90  2A 06 4FEF                           sub     al,ds:data_190e         ; (2913:4FEF=0)
2913:2D94  02 84 4FEF                           add     al,ds:data_190e[si]     ; (2913:4FEF=0)
2913:2D98  79 04                                jns     loc_403
2913:2D9A  32 DB                                xor     bl,bl
2913:2D9C  EB 10                                jmp     short loc_404           ; (2DAE)
2913:2D9E                       loc_403:                                        ;  xref 2913:2D98
2913:2D9E  3C 0D                                cmp     al,0Dh
2913:2DA0  72 0C                                jb      loc_404
2913:2DA2  47                                   inc     di
2913:2DA3  3C 18                                cmp     al,18h
2913:2DA5  72 07                                jb      loc_404
2913:2DA7  47                                   inc     di
2913:2DA8  3C 26                                cmp     al,26h                  ; '&'
2913:2DAA  72 02                                jb      loc_404
2913:2DAC  B3 25                                mov     bl,25h                  ; '%'
2913:2DAE                       loc_404:                                        ;  xref 2913:2D9C, 2DA0, 2DA5, 2DAA
2913:2DAE  8A C4                                mov     al,ah
2913:2DB0  98                                   cbw
2913:2DB1  03 C7                                add     ax,di
2913:2DB3  8B F8                                mov     di,ax
2913:2DB5  8A E0                                mov     ah,al
2913:2DB7  8A 85 2CA2                           mov     al,data_178[di]         ; (2913:2CA2=3)
2913:2DBB  84 C0                                test    al,al
2913:2DBD  78 35                                js      loc_408
2913:2DBF  3A 84 50D7                           cmp     al,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2DC3  74 2F                                je      loc_408
2913:2DC5  8A C8                                mov     cl,al
2913:2DC7  F6 C4 01                             test    ah,1
2913:2DCA  75 2D                                jnz     loc_409
2913:2DCC                       loc_405:                                        ;  xref 2913:2E15, 2E19, 2E1E, 2E29
                                                                                ;            2E2F, 2E34, 2E3F
2913:2DCC ,FE C6                                inc     dh
2913:2DCE  74 04                                jz      loc_406
2913:2DD0  FE CE                                dec     dh
2913:2DD2  EB 1D                                jmp     short loc_407           ; (2DF1)
2913:2DD4                       loc_406:                                        ;  xref 2913:2DCE
2913:2DD4  8A C1                                mov     al,cl
2913:2DD6  2A 84 50D7                           sub     al,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2DDA  04 07                                add     al,7
2913:2DDC  98                                   cbw
2913:2DDD  8B F8                                mov     di,ax
2913:2DDF  8A 85 2CAB                           mov     al,data_179[di]         ; (2913:2CAB=1)
2913:2DE3  02 84 50D7                           add     al,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2DE7  24 07                                and     al,7
2913:2DE9  88 84 50D7                           mov     ds:ship_angle_e[si],al  ; (2913:50D7=0)
2913:2DED  3A C8                                cmp     cl,al
2913:2DEF  74 03                                je      loc_408
2913:2DF1                       loc_407:                                        ;  xref 2913:2DD2
2913:2DF1  32 D2                                xor     dl,dl
2913:2DF3  C3                                   retn
2913:2DF4                       loc_408:                                        ;  xref 2913:2DBD, 2DC3, 2DEF, 2E13
                                                                                ;            2E20, 2E2B, 2E36, 2E41
                                                                                ;            2E4C, 2E57, 2E62
2913:2DF4 ,8A 94 50B7                           mov     dl,ds:vel_magn_e[si]    ; (2913:50B7=0)
2913:2DF8  C3                                   retn
2913:2DF9                       loc_409:                                        ;  xref 2913:2DCA
2913:2DF9  8A 84 50D7                           mov     al,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2DFD  80 FC 01                             cmp     ah,1
2913:2E00  74 4C                                je      loc_416
2913:2E02  80 FC 03                             cmp     ah,3
2913:2E05  74 31                                je      loc_414
2913:2E07  80 FC 05                             cmp     ah,5
2913:2E0A  74 16                                je      loc_412
2913:2E0C  3C 01                                cmp     al,1
2913:2E0E  75 07                                jne     loc_411
2913:2E10  E8 005F                              call    c_2F_m_bl_m_bh          ; (2E72)
2913:2E13  73 DF                                jnc     loc_408
2913:2E15                       loc_410:                                        ;  xref 2913:2E45, 2E4A, 2E55, 2E5B
                                                                                ;            2E60
2913:2E15  EB B5                                jmp     short loc_405           ; (2DCC)
2913:2E17                       loc_411:                                        ;  xref 2913:2E0E
2913:2E17  3C 07                                cmp     al,7
2913:2E19  75 B1                                jne     loc_405
2913:2E1B  E8 005B                              call    c_0B_p_bl_m_bh          ; (2E79)
2913:2E1E  72 AC                                jc      loc_405
2913:2E20  EB D2                                jmp     short loc_408           ; (2DF4)
2913:2E22                       loc_412:                                        ;  xref 2913:2E0A
2913:2E22  3C 05                                cmp     al,5
2913:2E24  75 07                                jne     loc_413
2913:2E26  E8 0049                              call    c_2F_m_bl_m_bh          ; (2E72)
2913:2E29  72 A1                                jc      loc_405
2913:2E2B  EB C7                                jmp     short loc_408           ; (2DF4)
2913:2E2D                       loc_413:                                        ;  xref 2913:2E24
2913:2E2D  3C 07                                cmp     al,7
2913:2E2F  75 9B                                jne     loc_405
2913:2E31  E8 0037                              call    c_bl_m_0A_m_bh          ; (2E6B)
2913:2E34  73 96                                jnc     loc_405
2913:2E36  EB BC                                jmp     short loc_408           ; (2DF4)
2913:2E38                       loc_414:                                        ;  xref 2913:2E05
2913:2E38  3C 03                                cmp     al,3
2913:2E3A  75 07                                jne     loc_415
2913:2E3C  E8 003A                              call    c_0B_p_bl_m_bh          ; (2E79)
2913:2E3F  72 8B                                jc      loc_405
2913:2E41  EB B1                                jmp     short loc_408           ; (2DF4)
2913:2E43                       loc_415:                                        ;  xref 2913:2E3A
2913:2E43  3C 01                                cmp     al,1
2913:2E45  75 CE                                jne     loc_410
2913:2E47  E8 001A                              call    c_1A_m_bl_m_bh          ; (2E64)
2913:2E4A  72 C9                                jc      loc_410
2913:2E4C  EB A6                                jmp     short loc_408           ; (2DF4)
2913:2E4E                       loc_416:                                        ;  xref 2913:2E00
2913:2E4E  3C 05                                cmp     al,5
2913:2E50  75 07                                jne     loc_417
2913:2E52  E8 000F                              call    c_1A_m_bl_m_bh          ; (2E64)
2913:2E55  72 BE                                jc      loc_410
2913:2E57  EB 9B                                jmp     short loc_408           ; (2DF4)
2913:2E59                       loc_417:                                        ;  xref 2913:2E50
2913:2E59  3C 03                                cmp     al,3
2913:2E5B  75 B8                                jne     loc_410
2913:2E5D  E8 0012                              call    c_2F_m_bl_m_bh          ; (2E72)
2913:2E60  72 B3                                jc      loc_410
2913:2E62  EB 90                                jmp     short loc_408           ; (2DF4)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2E47, 2E52

2913:2E64                       c_1A_m_bl_m_bh:
2913:2E64  B0 1A                                mov     al,1Ah
2913:2E66  2A C3                                sub     al,bl
2913:2E68  2A C7                                sub     al,bh
2913:2E6A  C3                                   retn

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2E31

2913:2E6B                       c_bl_m_0A_m_bh:
2913:2E6B  8A C3                                mov     al,bl
2913:2E6D  2C 0A                                sub     al,0Ah
2913:2E6F  2A C7                                sub     al,bh
2913:2E71  C3                                   retn

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2E10, 2E26, 2E5D

2913:2E72                       c_2F_m_bl_m_bh:
2913:2E72  B0 2F                                mov     al,2Fh                  ; '/'
2913:2E74  2A C3                                sub     al,bl
2913:2E76  2A C7                                sub     al,bh
2913:2E78  C3                                   retn

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2E1B, 2E3C

2913:2E79                       c_0B_p_bl_m_bh:
2913:2E79  B0 0B                                mov     al,0Bh
2913:2E7B  02 C3                                add     al,bl
2913:2E7D  2A C7                                sub     al,bh
2913:2E7F  C3                                   retn

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2D4B

2913:2E80                       sub_66:
2913:2E80  8A 8C 50D7                           mov     cl,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2E84  88 9C 50D7                           mov     ds:ship_angle_e[si],bl  ; (2913:50D7=0)
2913:2E88  E8 FAC1                              call    sub_50                  ; (294C)
2913:2E8B  3C 0A                                cmp     al,0Ah
2913:2E8D  EB 0D                                jmp     short loc_418           ; (2E9C)

                                ;==== External Entry into Subroutine ======================================
                                ;
                                ;         Called from:   2913:2D19

2913:2E8F                       sub_67:
2913:2E8F  8A 8C 50D7                           mov     cl,ds:ship_angle_e[si]  ; (2913:50D7=0)
2913:2E93  88 9C 50D7                           mov     ds:ship_angle_e[si],bl  ; (2913:50D7=0)
2913:2E97  E8 FAB2                              call    sub_50                  ; (294C)
2913:2E9A  3C 20                                cmp     al,20h                  ; ' '
2913:2E9C                       loc_418:                                        ;  xref 2913:2E8D
2913:2E9C  73 06                                jae     loc_419
2913:2E9E  88 8C 50D7                           mov     ds:ship_angle_e[si],cl  ; (2913:50D7=0)
2913:2EA2  F8                                   clc
2913:2EA3  C3                                   retn
2913:2EA4                       loc_419:                                        ;  xref 2913:2D60, 2E9C
2913:2EA4  8A E8                                mov     ch,al
2913:2EA6  8A C3                                mov     al,bl
2913:2EA8  2A C1                                sub     al,cl
2913:2EAA  74 1B                                jz      loc_420
2913:2EAC  04 07                                add     al,7
2913:2EAE  98                                   cbw
2913:2EAF  8B E8                                mov     bp,ax
2913:2EB1  8A C1                                mov     al,cl
2913:2EB3  02 86 2CAB                           add     al,[bp+2CABh]
2913:2EB7  24 07                                and     al,7
2913:2EB9  88 84 50D7                           mov     ds:ship_angle_e[si],al  ; (2913:50D7=0)
2913:2EBD  FE C6                                inc     dh
2913:2EBF  3A C7                                cmp     al,bh
2913:2EC1  74 04                                je      loc_420
2913:2EC3  32 D2                                xor     dl,dl
2913:2EC5  EB 08                                jmp     short loc_421           ; (2ECF)
2913:2EC7                       loc_420:                                        ;  xref 2913:2EAA, 2EC1
2913:2EC7  8A C5                                mov     al,ch
2913:2EC9  E8 002E                              call    rndnum                  ; (2EFA)
2913:2ECC  40                                   inc     ax
2913:2ECD  8A D0                                mov     dl,al
2913:2ECF                       loc_421:                                        ;  xref 2913:2EC5
2913:2ECF  F9                                   stc
2913:2ED0  C3                                   retn
                                sub_65          endp


                                ;==========================================================================
                                ;                                rnd_update
                                ;     Inputs: AX: mask + 1
                                ;     Return: AL (something) and ZF
                                ;     I am not sure but I think this routine shuffles the random generator
                                ;     state while also taking the current time into consideration.
                                ;     The result is masked with AX-1.
                                ;
                                ;         Called from:   2913:03E3, 0405, 0CE4, 0CEE, 0CF8, 1CB9, 1FDE
                                ;                             2043, 2074, 207F, 2411, 2432, 2C05, 2C0E
                                ;                             2C4A, 2F0C, 2F1A, 2F29
                                ;==========================================================================

2913:2ED1                       rnd_update      proc    near
2913:2ED1  56                                   push    si
2913:2ED2  57                                   push    di
2913:2ED3 .BE 2F68                              mov     si,offset rnd_state     ; (2913:2F68=0Bh)
2913:2ED6  8B FE                                mov     di,si
2913:2ED8  50                                   push    ax
2913:2ED9  A0 2F88                              mov     al,ds:time_5bit_e       ; (2913:2F88=0)
2913:2EDC  98                                   cbw
2913:2EDD  03 F8                                add     di,ax
2913:2EDF  04 0D                                add     al,0Dh
2913:2EE1  24 1F                                and     al,1Fh
2913:2EE3  A2 2F88                              mov     ds:time_5bit_e,al       ; (2913:2F88=0)
2913:2EE6  03 F0                                add     si,ax
2913:2EE8  8A 05                                mov     al,[di]
2913:2EEA  02 04                                add     al,[si]
2913:2EEC  14 01                                adc     al,1
2913:2EEE  88 05                                mov     [di],al
2913:2EF0  5F                                   pop     di
2913:2EF1  4F                                   dec     di
2913:2EF2  23 C7                                and     ax,di
2913:2EF4  98                                   cbw
2913:2EF5  84 C0                                test    al,al
2913:2EF7  5F                                   pop     di
2913:2EF8  5E                                   pop     si
2913:2EF9  C3                                   retn
                                rnd_update      endp


                                ;==========================================================================
                                ;                                rndnum
                                ;     Inputs:
                                ;             al: random range + 1
                                ;     Return:
                                ;             al: a random number in the range [0..AL).
                                ;             zf: test AL
                                ;
                                ;         Called from:   2913:11A4, 14BB, 2C3D, 2C63, 2EC9
                                ;==========================================================================

2913:2EFA                       rndnum          proc    near
2913:2EFA  52                                   push    dx
2913:2EFB  84 C0                                test    al,al
2913:2EFD  74 14                                jz      loc_424
2913:2EFF  4A                                   dec     dx
2913:2F00  8A D0                                mov     dl,al
2913:2F02  B6 01                                mov     dh,1
2913:2F04                       loc_422:                                        ;  xref 2913:2F08
2913:2F04  D0 E6                                shl     dh,1
2913:2F06  D0 E8                                shr     al,1
2913:2F08  75 FA                                jnz     loc_422
2913:2F0A                       loc_423:                                        ;  xref 2913:2F11
2913:2F0A  8A C6                                mov     al,dh
2913:2F0C  E8 FFC2                              call    rnd_update              ; (2ED1)
2913:2F0F  3A C2                                cmp     al,dl
2913:2F11  73 F7                                jae     loc_423
2913:2F13                       loc_424:                                        ;  xref 2913:2EFD
2913:2F13  5A                                   pop     dx
2913:2F14  98                                   cbw
2913:2F15  84 C0                                test    al,al
2913:2F17  C3                                   retn
                                rndnum          endp


                                ;==========================================================================
                                ;                                maze_rnd_xy
                                ;     Output:
                                ;             DL: x, DH: y, i
                                ;             AL: maze_buf[x,y]
                                ;             SI: address in buffer
                                ;     Generate random numbers x=[1..61], y=[3..60] until maze_buf[x,y] >= 0.
                                ;
                                ;         Called from:   2913:037D, 0400, 0CD2, 1D5D
                                ;==========================================================================

2913:2F18                       maze_rnd_xy     proc    near
2913:2F18                       loc_425:                                        ;  xref 2913:2F1F, 2F23, 2F39
2913:2F18  B0 40                                mov     al,40h                  ; '@'
2913:2F1A  E8 FFB4                              call    rnd_update              ; (2ED1)
2913:2F1D  3C 3E                                cmp     al,3Eh                  ; '>'
2913:2F1F  73 F7                                jae     loc_425
2913:2F21  84 C0                                test    al,al
2913:2F23  74 F3                                jz      loc_425
2913:2F25  8A D0                                mov     dl,al
2913:2F27                       loc_426:                                        ;  xref 2913:2F2E, 2F32
2913:2F27  B0 40                                mov     al,40h                  ; '@'
2913:2F29  E8 FFA5                              call    rnd_update              ; (2ED1)
2913:2F2C  3C 3D                                cmp     al,3Dh                  ; '='
2913:2F2E  73 F7                                jae     loc_426
2913:2F30  3C 03                                cmp     al,3
2913:2F32  72 F3                                jb      loc_426
2913:2F34  8A F0                                mov     dh,al
2913:2F36  E8 0003                              call    maze_readxy             ; (2F3C)
2913:2F39  78 DD                                js      loc_425
2913:2F3B  C3                                   retn
                                maze_rnd_xy     endp


                                ;==========================================================================
                                ;                                maze_readxy
                                ;
                                ;     input:
                                ;             dl: x
                                ;             dh: y
                                ;     output:
                                ;             si: buffer address
                                ;             al: value in buffer
                                ;             zf: test on al
                                ;     Read from the byte array maze_buf_ei[64][64] with 64b stride.
                                ;     si = maze_buf_e + x + y*64
                                ;     al = *si
                                ;     zf = test(al)
                                ;
                                ;         Called from:   2913:03CD, 057D, 2167, 2959, 2F36
                                ;==========================================================================

2913:2F3C                       maze_readxy     proc    near
2913:2F3C  8A C2                                mov     al,dl
2913:2F3E  98                                   cbw
2913:2F3F  8B F0                                mov     si,ax
2913:2F41  8A E6                                mov     ah,dh
2913:2F43  32 C0                                xor     al,al
2913:2F45  D1 F8                                sar     ax,1
2913:2F47  D1 F8                                sar     ax,1
2913:2F49  03 F0                                add     si,ax
2913:2F4B .81 C6 3F89                           add     si,maze_buf_e           ; (2913:3F89=0)
2913:2F4F  8A 04                                mov     al,[si]
2913:2F51  84 C0                                test    al,al
2913:2F53  C3                                   retn
                                maze_readxy     endp

2913:2F54  00                   level           db      0                       ;  xref 2913:128B, 12C2, 12C9, 1CE6
                                                                                ;            1D3C, 2402
2913:2F55  00                   density         db      0                       ;  xref 2913:03F6, 1295, 12D1, 12D8
                                                                                ;            1D42
2913:2F56  25 25 25 25 25 00    strb_score      db       25h, 25h, 25h, 25h, 25h, 00h ; Score as a string
                                                                                ;  xref 2913:0172, 1046, 1D17, 1D48
2913:2F5C  FF                                   db      0FFh
2913:2F5D  25 25 25 25 25 00    strb_hisco      db       25h, 25h, 25h, 25h, 25h, 00h ; High score as a string
                                                                                ;  xref 2913:12A2, 1D1A, 1D4B
2913:2F63  FF                                   db      0FFh
2913:2F64  00                   high_level      db      0                       ; Level of the high score
                                                                                ;  xref 2913:12A8, 1D3F
2913:2F65  00                   high_dens       db      0                       ; Density of the high score
                                                                                ;  xref 2913:12B2, 1D45
2913:2F66  02                   data_181        db      2                       ;  xref 2913:06B8, 1745, 196A, 1A3B
2913:2F67  00                   time_tick       db      0                       ; Increments every timer tick
                                                                                ;  xref 2913:01B9, 01BE, 0215, 021A
                                                                                ;            028E, 02C8, 0B6D, 0B72
                                                                                ;            11D9, 11EB, 12DB, 12EF
                                                                                ;            12F4
2913:2F68  0B ED 5F 8F B5 3B    rnd_state       db       0Bh,0EDh, 5Fh, 8Fh,0B5h, 3Bh ; Possibly the state of the random
                                                                                ;  generator
                                                                                ;  xref 2913:012A, 018B, 2ED3
2913:2F6E  E3 73 67 23 6D 11                    db      0E3h, 73h, 67h, 23h, 6Dh, 11h
2913:2F74  BD A5 F3 DF 71 2B                    db      0BDh,0A5h,0F3h,0DFh, 71h, 2Bh
2913:2F7A  77 85 E5 37 AB EF                    db       77h, 85h,0E5h, 37h,0ABh,0EFh
2913:2F80  F7 D5 0F 51 EB F3                    db      0F7h,0D5h, 0Fh, 51h,0EBh,0F3h
2913:2F86  2B C3                                db       2Bh,0C3h

                                seg_a           ends



                                                end     start

                                ____________________ CROSS REFERENCE - KEY ENTRY POINTS ___________________

                                    seg:off    type                label
                                   ---- ----   ----   --------------------------------
                                   2913:0100   far    start
                                   2913:02C8   far    int_08h_entry
                                   2913:062D   far    int_09h_entry

                                 __________________ Interrupt Usage Synopsis __________________

                                        Interrupt 10h : Video display   ah=functn xxh
                                        Interrupt 10h :  ah=00h  set display mode in al
                                        Interrupt 10h :  ah=05h  set display page al
                                        Interrupt 10h :  ah=0Eh  write char al, teletype mode
                                        Interrupt 21h : DOS Services  ah=function xxh
                                        Interrupt 21h :  ah=09h  display char string at ds:dx
                                        Interrupt 21h :  ah=25h  set intrpt vector al to ds:dx
                                        Interrupt 20h : DOS program terminate

                                 __________________ I/O Port Usage Synopsis  __________________

                                        Port 20h   : 8259-1 int command
                                        Port 20h   :  al = 20h, end of interrupt
                                        Port 60h   : keybd scan or sw1
                                        Port 61h   : 8255 port B, read
                                        Port 61h   : 8255 B - spkr, etc
                                        Port 61h   :  al = 0, speaker off
                                        Port 3C4h  : EGA sequencr index
                                        Port 3C4h  :  al = 2, map mask register
                                        Port 3CEh  : EGA graphic index
                                        Port 3CEh  :  al = 3, data rotate
                                        Port 3CEh  :  al = 4, read map select
                                        Port 3D4h  : CGA/EGA reg index
                                        Port 3D4h  :  al = 0Ch, start address high
                                        Port 3DAh  : CGA/EGA vid status

